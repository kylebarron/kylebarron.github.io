<?xml version="1.0" encoding="UTF-8"?><rss xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:content="http://purl.org/rss/1.0/modules/content/" xmlns:atom="http://www.w3.org/2005/Atom" version="2.0"><channel><title><![CDATA[Kyle Barron's blog]]></title><description><![CDATA[Kyle Barron]]></description><link>https://kylebarron.dev</link><generator>GatsbyJS</generator><lastBuildDate>Wed, 02 Sep 2020 06:11:36 GMT</lastBuildDate><item><title><![CDATA[Serverless High-Resolution Aerial Imagery for the U.S.]]></title><link>https://kylebarron.dev/blog/cog-mosaic/naip</link><guid isPermaLink="false">https://kylebarron.dev/blog/cog-mosaic/naip</guid><pubDate>Wed, 02 Sep 2020 06:00:00 GMT</pubDate><content:encoded>&lt;style data-emotion-css=&quot;1hycliv&quot;&gt;body{--theme-ui-colors-transparent:var(--theme-ui-colors-transparent,transparent);--theme-ui-colors-black:var(--theme-ui-colors-black,#000);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-gray-0:var(--theme-ui-colors-gray-0,null);--theme-ui-colors-gray-1:var(--theme-ui-colors-gray-1,#f7fafc);--theme-ui-colors-gray-2:var(--theme-ui-colors-gray-2,#edf2f7);--theme-ui-colors-gray-3:var(--theme-ui-colors-gray-3,#e2e8f0);--theme-ui-colors-gray-4:var(--theme-ui-colors-gray-4,#cbd5e0);--theme-ui-colors-gray-5:var(--theme-ui-colors-gray-5,#a0aec0);--theme-ui-colors-gray-6:var(--theme-ui-colors-gray-6,#718096);--theme-ui-colors-gray-7:var(--theme-ui-colors-gray-7,#4a5568);--theme-ui-colors-gray-8:var(--theme-ui-colors-gray-8,#2d3748);--theme-ui-colors-gray-9:var(--theme-ui-colors-gray-9,#1a202c);--theme-ui-colors-red-0:var(--theme-ui-colors-red-0,null);--theme-ui-colors-red-1:var(--theme-ui-colors-red-1,#fff5f5);--theme-ui-colors-red-2:var(--theme-ui-colors-red-2,#fed7d7);--theme-ui-colors-red-3:var(--theme-ui-colors-red-3,#feb2b2);--theme-ui-colors-red-4:var(--theme-ui-colors-red-4,#fc8181);--theme-ui-colors-red-5:var(--theme-ui-colors-red-5,#f56565);--theme-ui-colors-red-6:var(--theme-ui-colors-red-6,#e53e3e);--theme-ui-colors-red-7:var(--theme-ui-colors-red-7,#c53030);--theme-ui-colors-red-8:var(--theme-ui-colors-red-8,#9b2c2c);--theme-ui-colors-red-9:var(--theme-ui-colors-red-9,#742a2a);--theme-ui-colors-orange-0:var(--theme-ui-colors-orange-0,null);--theme-ui-colors-orange-1:var(--theme-ui-colors-orange-1,#fffaf0);--theme-ui-colors-orange-2:var(--theme-ui-colors-orange-2,#feebc8);--theme-ui-colors-orange-3:var(--theme-ui-colors-orange-3,#fbd38d);--theme-ui-colors-orange-4:var(--theme-ui-colors-orange-4,#f6ad55);--theme-ui-colors-orange-5:var(--theme-ui-colors-orange-5,#ed8936);--theme-ui-colors-orange-6:var(--theme-ui-colors-orange-6,#dd6b20);--theme-ui-colors-orange-7:var(--theme-ui-colors-orange-7,#c05621);--theme-ui-colors-orange-8:var(--theme-ui-colors-orange-8,#9c4221);--theme-ui-colors-orange-9:var(--theme-ui-colors-orange-9,#7b341e);--theme-ui-colors-yellow-0:var(--theme-ui-colors-yellow-0,null);--theme-ui-colors-yellow-1:var(--theme-ui-colors-yellow-1,#fffff0);--theme-ui-colors-yellow-2:var(--theme-ui-colors-yellow-2,#fefcbf);--theme-ui-colors-yellow-3:var(--theme-ui-colors-yellow-3,#faf089);--theme-ui-colors-yellow-4:var(--theme-ui-colors-yellow-4,#f6e05e);--theme-ui-colors-yellow-5:var(--theme-ui-colors-yellow-5,#ecc94b);--theme-ui-colors-yellow-6:var(--theme-ui-colors-yellow-6,#d69e2e);--theme-ui-colors-yellow-7:var(--theme-ui-colors-yellow-7,#b7791f);--theme-ui-colors-yellow-8:var(--theme-ui-colors-yellow-8,#975a16);--theme-ui-colors-yellow-9:var(--theme-ui-colors-yellow-9,#744210);--theme-ui-colors-green-0:var(--theme-ui-colors-green-0,null);--theme-ui-colors-green-1:var(--theme-ui-colors-green-1,#f0fff4);--theme-ui-colors-green-2:var(--theme-ui-colors-green-2,#c6f6d5);--theme-ui-colors-green-3:var(--theme-ui-colors-green-3,#9ae6b4);--theme-ui-colors-green-4:var(--theme-ui-colors-green-4,#68d391);--theme-ui-colors-green-5:var(--theme-ui-colors-green-5,#48bb78);--theme-ui-colors-green-6:var(--theme-ui-colors-green-6,#38a169);--theme-ui-colors-green-7:var(--theme-ui-colors-green-7,#2f855a);--theme-ui-colors-green-8:var(--theme-ui-colors-green-8,#276749);--theme-ui-colors-green-9:var(--theme-ui-colors-green-9,#22543d);--theme-ui-colors-teal-0:var(--theme-ui-colors-teal-0,null);--theme-ui-colors-teal-1:var(--theme-ui-colors-teal-1,#e6fffa);--theme-ui-colors-teal-2:var(--theme-ui-colors-teal-2,#b2f5ea);--theme-ui-colors-teal-3:var(--theme-ui-colors-teal-3,#81e6d9);--theme-ui-colors-teal-4:var(--theme-ui-colors-teal-4,#4fd1c5);--theme-ui-colors-teal-5:var(--theme-ui-colors-teal-5,#38b2ac);--theme-ui-colors-teal-6:var(--theme-ui-colors-teal-6,#319795);--theme-ui-colors-teal-7:var(--theme-ui-colors-teal-7,#2c7a7b);--theme-ui-colors-teal-8:var(--theme-ui-colors-teal-8,#285e61);--theme-ui-colors-teal-9:var(--theme-ui-colors-teal-9,#234e52);--theme-ui-colors-blue-0:var(--theme-ui-colors-blue-0,null);--theme-ui-colors-blue-1:var(--theme-ui-colors-blue-1,#ebf8ff);--theme-ui-colors-blue-2:var(--theme-ui-colors-blue-2,#bee3f8);--theme-ui-colors-blue-3:var(--theme-ui-colors-blue-3,#90cdf4);--theme-ui-colors-blue-4:var(--theme-ui-colors-blue-4,#63b3ed);--theme-ui-colors-blue-5:var(--theme-ui-colors-blue-5,#4299e1);--theme-ui-colors-blue-6:var(--theme-ui-colors-blue-6,#3182ce);--theme-ui-colors-blue-7:var(--theme-ui-colors-blue-7,#2b6cb0);--theme-ui-colors-blue-8:var(--theme-ui-colors-blue-8,#2c5282);--theme-ui-colors-blue-9:var(--theme-ui-colors-blue-9,#2a4365);--theme-ui-colors-indigo-0:var(--theme-ui-colors-indigo-0,null);--theme-ui-colors-indigo-1:var(--theme-ui-colors-indigo-1,#ebf4ff);--theme-ui-colors-indigo-2:var(--theme-ui-colors-indigo-2,#c3dafe);--theme-ui-colors-indigo-3:var(--theme-ui-colors-indigo-3,#a3bffa);--theme-ui-colors-indigo-4:var(--theme-ui-colors-indigo-4,#7f9cf5);--theme-ui-colors-indigo-5:var(--theme-ui-colors-indigo-5,#667eea);--theme-ui-colors-indigo-6:var(--theme-ui-colors-indigo-6,#5a67d8);--theme-ui-colors-indigo-7:var(--theme-ui-colors-indigo-7,#4c51bf);--theme-ui-colors-indigo-8:var(--theme-ui-colors-indigo-8,#434190);--theme-ui-colors-indigo-9:var(--theme-ui-colors-indigo-9,#3c366b);--theme-ui-colors-purple-0:var(--theme-ui-colors-purple-0,null);--theme-ui-colors-purple-1:var(--theme-ui-colors-purple-1,#faf5ff);--theme-ui-colors-purple-2:var(--theme-ui-colors-purple-2,#e9d8fd);--theme-ui-colors-purple-3:var(--theme-ui-colors-purple-3,#d6bcfa);--theme-ui-colors-purple-4:var(--theme-ui-colors-purple-4,#b794f4);--theme-ui-colors-purple-5:var(--theme-ui-colors-purple-5,#9f7aea);--theme-ui-colors-purple-6:var(--theme-ui-colors-purple-6,#805ad5);--theme-ui-colors-purple-7:var(--theme-ui-colors-purple-7,#6b46c1);--theme-ui-colors-purple-8:var(--theme-ui-colors-purple-8,#553c9a);--theme-ui-colors-purple-9:var(--theme-ui-colors-purple-9,#44337a);--theme-ui-colors-pink-0:var(--theme-ui-colors-pink-0,null);--theme-ui-colors-pink-1:var(--theme-ui-colors-pink-1,#fff5f7);--theme-ui-colors-pink-2:var(--theme-ui-colors-pink-2,#fed7e2);--theme-ui-colors-pink-3:var(--theme-ui-colors-pink-3,#fbb6ce);--theme-ui-colors-pink-4:var(--theme-ui-colors-pink-4,#f687b3);--theme-ui-colors-pink-5:var(--theme-ui-colors-pink-5,#ed64a6);--theme-ui-colors-pink-6:var(--theme-ui-colors-pink-6,#d53f8c);--theme-ui-colors-pink-7:var(--theme-ui-colors-pink-7,#b83280);--theme-ui-colors-pink-8:var(--theme-ui-colors-pink-8,#97266d);--theme-ui-colors-pink-9:var(--theme-ui-colors-pink-9,#702459);--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#6b46c1);--theme-ui-colors-primaryHover:var(--theme-ui-colors-primaryHover,#2c5282);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#5f6c80);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-textMuted:var(--theme-ui-colors-textMuted,#718096);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-toggleIcon,#2d3748);--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000);--theme-ui-colors-divide:var(--theme-ui-colors-divide,#cbd5e0);color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#cbd5e0);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#9f7aea);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#7f8ea3);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-modes-dark-toggleIcon,#cbd5e0);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#1A202C);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);--theme-ui-colors-divide:var(--theme-ui-colors-modes-dark-divide,#2d3748);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#2d3748);}&lt;/style&gt;&lt;style data-emotion-css=&quot;15y10hy&quot;&gt;*{box-sizing:border-box;}body{margin:0;font-family:&quot;IBM Plex Sans&quot;,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;;line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;}&lt;/style&gt;&lt;style data-emotion-css=&quot;1bkk5q4&quot;&gt;.css-1bkk5q4{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-1bkk5q4{font-size:1rem;}}@media screen and (min-width:768px){.css-1bkk5q4{font-size:1.25rem;}}&lt;/style&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;style data-emotion-css=&quot;1od09yo&quot;&gt;.css-1od09yo{color:var(--theme-ui-colors-primary,#6b46c1);-webkit-text-decoration:none;text-decoration:none;}.css-1od09yo:hover{-webkit-text-decoration:underline;text-decoration:underline;}&lt;/style&gt;&lt;a href=&quot;https://kylebarron.dev/naip-cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:960px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:54.58333333333334%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAALABQDASIAAhEBAxEB/8QAGAAAAwEBAAAAAAAAAAAAAAAAAAIDAQT/xAAVAQEBAAAAAAAAAAAAAAAAAAABAv/aAAwDAQACEAMQAAABWPRGL0QT/8QAGhAAAQUBAAAAAAAAAAAAAAAAAAECEBExMv/aAAgBAQABBQJcKHcx/8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAwEBPwE//8QAFBEBAAAAAAAAAAAAAAAAAAAAEP/aAAgBAgEBPwE//8QAFBABAAAAAAAAAAAAAAAAAAAAIP/aAAgBAQAGPwJf/8QAGhAAAwEAAwAAAAAAAAAAAAAAAAERITFhwf/aAAgBAQABPyFZocTsouhyj8LiP//aAAwDAQACAAMAAAAQiM//xAAWEQEBAQAAAAAAAAAAAAAAAAAAARH/2gAIAQMBAT8Qta//xAAVEQEBAAAAAAAAAAAAAAAAAAABEP/aAAgBAgEBPxAn/8QAGhABAAMBAQEAAAAAAAAAAAAAAQARMSFhkf/aAAgBAQABPxBAVrz2EIye3YQKsXdbnxzBw05FW3pP/9k=&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image css-0&quot; alt=&quot;60cm-resolution NAIP imagery of the Grand Canyon from 2017&quot; title=&quot;60cm-resolution NAIP imagery of the Grand Canyon from 2017&quot; src=&quot;/static/da6e407cc9e40feacc0aafa2ddab473d/18e3b/grca.jpg&quot; srcSet=&quot;/static/da6e407cc9e40feacc0aafa2ddab473d/46946/grca.jpg 240w,/static/da6e407cc9e40feacc0aafa2ddab473d/55489/grca.jpg 480w,/static/da6e407cc9e40feacc0aafa2ddab473d/18e3b/grca.jpg 960w,/static/da6e407cc9e40feacc0aafa2ddab473d/60e21/grca.jpg 1440w,/static/da6e407cc9e40feacc0aafa2ddab473d/ae03e/grca.jpg 1767w&quot; sizes=&quot;(max-width: 960px) 100vw, 960px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;60cm-resolution imagery of the Grand Canyon from 2017. &lt;strong class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://kylebarron.dev/naip-cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;Click for an
interactive example&lt;/a&gt;&lt;/strong&gt;.&lt;/p&gt;&lt;style data-emotion-css=&quot;1u9n620&quot;&gt;.css-1u9n620{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:1rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1u9n620{font-size:1.875rem;}}@media screen and (min-width:768px){.css-1u9n620{font-size:2.25rem;}}&lt;/style&gt;&lt;h3 id=&quot;overview&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;More and more public imagery sources are being provided in &lt;a href=&quot;https://www.cogeo.org/&quot; class=&quot;css-1od09yo&quot;&gt;Cloud-Optimized
GeoTIFF (COG)&lt;/a&gt;, an efficient file format for fast random-access reads
of geospatial raster data. This is revolutionary because the format enables new
cloud-native workflows, such as serving imagery to a web map on demand, that
were never before possible.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Within half a second, a server can grab and combine the relevant portions of
half a dozen images, reproject into the coordinate reference system used in web
mapping, and return it to the user. Making this process happen on demand can
lead to huge reductions in cost—and zero fixed cost—as terabytes of map data no
longer need to be stored pregenerated and stored.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This post builds upon a &lt;a href=&quot;https://kylebarron.dev/blog/cog-mosaic/overview&quot; class=&quot;css-1od09yo&quot;&gt;previous overview post&lt;/a&gt; to give more
concrete details on working with the &lt;a href=&quot;https://registry.opendata.aws/naip/&quot; class=&quot;css-1od09yo&quot;&gt;public NAIP collection on AWS
S3&lt;/a&gt;, a repository of cloudless aerial imagery spanning the lower 48
U.S. states at up to 60-centimeter resolution. In the following sections I&amp;#x27;ll
give an overview of the imagery available and best practices for optimal
performance. For deployment instructions and other documentation, &lt;a href=&quot;https://github.com/kylebarron/naip-cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;visit the
project on Github&lt;/a&gt;.&lt;/p&gt;&lt;h3 id=&quot;naip-data&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#naip-data&quot; aria-label=&quot;naip data permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;NAIP Data&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The U.S. Department of Agriculture (USDA) oversees the &lt;a href=&quot;https://www.fsa.usda.gov/programs-and-services/aerial-photography/imagery-programs/naip-imagery/&quot; class=&quot;css-1od09yo&quot;&gt;National Agriculture
Imagery Program (NAIP)&lt;/a&gt;. Since 2003, this program has collected
high-resolution aerial imagery of the continental U.S., with recent years
photographed at 60-centimeter resolution. This data has been free to use for a
while, but historically has been locked in cloud-unfriendly,
&lt;a href=&quot;https://en.wikipedia.org/wiki/MrSID&quot; class=&quot;css-1od09yo&quot;&gt;closed-source&lt;/a&gt; formats.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;However, thanks to the AWS Open Data program, NAIP imagery from 2011 to 2018 is
available on a &lt;a href=&quot;https://registry.opendata.aws/naip/&quot; class=&quot;css-1od09yo&quot;&gt;public S3 bucket&lt;/a&gt; in &lt;a href=&quot;https://www.cogeo.org/&quot; class=&quot;css-1od09yo&quot;&gt;Cloud-Optimized GeoTIFF
(COG)&lt;/a&gt; format. As I explained in a &lt;a href=&quot;https://kylebarron.dev/blog/cog-mosaic/overview&quot; class=&quot;css-1od09yo&quot;&gt;previous blog post&lt;/a&gt;,
COGs democratize access to large collections of raster data by enabling fast
random-access reads.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Given this large collection of data freely available in a cloud-friendly format,
we can render map tiles from this imagery on demand with low latency, generally
within 500ms. This on-demand rendering provides multiple benefits:&lt;/p&gt;&lt;style data-emotion-css=&quot;15rlv7r&quot;&gt;.css-15rlv7r li{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-15rlv7r li{font-size:1rem;}}@media screen and (min-width:768px){.css-15rlv7r li{font-size:1.25rem;}}&lt;/style&gt;&lt;ul class=&quot;css-15rlv7r&quot;&gt;&lt;li class=&quot;css-0&quot;&gt;Lower costs. By not storing a copy of the data, you can avoid storage costs for pregenerated imagery. Source NAIP data is over 30TB in size; just to store that data on S3 would cost several hundred dollars a month.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;Greater image selection flexibility. By not pregenerating any imagery, you can give users the choice of what year&amp;#x27;s data to view. As soon as a new year&amp;#x27;s data exists, your maps can be updated.&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;mosaicjson&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#mosaicjson&quot; aria-label=&quot;mosaicjson permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MosaicJSON&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;As described in my &lt;a href=&quot;https://kylebarron.dev/blog/cog-mosaic/overview#mosaicjson&quot; class=&quot;css-1od09yo&quot;&gt;COG overview blog post&lt;/a&gt;:&lt;/p&gt;&lt;style data-emotion-css=&quot;1gtwvjp&quot;&gt;.css-1gtwvjp{border-left-color:var(--theme-ui-colors-primary,#6b46c1);border-left-style:solid;border-left-width:6px;margin-left:0;margin-right:0;padding-left:2rem;}.css-1gtwvjp p{font-style:italic;}&lt;/style&gt;&lt;blockquote class=&quot;css-1gtwvjp&quot;&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;It&amp;#x27;s great that all those terabytes of COG exist for public consumption, but
you still need a way to select what portions of imagery to combine. That&amp;#x27;s
where &lt;a href=&quot;https://github.com/developmentseed/mosaicjson-spec&quot; class=&quot;css-1od09yo&quot;&gt;MosaicJSON&lt;/a&gt; comes in. It&amp;#x27;s a file that determines what
source files should be merged to create each web mercator map tile.&lt;/p&gt;&lt;/blockquote&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Dynamic tiling works by combining multiple source images into a single output
image in the web mercator projection ready to send back to the client. This
process requires quickly finding the source images that are necessary to combine
for the desired tile.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;In the NAIP case, the process of assembling a MosaicJSON is relatively simple as
the source imagery is intentionally collected in such a way as to create a
seamless mosaic per state. Images are produced in a regular grid with little
overlap between source images, all imagery is cloudless, there exists minimal
temporal variation (at least within a state), and the dataset is relatively
static (updated yearly).&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;These factors make it considerably easier to work with mosaics for NAIP imagery
than for satellite imagery, which has more overlap between scenes, large
portions of missing or cloudy data, and high temporal variation.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The main thing to keep in mind when creating an NAIP mosaic is to avoid
including multiple years of imagery in a single mosaic, which can slow down
dynamic tiling. Most of &lt;code class=&quot;css-0&quot;&gt;naip-cogeo-mosaic&lt;/code&gt; is dedicated to working with the
NAIP metadata to create a seamless, efficient mosaic. Consult &lt;a href=&quot;https://github.com/kylebarron/naip-cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;its
documentation&lt;/a&gt; for more information.&lt;/p&gt;&lt;h3 id=&quot;image-overviews&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#image-overviews&quot; aria-label=&quot;image overviews permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Image Overviews&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Cloud-Optimized GeoTIFF files include a number of internal &lt;em class=&quot;css-0&quot;&gt;overviews&lt;/em&gt;:
lower-resolution, downsampled versions of the image, which are precomputed and
stored with the image. Each overview level halves the height and width pixels,
so each additional level reduces the resolution by a factor of 2. These
overviews enable fast reads at a range of resolutions by minimizing the
amount of bytes that need to be read.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;NAIP imagery in the &lt;code class=&quot;css-0&quot;&gt;naip-visualization&lt;/code&gt; S3 bucket have full-resolution data
plus 5 levels of overviews. This means that NAIP data can be read most
efficiently at &lt;em class=&quot;css-0&quot;&gt;six&lt;/em&gt; zoom levels, in this case zooms 12-17. At zooms higher than
17, the images look pixelated. At zooms lower than 12, many images need to be
combined and downsampled on the fly. To create an image for a single zoom 6
mercator tile, you&amp;#x27;d need to read &lt;em class=&quot;css-0&quot;&gt;4,096&lt;/em&gt; times more data at level 12, then
downsample.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Unsurprisingly, needing to fetch so many source images reduces performance when
rendering at lower zooms. A solution to this problem is to create &lt;em class=&quot;css-0&quot;&gt;pregenerated
overviews&lt;/em&gt; for lower zooms: reading all necessary source images once then
downsampling ahead of time. Then when rendering lower zoom images, read from the
already-downsampled data.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;In this case, to serve imagery for zooms 6-11 on the fly, I generate overview
images that are themselves Cloud-Optimized GeoTIFFs, each of which contains 5
internal overview levels. Pregenerating overviews does lose some flexibility of
COGs, as you need to choose how to combine imagery (your MosaicJSON) ahead of
time rather than on demand.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The &lt;a href=&quot;https://github.com/kylebarron/naip-cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;naip-cogeo-mosaic&lt;/code&gt; documentation&lt;/a&gt; has more information
on how to use &lt;a href=&quot;https://github.com/developmentseed/cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic&lt;/code&gt;&lt;/a&gt; to create these overviews.&lt;/p&gt;&lt;h3 id=&quot;dynamic-tiling-performance&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#dynamic-tiling-performance&quot; aria-label=&quot;dynamic tiling performance permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Dynamic Tiling Performance&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I&amp;#x27;ve spent a lot of time working on performance for dynamic tiling, with the
goal of reducing latency to the point that it&amp;#x27;s viable for a wide range of
applications.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;With my current serverless solution hosted on AWS Lambda, I&amp;#x27;m able to get around
500ms latency (longer for cold starts). In the following sections I&amp;#x27;ll outline
the things you should keep in mind to keep performance as high as possible.&lt;/p&gt;&lt;style data-emotion-css=&quot;1slx2ud&quot;&gt;.css-1slx2ud{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.25rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1slx2ud{font-size:1.5rem;}}@media screen and (min-width:768px){.css-1slx2ud{font-size:1.875rem;}}&lt;/style&gt;&lt;h4 id=&quot;minimize-number-of-source-assets&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#minimize-number-of-source-assets&quot; aria-label=&quot;minimize number of source assets permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Minimize number of source assets&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Since GDAL, the program underlying the dynamic tiling process, is synchronous,
the largest amount of time is spent waiting on network requests to S3 for each
portion of the image. Thus, one of the best ways to minimize total time is to
minimize the number of images the tiler has to fetch to combine into a single
web mercator tile.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;As &lt;a href=&quot;#mosaicjson&quot; class=&quot;css-1od09yo&quot;&gt;described above&lt;/a&gt;, this step is done ahead of time, while
creating the MosaicJSON. The process of minimizing superfluous source assets is
taken care of within &lt;code class=&quot;css-0&quot;&gt;naip-cogeo-mosaic&lt;/code&gt; when you make a mosaic.&lt;/p&gt;&lt;h4 id=&quot;256x256-pixel-images&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#256x256-pixel-images&quot; aria-label=&quot;256x256 pixel images permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;256x256 pixel images&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Images used in web maps usually come in square images of either 256x256 pixels
or 512x512 pixels (@2x resolution). Using @2x resolution tiles requires fewer
requests to cover the screen, since each image covers a larger area at the same
resolution, but each request takes longer. With @1x scale tiles, each tile is
1/4th the size, so you&amp;#x27;ll need (roughly) four times the requests.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;With this project, my goal is to push per-tile latency as low as possible.
Unsurprisingly, it takes significantly longer—my ballpark estimates are around 2
to 3 times longer—to generate a @2x scale image than a @1x scale image. Thus,
serving @1x scale images is preferable when you prioritize speed, but server
costs will be slightly higher since you need so many more requests.&lt;/p&gt;&lt;h4 id=&quot;locate-server-in-us-west-2&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#locate-server-in-us-west-2&quot; aria-label=&quot;locate server in us west 2 permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Locate server in &lt;code class=&quot;css-0&quot;&gt;us-west-2&lt;/code&gt;&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The tiler works by&lt;/p&gt;&lt;ol class=&quot;css-15rlv7r&quot;&gt;&lt;li class=&quot;css-0&quot;&gt;Using the MosaicJSON to find URLs of source images that overlap the mercator tile of interest&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;Reading the relevant portion of each source image&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;Combining pixels into one output image ready to send back to the client&lt;/li&gt;&lt;/ol&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;While these three steps work with any file format, Cloud-Optimized GeoTIFFs
allow for huge speedups on the second part. The COG format is efficient because
it allows for intelligent streaming of portions of an image, but because a COG
is internally tiled, the tiling server will likely need several (small) GET
requests for each source image. Thus, locating the compute in the same region as
the data is absolutely essential for low total latency, as the latency for each
S3 GET request is larger across regions, and this time gets multiplied by the
number of requests per image, and the number of images needed to combine for one
mercator tile.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Additionally, since NAIP imagery is stored in a Requester Pays S3 bucket,
locating the server in the same region will be significantly cheaper as you
won&amp;#x27;t need to pay egress charges on intermediate data transfer.&lt;/p&gt;&lt;h4 id=&quot;use-gdal-24-not-31&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#use-gdal-24-not-31&quot; aria-label=&quot;use gdal 24 not 31 permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Use GDAL 2.4, not 3.1&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;As of summer 2020, GDAL 2.4 has been tested to be &lt;a href=&quot;https://github.com/lambgeo/docker-lambda/issues/2&quot; class=&quot;css-1od09yo&quot;&gt;&lt;em class=&quot;css-0&quot;&gt;significantly
faster&lt;/em&gt;&lt;/a&gt; (&lt;a href=&quot;https://github.com/developmentseed/cogeo-mosaic-tiler/issues/4#issuecomment-604120617&quot; class=&quot;css-1od09yo&quot;&gt;&amp;gt;10x&lt;/a&gt;) than GDAL 3.1, at least for this specific
use case.&lt;/p&gt;&lt;h4 id=&quot;use-dynamodb-as-the-mosaicjson-backend&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#use-dynamodb-as-the-mosaicjson-backend&quot; aria-label=&quot;use dynamodb as the mosaicjson backend permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Use DynamoDB as the MosaicJSON backend&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The MosaicJSON defines a mapping from mercator tiles to image urls. Since it
must define this mapping for &lt;em class=&quot;css-0&quot;&gt;every mercator tile&lt;/em&gt; (at the minimum zoom, which
for NAIP is zoom 12), the MosaicJSON file can get quite large. When saved as a
JSON file, my United States-wide mosaics are 64MB. Since this mosaic is needed
for every dynamic tiling request, storing this data in a JSON file on S3
requires the lambda function download and parse it on every request. This adds
roughly 2.5s per request for such a large mosaic.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Luckily, there&amp;#x27;s an alternative to storing as JSON.
&lt;a href=&quot;https://github.com/developmentseed/cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic&lt;/code&gt;&lt;/a&gt; supports multiple &lt;em class=&quot;css-0&quot;&gt;backends&lt;/em&gt;, one of which is
&lt;a href=&quot;https://aws.amazon.com/dynamodb/&quot; class=&quot;css-1od09yo&quot;&gt;DynamoDB&lt;/a&gt;, a serverless, low-latency key-value store. This is ideal
for storing mosaics because only one or sometimes two DynamoDB read requests are
necessary per dynamic tiling request. This lowers the time spent on the
MosaicJSON from 2.5s to around 20ms.&lt;/p&gt;&lt;h4 id=&quot;client-side-image-manipulation&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#client-side-image-manipulation&quot; aria-label=&quot;client side image manipulation permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Client-side image manipulation&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Often the NAIP imagery is visually a bit bland and benefits from increased
saturation. While it&amp;#x27;s possible to do this server side, it increases image load
times by 100-200ms. For WebGL-enabled map clients like Mapbox GL JS or
&lt;a href=&quot;https://deck.gl&quot; class=&quot;css-1od09yo&quot;&gt;deck.gl&lt;/a&gt;, client-side image saturation is easy and
instantaneous, so this is better to do client side.&lt;/p&gt;&lt;h4 id=&quot;caching&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#caching&quot; aria-label=&quot;caching permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Caching&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I&amp;#x27;m a big fan of Cloudflare&amp;#x27;s free tier as a simple solution to both speed up my
site and keep costs low by reducing the number of requests that reach my server.
Some sort of caching is ideal.&lt;/p&gt;&lt;h3 id=&quot;pricing&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#pricing&quot; aria-label=&quot;pricing permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Pricing&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;A rough estimate of the cost with my serverless approach is &lt;strong class=&quot;css-0&quot;&gt;$25 per million
requests&lt;/strong&gt;. Note that this is only for requests &lt;em class=&quot;css-0&quot;&gt;that reach Lambda&lt;/em&gt;; using
Cloudflare with a long Cache-Control setting should make it effectively even
cheaper.&lt;/p&gt;&lt;ul class=&quot;css-15rlv7r&quot;&gt;&lt;li class=&quot;css-0&quot;&gt;Lambda compute time: $12.5/million requests. On average, each request takes around 500 ms, when Lambda is set to 1536 MB of memory. Note that this is for @1x tiles; @2x tiles take 2-3x longer for compute (but you need fewer requests). If you have significant, stable usage, you could save by not going serverless.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;Lambda requests: $0.20/million.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;DynamoDB requests: $0.25/million. Each dynamic tiling request needs a read request to DynamoDB to find the relevant image urls.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;API Gateway requests: $1.00/million. I use the cheaper, newer HTTP API service instead of the older REST API service, which is $3.50/million.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;S3 GET requests: $8.00/million. Since NAIP imagery is stored in a requester pays bucket, the user pays for the GET requests. On average there are 4 to 6 source images, and each COG requires between 1 and 5 GET requests, depending on the zoom level and technical factors.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;Network egress: $2.00/million. Assuming image tiles are served as JPEGs, each image is roughly 25kb. Multiply by 4 if using @2x tiles. PNGs are significantly larger.&lt;/li&gt;&lt;/ul&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This is a pretty good value. Once you surpass Mapbox&amp;#x27;s (generous) free tier,
their satellite imagery costs $250/million requests. (Though that&amp;#x27;s not a direct
apples-to-apples comparison, since you can request @2x tiles from Mapbox for
apparently the same price.) But apart from being cheap, a great benefit of the
dynamic tiling approach is that you can choose &lt;em class=&quot;css-0&quot;&gt;any&lt;/em&gt; combination of imagery you
wish. It&amp;#x27;s just as easy to serve tiles from 2011 as it is from 2018.&lt;/p&gt;&lt;h3 id=&quot;drawbacks&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#drawbacks&quot; aria-label=&quot;drawbacks permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Drawbacks&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;That said, there are a few drawbacks to using NAIP imagery and reasons why tiled
imagery from a commercial company such as Mapbox can often be better.&lt;/p&gt;&lt;ul class=&quot;css-15rlv7r&quot;&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;strong class=&quot;css-0&quot;&gt;No global coverage&lt;/strong&gt;: NAIP data only exists for the continental U.S. The highest-resolution public, global satellite imagery I know of is Sentinel 2 data, which has a 10-meter resolution.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;strong class=&quot;css-0&quot;&gt;Image quality&lt;/strong&gt;: while NAIP generally has good image quality, across large areas seams are quite noticeable. NAIP is ideal when zoomed in; it can look downsampled and patchy at low zooms.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;strong class=&quot;css-0&quot;&gt;Missing areas within U.S.&lt;/strong&gt;: some areas within the continental U.S., especially military bases, are not photographed by the NAIP program.&lt;/li&gt;&lt;/ul&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Since this project was designed for exploration and to be &amp;quot;good enough&amp;quot; for
hobby mapping projects, these drawbacks are fine for my needs.&lt;/p&gt;&lt;h3 id=&quot;conclusion&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;If you appreciate this data, &lt;strong class=&quot;css-0&quot;&gt;talk to your elected officials&lt;/strong&gt;. &lt;a href=&quot;https://en.wikipedia.org/wiki/National_Agriculture_Imagery_Program&quot; class=&quot;css-1od09yo&quot;&gt;According to
Wikipedia&lt;/a&gt;, USDA is considering removing NAIP imagery from the
public domain in the near future.&lt;/p&gt;&lt;h3 id=&quot;references&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#references&quot; aria-label=&quot;references permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;References&lt;/h3&gt;&lt;ul class=&quot;css-15rlv7r&quot;&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://github.com/kylebarron/naip-cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;naip-cogeo-mosaic&lt;/code&gt;&lt;/a&gt;: the open source project underlying this blog post. Refer to its documentation for how to deploy.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://developmentseed.org/titiler/&quot; class=&quot;css-1od09yo&quot;&gt;Titiler&lt;/a&gt;: a next-generation dynamic tiling server that supports both serverless and server deployment. I&amp;#x27;d recommend this over &lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic-tiler&lt;/code&gt; for all new deployments.&lt;/li&gt;&lt;/ul&gt;&lt;h3 id=&quot;acknowledgements&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#acknowledgements&quot; aria-label=&quot;acknowledgements permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Acknowledgements&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Thanks to &lt;a href=&quot;https://twitter.com/_VincentS_&quot; class=&quot;css-1od09yo&quot;&gt;Vincent Sarago&lt;/a&gt;, &lt;a href=&quot;https://twitter.com/geospatialjeff&quot; class=&quot;css-1od09yo&quot;&gt;Jeff Albrecht&lt;/a&gt;, and many others for
their invaluable feedback and work pushing the Cloud-Optimized GeoTIFF ecosystem
forward.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Dynamic map tiling with Cloud-Optimized GeoTIFFs]]></title><link>https://kylebarron.dev/blog/cog-mosaic/overview</link><guid isPermaLink="false">https://kylebarron.dev/blog/cog-mosaic/overview</guid><pubDate>Tue, 12 May 2020 06:00:00 GMT</pubDate><content:encoded>&lt;style data-emotion-css=&quot;1hycliv&quot;&gt;body{--theme-ui-colors-transparent:var(--theme-ui-colors-transparent,transparent);--theme-ui-colors-black:var(--theme-ui-colors-black,#000);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-gray-0:var(--theme-ui-colors-gray-0,null);--theme-ui-colors-gray-1:var(--theme-ui-colors-gray-1,#f7fafc);--theme-ui-colors-gray-2:var(--theme-ui-colors-gray-2,#edf2f7);--theme-ui-colors-gray-3:var(--theme-ui-colors-gray-3,#e2e8f0);--theme-ui-colors-gray-4:var(--theme-ui-colors-gray-4,#cbd5e0);--theme-ui-colors-gray-5:var(--theme-ui-colors-gray-5,#a0aec0);--theme-ui-colors-gray-6:var(--theme-ui-colors-gray-6,#718096);--theme-ui-colors-gray-7:var(--theme-ui-colors-gray-7,#4a5568);--theme-ui-colors-gray-8:var(--theme-ui-colors-gray-8,#2d3748);--theme-ui-colors-gray-9:var(--theme-ui-colors-gray-9,#1a202c);--theme-ui-colors-red-0:var(--theme-ui-colors-red-0,null);--theme-ui-colors-red-1:var(--theme-ui-colors-red-1,#fff5f5);--theme-ui-colors-red-2:var(--theme-ui-colors-red-2,#fed7d7);--theme-ui-colors-red-3:var(--theme-ui-colors-red-3,#feb2b2);--theme-ui-colors-red-4:var(--theme-ui-colors-red-4,#fc8181);--theme-ui-colors-red-5:var(--theme-ui-colors-red-5,#f56565);--theme-ui-colors-red-6:var(--theme-ui-colors-red-6,#e53e3e);--theme-ui-colors-red-7:var(--theme-ui-colors-red-7,#c53030);--theme-ui-colors-red-8:var(--theme-ui-colors-red-8,#9b2c2c);--theme-ui-colors-red-9:var(--theme-ui-colors-red-9,#742a2a);--theme-ui-colors-orange-0:var(--theme-ui-colors-orange-0,null);--theme-ui-colors-orange-1:var(--theme-ui-colors-orange-1,#fffaf0);--theme-ui-colors-orange-2:var(--theme-ui-colors-orange-2,#feebc8);--theme-ui-colors-orange-3:var(--theme-ui-colors-orange-3,#fbd38d);--theme-ui-colors-orange-4:var(--theme-ui-colors-orange-4,#f6ad55);--theme-ui-colors-orange-5:var(--theme-ui-colors-orange-5,#ed8936);--theme-ui-colors-orange-6:var(--theme-ui-colors-orange-6,#dd6b20);--theme-ui-colors-orange-7:var(--theme-ui-colors-orange-7,#c05621);--theme-ui-colors-orange-8:var(--theme-ui-colors-orange-8,#9c4221);--theme-ui-colors-orange-9:var(--theme-ui-colors-orange-9,#7b341e);--theme-ui-colors-yellow-0:var(--theme-ui-colors-yellow-0,null);--theme-ui-colors-yellow-1:var(--theme-ui-colors-yellow-1,#fffff0);--theme-ui-colors-yellow-2:var(--theme-ui-colors-yellow-2,#fefcbf);--theme-ui-colors-yellow-3:var(--theme-ui-colors-yellow-3,#faf089);--theme-ui-colors-yellow-4:var(--theme-ui-colors-yellow-4,#f6e05e);--theme-ui-colors-yellow-5:var(--theme-ui-colors-yellow-5,#ecc94b);--theme-ui-colors-yellow-6:var(--theme-ui-colors-yellow-6,#d69e2e);--theme-ui-colors-yellow-7:var(--theme-ui-colors-yellow-7,#b7791f);--theme-ui-colors-yellow-8:var(--theme-ui-colors-yellow-8,#975a16);--theme-ui-colors-yellow-9:var(--theme-ui-colors-yellow-9,#744210);--theme-ui-colors-green-0:var(--theme-ui-colors-green-0,null);--theme-ui-colors-green-1:var(--theme-ui-colors-green-1,#f0fff4);--theme-ui-colors-green-2:var(--theme-ui-colors-green-2,#c6f6d5);--theme-ui-colors-green-3:var(--theme-ui-colors-green-3,#9ae6b4);--theme-ui-colors-green-4:var(--theme-ui-colors-green-4,#68d391);--theme-ui-colors-green-5:var(--theme-ui-colors-green-5,#48bb78);--theme-ui-colors-green-6:var(--theme-ui-colors-green-6,#38a169);--theme-ui-colors-green-7:var(--theme-ui-colors-green-7,#2f855a);--theme-ui-colors-green-8:var(--theme-ui-colors-green-8,#276749);--theme-ui-colors-green-9:var(--theme-ui-colors-green-9,#22543d);--theme-ui-colors-teal-0:var(--theme-ui-colors-teal-0,null);--theme-ui-colors-teal-1:var(--theme-ui-colors-teal-1,#e6fffa);--theme-ui-colors-teal-2:var(--theme-ui-colors-teal-2,#b2f5ea);--theme-ui-colors-teal-3:var(--theme-ui-colors-teal-3,#81e6d9);--theme-ui-colors-teal-4:var(--theme-ui-colors-teal-4,#4fd1c5);--theme-ui-colors-teal-5:var(--theme-ui-colors-teal-5,#38b2ac);--theme-ui-colors-teal-6:var(--theme-ui-colors-teal-6,#319795);--theme-ui-colors-teal-7:var(--theme-ui-colors-teal-7,#2c7a7b);--theme-ui-colors-teal-8:var(--theme-ui-colors-teal-8,#285e61);--theme-ui-colors-teal-9:var(--theme-ui-colors-teal-9,#234e52);--theme-ui-colors-blue-0:var(--theme-ui-colors-blue-0,null);--theme-ui-colors-blue-1:var(--theme-ui-colors-blue-1,#ebf8ff);--theme-ui-colors-blue-2:var(--theme-ui-colors-blue-2,#bee3f8);--theme-ui-colors-blue-3:var(--theme-ui-colors-blue-3,#90cdf4);--theme-ui-colors-blue-4:var(--theme-ui-colors-blue-4,#63b3ed);--theme-ui-colors-blue-5:var(--theme-ui-colors-blue-5,#4299e1);--theme-ui-colors-blue-6:var(--theme-ui-colors-blue-6,#3182ce);--theme-ui-colors-blue-7:var(--theme-ui-colors-blue-7,#2b6cb0);--theme-ui-colors-blue-8:var(--theme-ui-colors-blue-8,#2c5282);--theme-ui-colors-blue-9:var(--theme-ui-colors-blue-9,#2a4365);--theme-ui-colors-indigo-0:var(--theme-ui-colors-indigo-0,null);--theme-ui-colors-indigo-1:var(--theme-ui-colors-indigo-1,#ebf4ff);--theme-ui-colors-indigo-2:var(--theme-ui-colors-indigo-2,#c3dafe);--theme-ui-colors-indigo-3:var(--theme-ui-colors-indigo-3,#a3bffa);--theme-ui-colors-indigo-4:var(--theme-ui-colors-indigo-4,#7f9cf5);--theme-ui-colors-indigo-5:var(--theme-ui-colors-indigo-5,#667eea);--theme-ui-colors-indigo-6:var(--theme-ui-colors-indigo-6,#5a67d8);--theme-ui-colors-indigo-7:var(--theme-ui-colors-indigo-7,#4c51bf);--theme-ui-colors-indigo-8:var(--theme-ui-colors-indigo-8,#434190);--theme-ui-colors-indigo-9:var(--theme-ui-colors-indigo-9,#3c366b);--theme-ui-colors-purple-0:var(--theme-ui-colors-purple-0,null);--theme-ui-colors-purple-1:var(--theme-ui-colors-purple-1,#faf5ff);--theme-ui-colors-purple-2:var(--theme-ui-colors-purple-2,#e9d8fd);--theme-ui-colors-purple-3:var(--theme-ui-colors-purple-3,#d6bcfa);--theme-ui-colors-purple-4:var(--theme-ui-colors-purple-4,#b794f4);--theme-ui-colors-purple-5:var(--theme-ui-colors-purple-5,#9f7aea);--theme-ui-colors-purple-6:var(--theme-ui-colors-purple-6,#805ad5);--theme-ui-colors-purple-7:var(--theme-ui-colors-purple-7,#6b46c1);--theme-ui-colors-purple-8:var(--theme-ui-colors-purple-8,#553c9a);--theme-ui-colors-purple-9:var(--theme-ui-colors-purple-9,#44337a);--theme-ui-colors-pink-0:var(--theme-ui-colors-pink-0,null);--theme-ui-colors-pink-1:var(--theme-ui-colors-pink-1,#fff5f7);--theme-ui-colors-pink-2:var(--theme-ui-colors-pink-2,#fed7e2);--theme-ui-colors-pink-3:var(--theme-ui-colors-pink-3,#fbb6ce);--theme-ui-colors-pink-4:var(--theme-ui-colors-pink-4,#f687b3);--theme-ui-colors-pink-5:var(--theme-ui-colors-pink-5,#ed64a6);--theme-ui-colors-pink-6:var(--theme-ui-colors-pink-6,#d53f8c);--theme-ui-colors-pink-7:var(--theme-ui-colors-pink-7,#b83280);--theme-ui-colors-pink-8:var(--theme-ui-colors-pink-8,#97266d);--theme-ui-colors-pink-9:var(--theme-ui-colors-pink-9,#702459);--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#6b46c1);--theme-ui-colors-primaryHover:var(--theme-ui-colors-primaryHover,#2c5282);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#5f6c80);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-textMuted:var(--theme-ui-colors-textMuted,#718096);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-toggleIcon,#2d3748);--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000);--theme-ui-colors-divide:var(--theme-ui-colors-divide,#cbd5e0);color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#cbd5e0);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#9f7aea);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#7f8ea3);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-modes-dark-toggleIcon,#cbd5e0);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#1A202C);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);--theme-ui-colors-divide:var(--theme-ui-colors-modes-dark-divide,#2d3748);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#2d3748);}&lt;/style&gt;&lt;style data-emotion-css=&quot;15y10hy&quot;&gt;*{box-sizing:border-box;}body{margin:0;font-family:&quot;IBM Plex Sans&quot;,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;;line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;}&lt;/style&gt;&lt;style data-emotion-css=&quot;1bkk5q4&quot;&gt;.css-1bkk5q4{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-1bkk5q4{font-size:1rem;}}@media screen and (min-width:768px){.css-1bkk5q4{font-size:1.25rem;}}&lt;/style&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:960px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:58.333333333333336%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAYAAABiDJ37AAAACXBIWXMAABYlAAAWJQFJUiTwAAADSElEQVQozy2SX2/bZBjFjeCCSaNdUjS4R1PXpe0GQhoTkzbarVW3bmvTrnOSJc1f23ESO3bsxE4cJ2mWJqVNu4VlMJSiwsaukZAYaDcILvkGyNIQH+Q5vAUe6dHzSq90dPQ7h/vLe02vfvmdHNWl6IZIu6qM570munoFB5aNh3YNB3YVXa0EW9TRyGpoKjZsrYNXP/6Kv/98jWxcI5lP40V/z+M6tR77bEEWq4gF4zisqfRt28awWsGzrouvWi72TBPtfAEdrYyWrMPJFNCydvB0/xCjJy+QTFqkqttIr8U9biOYpgQv4NpCjFwhQy8Hdfw0cOloy8Zhq4ahU0PfNPCoXMJB1UGbucuGRCQ3sthuPUGj3MWNxfsUCuvI3Et53IdXMjS/mEA0rJDEJ6itKBhYTMBU8aVTxm7JxOhBC98xt/u2g7pSh51WEV+XMNg7QjHfwNLcXbo6H8XHl+95nP+Cho+WHLq1pmEtKGJ1LUvRiIr1lSSauRyedWw873fwctTHwHH/5ddSLDiihnaxhtsrIuavRWh+IYFLV0IeNz1XxaerPfhmFApcLiASq2AzXECSFyHFZHR0E/uVMkbdNh7Vm+jpFkNgo6eWUIlLyEQE3OdFWl/NYOF6xOPGp3I4fV6lsbMSjU+mMDGt4OJVActLUYRWonA1C1bBwLBe/S9dgQmlVPQUA1XmUhcUmFmDyoKGOzc3Pe7kZJ5OTckYmxTwbkCgk2c1nJ5V6PpiHMEbYfww3MFO1cYXjOdD24UZV9GRNfQKOgzG0smzt27Q0LagJSSPGwuU4J/RyDej08R0Ab5AgXyBPJZvy1i/GcHnRgnfdBvsGnjs1tHWjitVw65SRKdQhByVWTdV6usazBQT9J/h6Z33L9IJf4D8kzGamC3ivQs5+mQui83VGDaWw/h+v4stndXI0fDb1008dhxs5ZhAOg85nEY5LlJDkGGnRI97g+OI+39PfRAk36wB/7RM41PH6cURvsXjgariqLeNp806/jis4edBDXoyh4qoQNvMoCtJpEZSyPGMIRsc75tvnSDfuSyNnVPBgqK3z+Rw/lIKoWUeQljAaLuPTGuAz9IOkpKLgV1Cv6RAT+WwJcpMMIO7dxLeP1tBEB9ZlJsHAAAAAElFTkSuQmCC&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image css-0&quot; alt=&quot;Dynamic tiling of Landsat data. Credit @_VincentS_&quot; title=&quot;Dynamic tiling of Landsat data. Credit @_VincentS_&quot; src=&quot;/static/9dc9a6ea73735f4c5e7014b96fc18db5/7d769/awspds_readme_screenshot.png&quot; srcSet=&quot;/static/9dc9a6ea73735f4c5e7014b96fc18db5/5243c/awspds_readme_screenshot.png 240w,/static/9dc9a6ea73735f4c5e7014b96fc18db5/ab158/awspds_readme_screenshot.png 480w,/static/9dc9a6ea73735f4c5e7014b96fc18db5/7d769/awspds_readme_screenshot.png 960w,/static/9dc9a6ea73735f4c5e7014b96fc18db5/da8b6/awspds_readme_screenshot.png 1000w&quot; sizes=&quot;(max-width: 960px) 100vw, 960px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/p&gt;&lt;style data-emotion-css=&quot;1bzbprl&quot;&gt;.css-1bzbprl{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.875rem;margin-top:0.5rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1bzbprl{font-size:2.25rem;}}@media screen and (min-width:768px){.css-1bzbprl{font-size:3rem;}}&lt;/style&gt;&lt;h2 id=&quot;overview&quot; style=&quot;position:relative&quot; class=&quot;css-1bzbprl&quot;&gt;&lt;style data-emotion-css=&quot;1od09yo&quot;&gt;.css-1od09yo{color:var(--theme-ui-colors-primary,#6b46c1);-webkit-text-decoration:none;text-decoration:none;}.css-1od09yo:hover{-webkit-text-decoration:underline;text-decoration:underline;}&lt;/style&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h2&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;There&amp;#x27;s a new way to serve a raster basemap.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Historically, the barrier to entry of serving an image basemap was
quite high. You had have access to high quality satellite imagery, the compute
power to preprocess those images into the right format for the web, the storage
capability to store all that data, and the server capability to handle spikes in
traffic.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;All that has changed.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;With the advent of serverless computing, the Cloud-Optimized GeoTIFF (COG)
format, and large public repositories of such data, serving map tiles from large
collections of imagery is being democratized. It&amp;#x27;s now possible to serve tiles
on demand from a collection of terabytes of imagery, quickly, cheaply, and
easily.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;In this post, I present an outline of this new ecosystem, and lay the groundwork
for future blog posts where I put this theory into practice, and show how to
implement these tools with existing, open data sets.&lt;/p&gt;&lt;h2 id=&quot;cloud-optimized-geotiffs&quot; style=&quot;position:relative&quot; class=&quot;css-1bzbprl&quot;&gt;&lt;a href=&quot;#cloud-optimized-geotiffs&quot; aria-label=&quot;cloud optimized geotiffs permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Cloud-Optimized GeoTIFFs&lt;/h2&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;As described on &lt;a href=&quot;https://www.cogeo.org/&quot; class=&quot;css-1od09yo&quot;&gt;cogeo.org&lt;/a&gt;:&lt;/p&gt;&lt;style data-emotion-css=&quot;1gtwvjp&quot;&gt;.css-1gtwvjp{border-left-color:var(--theme-ui-colors-primary,#6b46c1);border-left-style:solid;border-left-width:6px;margin-left:0;margin-right:0;padding-left:2rem;}.css-1gtwvjp p{font-style:italic;}&lt;/style&gt;&lt;blockquote class=&quot;css-1gtwvjp&quot;&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;A Cloud Optimized GeoTIFF (COG) is a regular GeoTIFF file, aimed at being hosted on a HTTP file server, with an internal organization that enables more efficient workflows on the cloud. It does this by leveraging the ability of clients issuing ​HTTP GET range requests to ask for just the parts of a file they need.&lt;/p&gt;&lt;/blockquote&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This new format is at the core of dynamic tiling. By making use of its internal
image &lt;em class=&quot;css-0&quot;&gt;overviews&lt;/em&gt;, one can read &lt;em class=&quot;css-0&quot;&gt;parts&lt;/em&gt; of the image over a network roughly in
proportion to the amount of data requested. The client needs only to read the
file&amp;#x27;s inital metadata to know the exact pattern and byte ranges of the rest of
the file. Then to read an image&amp;#x27;s top-right corner at mid-resolution, a minimal
number of additional requests can be made just for that data.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;There are several large collections of publicly-available COG data, including:&lt;/p&gt;&lt;style data-emotion-css=&quot;15rlv7r&quot;&gt;.css-15rlv7r li{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-15rlv7r li{font-size:1rem;}}@media screen and (min-width:768px){.css-15rlv7r li{font-size:1.25rem;}}&lt;/style&gt;&lt;ul class=&quot;css-15rlv7r&quot;&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://registry.opendata.aws/landsat-8/&quot; class=&quot;css-1od09yo&quot;&gt;Landsat 8&lt;/a&gt;: Worldwide, medium resolution multi-spectral imagery since 2013, with new scenes added daily.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://registry.opendata.aws/naip/&quot; class=&quot;css-1od09yo&quot;&gt;NAIP&lt;/a&gt;: High resolution (1-meter and 0.6-meter) true color &amp;quot;leaf-on&amp;quot; imagery for the continental 48 U.S. states, taken at regular intervals since 2011. Most states have been imaged four times since 2011.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://registry.opendata.aws/modis-astraea/&quot; class=&quot;css-1od09yo&quot;&gt;MODIS&lt;/a&gt;: Worldwide, low resolution multi-spectral imagery captured by the MODIS satellite.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://registry.opendata.aws/cbers/&quot; class=&quot;css-1od09yo&quot;&gt;CBERS&lt;/a&gt;: Medium resolution imagery captured by the China-Brazil Earth Resources Satellite. It doesn&amp;#x27;t have worldwide coverage, however.&lt;/li&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://www.usgs.gov/core-science-systems/ngp/topo-maps/historical-topographic-map-collection?qt-science_support_page_related_con=0&quot; class=&quot;css-1od09yo&quot;&gt;USGS Historical Topographic Maps&lt;/a&gt;: 181,000 topographic maps, created between 1884 and 2006, covering U.S. territory. These files have been scanned, georeferenced, and saved in COG format in a public S3 bucket.&lt;/li&gt;&lt;/ul&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;NAIP, MODIS, and CBERS imagery is stored in requester-pays buckets, which means
that the requester pays the cost of the &lt;code class=&quot;css-0&quot;&gt;GET&lt;/code&gt; request and the data transfer, but
as we&amp;#x27;ll see in future blog posts, this is a small cost as long as the tiler is
located in the same region as the data.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Additionally, high-resolution USGS elevation data &lt;a href=&quot;https://www.usgs.gov/news/usgs-digital-elevation-models-dem-switching-new-distribution-format&quot; class=&quot;css-1od09yo&quot;&gt;is being
converted&lt;/a&gt; to COG, with expected launch in 2020, and there are
rumors that Sentinel 2 data may be available in COG in the future.&lt;/p&gt;&lt;h2 id=&quot;mosaicjson&quot; style=&quot;position:relative&quot; class=&quot;css-1bzbprl&quot;&gt;&lt;a href=&quot;#mosaicjson&quot; aria-label=&quot;mosaicjson permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;MosaicJSON&lt;/h2&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;It&amp;#x27;s great that all those terabytes of COG exist for public consumption, but you
still need a way to select what portions of imagery to combine. That&amp;#x27;s where
&lt;a href=&quot;https://github.com/developmentseed/mosaicjson-spec&quot; class=&quot;css-1od09yo&quot;&gt;MosaicJSON&lt;/a&gt; comes in. It&amp;#x27;s a file that determines what source files
should be merged to create each web mercator map tile.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;MosaicJSON files add flexibility to the system. I can switch combinations of
imagery by switching the MosaicJSON file that I pass to the tiler. For example,
I&amp;#x27;ve generated a couple dozen MosaicJSON files representing cloudless Landsat 8
combinations: one per season since 2013. It&amp;#x27;s then easy to expose image
selection options to the user by changing the MosaicJSON url to give to the
tiler. (Deeper explanation coming in future blog post).&lt;/p&gt;&lt;h2 id=&quot;serverless-computing&quot; style=&quot;position:relative&quot; class=&quot;css-1bzbprl&quot;&gt;&lt;a href=&quot;#serverless-computing&quot; aria-label=&quot;serverless computing permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Serverless Computing&lt;/h2&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://en.wikipedia.org/wiki/Serverless_computing&quot; class=&quot;css-1od09yo&quot;&gt;Serverless computing&lt;/a&gt; is the last part of the puzzle.
With services like AWS Lambda, one can set up dynamic tiling for a hobby
project, and never have to manage servers. AWS Lambda will scale up and down
with demand. If your project generally receives little traffic, but once in a
while goes viral, you pay very little when you have no visitors, but are still
able to scale quickly to whatever level is necessary.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;To be clear, going serverless is not a &lt;em class=&quot;css-0&quot;&gt;necessary&lt;/em&gt; part of the puzzle. If you
plan to serve map tiles at scale, it may be more performant or cheaper to
maintain your own servers, but the maintainance overhead needs to be taken into
account.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;At this stage, I plan to use dynamic tiling for hobby projects, and not having
to manage servers is a big plus.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;While serverless computing is sometimes more expensive than running and
maintaining a server, serving tiles is still cheaper than some paid services. A
rough cost estimate for on-demand tiling of Landsat 8 data is $50 per million
tiles. As a comparison, once (if) you surpass Mapbox&amp;#x27;s (very generous) free
tier, their pricing is $0.25 per 1000 requests, or $250 per million.
Furthermore, I aggressively &lt;a href=&quot;/blog/caching-lambda-functions-cloudflare&quot; class=&quot;css-1od09yo&quot;&gt;cache my Lambda responses with
Cloudflare&lt;/a&gt; to minimize the requests that reach the origin.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;But overall, part of the allure of dynamic tiling is the flexibility from being
able to choose &lt;em class=&quot;css-0&quot;&gt;any&lt;/em&gt; imagery on demand. You aren&amp;#x27;t restricted to what Mapbox
selects for their satellite basemap.&lt;/p&gt;&lt;h2 id=&quot;ecosystem&quot; style=&quot;position:relative&quot; class=&quot;css-1bzbprl&quot;&gt;&lt;a href=&quot;#ecosystem&quot; aria-label=&quot;ecosystem permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Ecosystem&lt;/h2&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Over the last few months, and along with &lt;a href=&quot;https://twitter.com/_vincents_&quot; class=&quot;css-1od09yo&quot;&gt;Vincent Sarago&lt;/a&gt; and
&lt;a href=&quot;https://github.com/geospatial-jeff&quot; class=&quot;css-1od09yo&quot;&gt;Jeff Albrecht&lt;/a&gt;, I&amp;#x27;ve been helping to build out an ecosystem of
open source tools to make dynamic tiling fast and reliable.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;There are several interrelated tools. It&amp;#x27;s easy to get them confused.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Here&amp;#x27;s an overview of the ecosystem.&lt;/p&gt;&lt;style data-emotion-css=&quot;1slx2ud&quot;&gt;.css-1slx2ud{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.25rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1slx2ud{font-size:1.5rem;}}@media screen and (min-width:768px){.css-1slx2ud{font-size:1.875rem;}}&lt;/style&gt;&lt;h4 id=&quot;rio-tiler&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#rio-tiler&quot; aria-label=&quot;rio tiler permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt;&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://github.com/cogeotiff/rio-tiler&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt;&lt;/a&gt; is at the core of the ecosystem. It&amp;#x27;s a library whose
main purpose is to create a mercator tile from a given input image. In contrast
to some of the following libraries, it takes a &lt;em class=&quot;css-0&quot;&gt;single&lt;/em&gt; input path and returns a
&lt;em class=&quot;css-0&quot;&gt;single&lt;/em&gt; output image. It forms the core of some other libraries.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;With the &amp;quot;standard&amp;quot; tiler, you provide a path to a COG image and a standard
&lt;code class=&quot;css-0&quot;&gt;xyz&lt;/code&gt; mercator tile, and it returns data for that mercator tile. Specifically,
it returns &lt;em class=&quot;css-0&quot;&gt;two objects&lt;/em&gt;, &lt;code class=&quot;css-0&quot;&gt;data&lt;/code&gt; and &lt;code class=&quot;css-0&quot;&gt;mask&lt;/code&gt;, which allow you to ascertain what
portions of the mercator tile are not covered by the source image. &lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt;
also includes some &amp;quot;mission-specific&amp;quot; tilers for Landsat 8, Sentinel 1 and 2,
and CBERS. These allow you to pass an &lt;em class=&quot;css-0&quot;&gt;identifier&lt;/em&gt; to a satellite scene, and the
tiler will find the data corresponding to that scene on AWS S3.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;em class=&quot;css-0&quot;&gt;September 2020 update&lt;/em&gt;: With the upcoming &lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt; v2.0 release,
mission-specific tilers have been refactored into a separate module,
&lt;a href=&quot;https://github.com/cogeotiff/rio-tiler-pds&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;rio-tiler-pds&lt;/code&gt;&lt;/a&gt;.&lt;/p&gt;&lt;h4 id=&quot;rio-tiler-mosaic&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#rio-tiler-mosaic&quot; aria-label=&quot;rio tiler mosaic permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;css-0&quot;&gt;rio-tiler-mosaic&lt;/code&gt;&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://github.com/cogeotiff/rio-tiler-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;rio-tiler-mosaic&lt;/code&gt;&lt;/a&gt; builds upon &lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt; to work with
multiple assets. It takes a list of assets that are &lt;em class=&quot;css-0&quot;&gt;already known&lt;/em&gt; to overlap
with the tile, and combines them into an image aligned with a web mercator tile.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This is a core difference between this and &lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic&lt;/code&gt;/&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic-tiler&lt;/code&gt;:
since &lt;code class=&quot;css-0&quot;&gt;rio-tiler-mosaic&lt;/code&gt; doesn&amp;#x27;t interact with the MosaicJSON directly,
&lt;code class=&quot;css-0&quot;&gt;rio-tiler-mosaic&lt;/code&gt; doesn&amp;#x27;t know how to &lt;em class=&quot;css-0&quot;&gt;find&lt;/em&gt; the right combination of assets to
tile together.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;rio-tiler-mosaic&lt;/code&gt; takes a &lt;em class=&quot;css-0&quot;&gt;tiler&lt;/em&gt; from &lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt; as an argument. This forms a
simple plugin system, making it simple to create an image tile from either the
standard tiler or a mission-specific tiler, such as the Landsat 8 tiler.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;em class=&quot;css-0&quot;&gt;September 2020 update&lt;/em&gt;: With the upcoming &lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt; v2.0 release,
&lt;code class=&quot;css-0&quot;&gt;rio-tiler-mosaic&lt;/code&gt; is merged into the main &lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt; repository.&lt;/p&gt;&lt;h4 id=&quot;cogeo-mosaic&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#cogeo-mosaic&quot; aria-label=&quot;cogeo mosaic permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic&lt;/code&gt;&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://github.com/developmentseed/cogeo-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic&lt;/code&gt;&lt;/a&gt; is a Python library to create MosaicJSON files
and load such files from various &lt;em class=&quot;css-0&quot;&gt;backends&lt;/em&gt;. In the upcoming 3.0 release, new
support exists for storing a MosaicJSON in a variety of locations, including in
a DynamoDB table. For large mosaics, DynamoDB is significantly faster than
loading a JSON file from an S3 bucket.&lt;/p&gt;&lt;h4 id=&quot;cogeo-mosaic-tiler&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#cogeo-mosaic-tiler&quot; aria-label=&quot;cogeo mosaic tiler permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic-tiler&lt;/code&gt;&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://github.com/developmentseed/cogeo-mosaic-tiler&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic-tiler&lt;/code&gt;&lt;/a&gt; wraps all of the above together. It&amp;#x27;s
a python package and web server that depends on the above packages to serve
tiled imagery on demand, and is designed to be deployed on AWS Lambda.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;For example, the image endpoint essentially just loads a given MosaicJSON using
&lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic&lt;/code&gt;, using it to find asset identifiers for a specific mercator tile.
Then it passes those assets to &lt;code class=&quot;css-0&quot;&gt;rio-tiler-mosaic&lt;/code&gt; using the standard tiler from
&lt;code class=&quot;css-0&quot;&gt;rio-tiler&lt;/code&gt;. Those two packages then load each of the necessary assets,
combining them into a single web mercator tile on the fly, returning it as an
image to the user.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://github.com/developmentseed/awspds-mosaic&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;awspds-mosaic&lt;/code&gt;&lt;/a&gt; is a fork of &lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic-tiler&lt;/code&gt; to support
dynamic tiling of Landsat 8 data stored on AWS as a public data set. Landsat 8
imagery has some custom needs because data are stored in individual bands that
need to be combined into a single image.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;em class=&quot;css-0&quot;&gt;September 2020 update&lt;/em&gt;: &lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic-tiler&lt;/code&gt; is being superseded by
&lt;a href=&quot;https://github.com/developmentseed/titiler&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;titiler&lt;/code&gt;&lt;/a&gt;, a newer dynamic tiling server that handles more use-cases
and has more varied options for deployment. I recommend titiler for all new
deployments, as &lt;code class=&quot;css-0&quot;&gt;cogeo-mosaic-tiler&lt;/code&gt; is less likely to receive updates.&lt;/p&gt;&lt;h4 id=&quot;rio-cogeo&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#rio-cogeo&quot; aria-label=&quot;rio cogeo permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;&lt;code class=&quot;css-0&quot;&gt;rio-cogeo&lt;/code&gt;&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://github.com/cogeotiff/rio-cogeo&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;rio-cogeo&lt;/code&gt;&lt;/a&gt; is a library to facilitate &lt;em class=&quot;css-0&quot;&gt;creating COGs&lt;/em&gt;. It&amp;#x27;s rare
that I use it because I&amp;#x27;m generally tiling COGs that already exist publicly on
S3, and thus I don&amp;#x27;t need to create new COGs.&lt;/p&gt;&lt;h2 id=&quot;references&quot; style=&quot;position:relative&quot; class=&quot;css-1bzbprl&quot;&gt;&lt;a href=&quot;#references&quot; aria-label=&quot;references permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;References&lt;/h2&gt;&lt;ul class=&quot;css-15rlv7r&quot;&gt;&lt;li class=&quot;css-0&quot;&gt;&lt;a href=&quot;https://medium.com/devseed/cog-talk-part-1-whats-new-941facbcd3d1&quot; class=&quot;css-1od09yo&quot;&gt;COG talk&lt;/a&gt;, a great, insightful series on the Cloud-Optimized GeoTIFF format, MosaicJSON, and dynamic tiling.&lt;/li&gt;&lt;/ul&gt;</content:encoded></item><item><title><![CDATA[Cache AWS Lambda responses with Cloudflare]]></title><link>https://kylebarron.dev/blog/caching-lambda-functions-cloudflare</link><guid isPermaLink="false">https://kylebarron.dev/blog/caching-lambda-functions-cloudflare</guid><pubDate>Tue, 28 Apr 2020 06:00:00 GMT</pubDate><content:encoded>&lt;style data-emotion-css=&quot;1hycliv&quot;&gt;body{--theme-ui-colors-transparent:var(--theme-ui-colors-transparent,transparent);--theme-ui-colors-black:var(--theme-ui-colors-black,#000);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-gray-0:var(--theme-ui-colors-gray-0,null);--theme-ui-colors-gray-1:var(--theme-ui-colors-gray-1,#f7fafc);--theme-ui-colors-gray-2:var(--theme-ui-colors-gray-2,#edf2f7);--theme-ui-colors-gray-3:var(--theme-ui-colors-gray-3,#e2e8f0);--theme-ui-colors-gray-4:var(--theme-ui-colors-gray-4,#cbd5e0);--theme-ui-colors-gray-5:var(--theme-ui-colors-gray-5,#a0aec0);--theme-ui-colors-gray-6:var(--theme-ui-colors-gray-6,#718096);--theme-ui-colors-gray-7:var(--theme-ui-colors-gray-7,#4a5568);--theme-ui-colors-gray-8:var(--theme-ui-colors-gray-8,#2d3748);--theme-ui-colors-gray-9:var(--theme-ui-colors-gray-9,#1a202c);--theme-ui-colors-red-0:var(--theme-ui-colors-red-0,null);--theme-ui-colors-red-1:var(--theme-ui-colors-red-1,#fff5f5);--theme-ui-colors-red-2:var(--theme-ui-colors-red-2,#fed7d7);--theme-ui-colors-red-3:var(--theme-ui-colors-red-3,#feb2b2);--theme-ui-colors-red-4:var(--theme-ui-colors-red-4,#fc8181);--theme-ui-colors-red-5:var(--theme-ui-colors-red-5,#f56565);--theme-ui-colors-red-6:var(--theme-ui-colors-red-6,#e53e3e);--theme-ui-colors-red-7:var(--theme-ui-colors-red-7,#c53030);--theme-ui-colors-red-8:var(--theme-ui-colors-red-8,#9b2c2c);--theme-ui-colors-red-9:var(--theme-ui-colors-red-9,#742a2a);--theme-ui-colors-orange-0:var(--theme-ui-colors-orange-0,null);--theme-ui-colors-orange-1:var(--theme-ui-colors-orange-1,#fffaf0);--theme-ui-colors-orange-2:var(--theme-ui-colors-orange-2,#feebc8);--theme-ui-colors-orange-3:var(--theme-ui-colors-orange-3,#fbd38d);--theme-ui-colors-orange-4:var(--theme-ui-colors-orange-4,#f6ad55);--theme-ui-colors-orange-5:var(--theme-ui-colors-orange-5,#ed8936);--theme-ui-colors-orange-6:var(--theme-ui-colors-orange-6,#dd6b20);--theme-ui-colors-orange-7:var(--theme-ui-colors-orange-7,#c05621);--theme-ui-colors-orange-8:var(--theme-ui-colors-orange-8,#9c4221);--theme-ui-colors-orange-9:var(--theme-ui-colors-orange-9,#7b341e);--theme-ui-colors-yellow-0:var(--theme-ui-colors-yellow-0,null);--theme-ui-colors-yellow-1:var(--theme-ui-colors-yellow-1,#fffff0);--theme-ui-colors-yellow-2:var(--theme-ui-colors-yellow-2,#fefcbf);--theme-ui-colors-yellow-3:var(--theme-ui-colors-yellow-3,#faf089);--theme-ui-colors-yellow-4:var(--theme-ui-colors-yellow-4,#f6e05e);--theme-ui-colors-yellow-5:var(--theme-ui-colors-yellow-5,#ecc94b);--theme-ui-colors-yellow-6:var(--theme-ui-colors-yellow-6,#d69e2e);--theme-ui-colors-yellow-7:var(--theme-ui-colors-yellow-7,#b7791f);--theme-ui-colors-yellow-8:var(--theme-ui-colors-yellow-8,#975a16);--theme-ui-colors-yellow-9:var(--theme-ui-colors-yellow-9,#744210);--theme-ui-colors-green-0:var(--theme-ui-colors-green-0,null);--theme-ui-colors-green-1:var(--theme-ui-colors-green-1,#f0fff4);--theme-ui-colors-green-2:var(--theme-ui-colors-green-2,#c6f6d5);--theme-ui-colors-green-3:var(--theme-ui-colors-green-3,#9ae6b4);--theme-ui-colors-green-4:var(--theme-ui-colors-green-4,#68d391);--theme-ui-colors-green-5:var(--theme-ui-colors-green-5,#48bb78);--theme-ui-colors-green-6:var(--theme-ui-colors-green-6,#38a169);--theme-ui-colors-green-7:var(--theme-ui-colors-green-7,#2f855a);--theme-ui-colors-green-8:var(--theme-ui-colors-green-8,#276749);--theme-ui-colors-green-9:var(--theme-ui-colors-green-9,#22543d);--theme-ui-colors-teal-0:var(--theme-ui-colors-teal-0,null);--theme-ui-colors-teal-1:var(--theme-ui-colors-teal-1,#e6fffa);--theme-ui-colors-teal-2:var(--theme-ui-colors-teal-2,#b2f5ea);--theme-ui-colors-teal-3:var(--theme-ui-colors-teal-3,#81e6d9);--theme-ui-colors-teal-4:var(--theme-ui-colors-teal-4,#4fd1c5);--theme-ui-colors-teal-5:var(--theme-ui-colors-teal-5,#38b2ac);--theme-ui-colors-teal-6:var(--theme-ui-colors-teal-6,#319795);--theme-ui-colors-teal-7:var(--theme-ui-colors-teal-7,#2c7a7b);--theme-ui-colors-teal-8:var(--theme-ui-colors-teal-8,#285e61);--theme-ui-colors-teal-9:var(--theme-ui-colors-teal-9,#234e52);--theme-ui-colors-blue-0:var(--theme-ui-colors-blue-0,null);--theme-ui-colors-blue-1:var(--theme-ui-colors-blue-1,#ebf8ff);--theme-ui-colors-blue-2:var(--theme-ui-colors-blue-2,#bee3f8);--theme-ui-colors-blue-3:var(--theme-ui-colors-blue-3,#90cdf4);--theme-ui-colors-blue-4:var(--theme-ui-colors-blue-4,#63b3ed);--theme-ui-colors-blue-5:var(--theme-ui-colors-blue-5,#4299e1);--theme-ui-colors-blue-6:var(--theme-ui-colors-blue-6,#3182ce);--theme-ui-colors-blue-7:var(--theme-ui-colors-blue-7,#2b6cb0);--theme-ui-colors-blue-8:var(--theme-ui-colors-blue-8,#2c5282);--theme-ui-colors-blue-9:var(--theme-ui-colors-blue-9,#2a4365);--theme-ui-colors-indigo-0:var(--theme-ui-colors-indigo-0,null);--theme-ui-colors-indigo-1:var(--theme-ui-colors-indigo-1,#ebf4ff);--theme-ui-colors-indigo-2:var(--theme-ui-colors-indigo-2,#c3dafe);--theme-ui-colors-indigo-3:var(--theme-ui-colors-indigo-3,#a3bffa);--theme-ui-colors-indigo-4:var(--theme-ui-colors-indigo-4,#7f9cf5);--theme-ui-colors-indigo-5:var(--theme-ui-colors-indigo-5,#667eea);--theme-ui-colors-indigo-6:var(--theme-ui-colors-indigo-6,#5a67d8);--theme-ui-colors-indigo-7:var(--theme-ui-colors-indigo-7,#4c51bf);--theme-ui-colors-indigo-8:var(--theme-ui-colors-indigo-8,#434190);--theme-ui-colors-indigo-9:var(--theme-ui-colors-indigo-9,#3c366b);--theme-ui-colors-purple-0:var(--theme-ui-colors-purple-0,null);--theme-ui-colors-purple-1:var(--theme-ui-colors-purple-1,#faf5ff);--theme-ui-colors-purple-2:var(--theme-ui-colors-purple-2,#e9d8fd);--theme-ui-colors-purple-3:var(--theme-ui-colors-purple-3,#d6bcfa);--theme-ui-colors-purple-4:var(--theme-ui-colors-purple-4,#b794f4);--theme-ui-colors-purple-5:var(--theme-ui-colors-purple-5,#9f7aea);--theme-ui-colors-purple-6:var(--theme-ui-colors-purple-6,#805ad5);--theme-ui-colors-purple-7:var(--theme-ui-colors-purple-7,#6b46c1);--theme-ui-colors-purple-8:var(--theme-ui-colors-purple-8,#553c9a);--theme-ui-colors-purple-9:var(--theme-ui-colors-purple-9,#44337a);--theme-ui-colors-pink-0:var(--theme-ui-colors-pink-0,null);--theme-ui-colors-pink-1:var(--theme-ui-colors-pink-1,#fff5f7);--theme-ui-colors-pink-2:var(--theme-ui-colors-pink-2,#fed7e2);--theme-ui-colors-pink-3:var(--theme-ui-colors-pink-3,#fbb6ce);--theme-ui-colors-pink-4:var(--theme-ui-colors-pink-4,#f687b3);--theme-ui-colors-pink-5:var(--theme-ui-colors-pink-5,#ed64a6);--theme-ui-colors-pink-6:var(--theme-ui-colors-pink-6,#d53f8c);--theme-ui-colors-pink-7:var(--theme-ui-colors-pink-7,#b83280);--theme-ui-colors-pink-8:var(--theme-ui-colors-pink-8,#97266d);--theme-ui-colors-pink-9:var(--theme-ui-colors-pink-9,#702459);--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#6b46c1);--theme-ui-colors-primaryHover:var(--theme-ui-colors-primaryHover,#2c5282);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#5f6c80);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-textMuted:var(--theme-ui-colors-textMuted,#718096);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-toggleIcon,#2d3748);--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000);--theme-ui-colors-divide:var(--theme-ui-colors-divide,#cbd5e0);color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#cbd5e0);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#9f7aea);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#7f8ea3);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-modes-dark-toggleIcon,#cbd5e0);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#1A202C);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);--theme-ui-colors-divide:var(--theme-ui-colors-modes-dark-divide,#2d3748);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#2d3748);}&lt;/style&gt;&lt;style data-emotion-css=&quot;15y10hy&quot;&gt;*{box-sizing:border-box;}body{margin:0;font-family:&quot;IBM Plex Sans&quot;,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;;line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;}&lt;/style&gt;&lt;style data-emotion-css=&quot;1bkk5q4&quot;&gt;.css-1bkk5q4{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-1bkk5q4{font-size:1rem;}}@media screen and (min-width:768px){.css-1bkk5q4{font-size:1.25rem;}}&lt;/style&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;style data-emotion-css=&quot;1od09yo&quot;&gt;.css-1od09yo{color:var(--theme-ui-colors-primary,#6b46c1);-webkit-text-decoration:none;text-decoration:none;}.css-1od09yo:hover{-webkit-text-decoration:underline;text-decoration:underline;}&lt;/style&gt;&lt;a href=&quot;https://www.cloudflare.com/&quot; class=&quot;css-1od09yo&quot;&gt;Cloudflare&lt;/a&gt; is a Content Delivery Network (CDN), a global network
of servers that cache responses from websites so that those responses can load
more quickly for future website visitors. A CDN has dual benefits: your website
becomes faster for your visitors, but &lt;em class=&quot;css-0&quot;&gt;also&lt;/em&gt; fewer traffic reaches your origin
web server, reducing load. For Cloudflare specifically, they have a generous
free tier, so for most personal projects, it&amp;#x27;s more than enough for my needs.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I&amp;#x27;m building some projects around AWS Lambda, a powerful serverless platform
that allows you to respond to network requests in a completely scalable way.
When your traffic is zero, your costs are zero, but if your website goes viral,
you&amp;#x27;ll be able to scale to a huge number of requests quickly.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Cloudflare is especially helpful alongside AWS Lambda because pricing is done
per request, so the fewer requests that reach your Lambda function, the cheaper
it&amp;#x27;ll be to run.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This post is a high-level overview of how to connect Lambda and Cloudflare.&lt;/p&gt;&lt;style data-emotion-css=&quot;1u9n620&quot;&gt;.css-1u9n620{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:1rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1u9n620{font-size:1.875rem;}}@media screen and (min-width:768px){.css-1u9n620{font-size:2.25rem;}}&lt;/style&gt;&lt;h3 id=&quot;overview&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#overview&quot; aria-label=&quot;overview permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Overview&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://stackoverflow.com/a/45849093&quot; class=&quot;css-1od09yo&quot;&gt;This StackOverflow answer&lt;/a&gt; on connecting API Gateway
to Cloudflare is extremely helpful, so much of this post is essentially
rehashing that answer for my future reference.&lt;/p&gt;&lt;style data-emotion-css=&quot;1slx2ud&quot;&gt;.css-1slx2ud{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.25rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1slx2ud{font-size:1.5rem;}}@media screen and (min-width:768px){.css-1slx2ud{font-size:1.875rem;}}&lt;/style&gt;&lt;h4 id=&quot;set-up-cloudflare&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#set-up-cloudflare&quot; aria-label=&quot;set up cloudflare permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Set up Cloudflare&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;First you need to set up a Cloudflare account and attach a domain you own. This
is relatively self-explanatory. Go to &lt;a href=&quot;https://cloudflare.com&quot; class=&quot;css-1od09yo&quot;&gt;https://cloudflare.com&lt;/a&gt;, sign up, and
follow their instructions for attaching your domain name and pointing your DNS
towards Cloudflare&amp;#x27;s nameservers.&lt;/p&gt;&lt;h4 id=&quot;create-certificate&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#create-certificate&quot; aria-label=&quot;create certificate permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Create certificate&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Since API Gateway requires all outbound traffic to be encrypted, you need to
create an SSL certificate to upload to AWS to tell how to encrypt your data. The
simplest way to create this certificate is through the Cloudflare dashboard.
Cloudflare will helpfully also renew the certificate as needed.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Go to your website in Cloudflare&amp;#x27;s UI and then choose &amp;quot;SSL/TLS&amp;quot; &amp;gt; &amp;quot;Origin
Server&amp;quot;. Then click &amp;quot;Create Certificate&amp;quot;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The only thing you need to change is the hostnames field. Since I&amp;#x27;ll put my
endpoints at &lt;code class=&quot;css-0&quot;&gt;lambda.kylebarron.dev/*&lt;/code&gt;, I enter the following hostnames:&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:960px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:23.333333333333332%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVQY022QyW6DQBBE5/8/K5ZixQth33cwWLFBYj9Wujux5YMPT9VT1VODUEEYwvN9wQ8C2I4j6riueGEUCa7nic+87rPPc14UuHcdlGGacvmBZdtS6tIsShfYNy0LJu0eTyecNQ26YUj2reuil6bBz+0G9bHb4XO/x9fh8Bf+F3EBlzP8elXXSLMMWZ6LPuYkTWXmnfZ6hSqrCmVZilGQNm0rFFzCGcGvD+OIbduwritW1teZlRinCSqKYyRJ8qSmL+GSiP4bn2PKY9Ku77EsC6Z5fstM2TCM+AUweGlTBdmpagAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image css-0&quot; alt=&quot;certificate_hostnames.png&quot; title=&quot;certificate_hostnames.png&quot; src=&quot;/static/3448422cb543469b810dc33a870e9093/7d769/certificate_hostnames.png&quot; srcSet=&quot;/static/3448422cb543469b810dc33a870e9093/5243c/certificate_hostnames.png 240w,/static/3448422cb543469b810dc33a870e9093/ab158/certificate_hostnames.png 480w,/static/3448422cb543469b810dc33a870e9093/7d769/certificate_hostnames.png 960w,/static/3448422cb543469b810dc33a870e9093/87339/certificate_hostnames.png 1440w,/static/3448422cb543469b810dc33a870e9093/3557b/certificate_hostnames.png 1692w&quot; sizes=&quot;(max-width: 960px) 100vw, 960px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Upon continuing, you see the generated certificate. It&amp;#x27;s crypto gibberish, but
you should keep a record of this, but for the next few steps, and possibly
longer term in your password manager.&lt;/p&gt;&lt;h4 id=&quot;import-certificate&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#import-certificate&quot; aria-label=&quot;import certificate permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Import Certificate&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Navigate to the AWS Certificate Manager (ACM) console. This should be easily
found through the AWS web UI.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;strong class=&quot;css-0&quot;&gt;Note&lt;/strong&gt;: In general, you should upload to &lt;code class=&quot;css-0&quot;&gt;us-east-1&lt;/code&gt;. However, I&amp;#x27;m using the
newer, cheaper HTTP API Gateway endpoint instead of the older REST API Gateway
endpoint. For the HTTP API Gateway endpoints, &lt;strong class=&quot;css-0&quot;&gt;the certificate needs to be
uploaded to ACM in the same region as the lambda functions&lt;/strong&gt;. I also don&amp;#x27;t
think there&amp;#x27;s a downside to uploading your certificate to multiple regions.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Click &amp;quot;Import Certificate&amp;quot;. Then where it says &amp;quot;Certificate body&amp;quot;, paste your
&lt;strong class=&quot;css-0&quot;&gt;Origin Certificate&lt;/strong&gt; from the previous step. Where it says &amp;quot;Certificate
private key&amp;quot;, paste your &lt;strong class=&quot;css-0&quot;&gt;Private key&lt;/strong&gt; from the previous step. For the
&amp;quot;Certificate chain&amp;quot;, that&amp;#x27;s a special public key from Cloudflare. To retrieve
it, go to &lt;a href=&quot;https://support.cloudflare.com/hc/en-us/articles/115000479507&quot; class=&quot;css-1od09yo&quot;&gt;this Cloudflare help page&lt;/a&gt;, scroll down to &amp;quot;Step 4 -
Add Cloudflare Origin CA root certificates&amp;quot;, and expand &amp;quot;Cloudflare Origin CA —
RSA Root&amp;quot;. Then paste that value into the AWS ACM box. Click &amp;quot;Next&amp;quot;. Add a tag
if you&amp;#x27;d like, then click &amp;quot;Import&amp;quot;.&lt;/p&gt;&lt;h4 id=&quot;add-custom-domain-to-api-gateway&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#add-custom-domain-to-api-gateway&quot; aria-label=&quot;add custom domain to api gateway permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Add custom domain to API Gateway&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Go to the API Gateway console. Then choose &amp;quot;Custom Domain Names&amp;quot; on the left.
Then click &amp;quot;Create&amp;quot;. Enter your domain name, which must match the one provided
when you created the certificate. Since I use this for personal projects, I&amp;#x27;m
content with &amp;quot;Regional&amp;quot;, which likely has lower availability than
&amp;quot;Edge-optimized&amp;quot;, but is still very high. Then choose the ACM certificate you
just uploaded that also matches the same domain name. Then click &amp;quot;Create&amp;quot;.&lt;/p&gt;&lt;h4 id=&quot;configure-domain-mappings&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#configure-domain-mappings&quot; aria-label=&quot;configure domain mappings permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Configure domain mappings&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Now you&amp;#x27;ve created a certificate, imported it to Amazon, and connected it with a
custom API gateway domain. But you need to tell API Gateway which API to call
when that domain is requested. On the same page as the last step, click
&amp;quot;Configure API mappings&amp;quot;, then &amp;quot;Add new mapping&amp;quot;. Use the boxes to associate
paths to APIs and then click &amp;quot;Save&amp;quot;. Note that if the path is &lt;code class=&quot;css-0&quot;&gt;/endpoint&lt;/code&gt;,
you&amp;#x27;ll reach that API by calling &lt;code class=&quot;css-0&quot;&gt;your_domain/endpoint&lt;/code&gt;.&lt;/p&gt;&lt;h4 id=&quot;connect-cloudflare-to-that-api-gateway-domain&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#connect-cloudflare-to-that-api-gateway-domain&quot; aria-label=&quot;connect cloudflare to that api gateway domain permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Connect Cloudflare to that API Gateway domain&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Now you need to tell Cloudflare to route traffic from your custom domain name to
API Gateway. Make note of the &amp;quot;API Gateway domain name&amp;quot; on the API Gateway page
where you just added a custom domain. Then go back to the Cloudflare dashboard
and click the &amp;quot;DNS&amp;quot; tab. Then add a &lt;strong class=&quot;css-0&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;CNAME&lt;/code&gt;&lt;/strong&gt; record, where &amp;quot;Name&amp;quot; is the
subdomain name, and &amp;quot;Target&amp;quot; is that &amp;quot;API Gateway domain name&amp;quot;. Click &amp;quot;Save&amp;quot;.&lt;/p&gt;&lt;h4 id=&quot;set-ssl-to-full-strict&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#set-ssl-to-full-strict&quot; aria-label=&quot;set ssl to full strict permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Set SSL to Full (Strict)&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Last, you need to set your SSL mode to &amp;quot;Full (Strict)&amp;quot;. If you&amp;#x27;re ok with the
&lt;em class=&quot;css-0&quot;&gt;entire domain&lt;/em&gt; being &amp;quot;Full (Strict)&amp;quot;, you can go to &amp;quot;SSL/TLS&amp;quot; and switch the
encryption mode to &amp;quot;Full (Strict)&amp;quot;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I use the same base domain for traffic served directly from S3. Since S3 doesn&amp;#x27;t
support HTTPS traffic, I need to have Cloudflare&amp;#x27;s SSL setting set to Flexible,
which means that traffic is encrypted between the user and Cloudflare, but not
between Cloudflare and S3. However I need to serve traffic to AWS API Gateway
with HTTPS.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;To get around this, I add a Cloudflare page rule, so that just this API Gateway
traffic is set to &amp;quot;Full (Strict)&amp;quot;. Click the &amp;quot;Page Rules&amp;quot; tab, click &amp;quot;Create
Page Rule&amp;quot;, add a string matching your domain name(s). Then choose &amp;quot;SSL&amp;quot; as the
setting, and set the setting to &amp;quot;Full (Strict)&amp;quot;. Then click &amp;quot;Save and Deploy&amp;quot;.&lt;/p&gt;&lt;h3 id=&quot;conclusion&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#conclusion&quot; aria-label=&quot;conclusion permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Conclusion&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;You should now be able to access your API endpoint through your custom domain!
In order for Cloudflare to cache your content, you need to set applicable
&lt;code class=&quot;css-0&quot;&gt;Cache-Control&lt;/code&gt; headers, such as &lt;code class=&quot;css-0&quot;&gt;public,max-age=3600&lt;/code&gt;, to cache on both a
user&amp;#x27;s browser and on Cloudflare&amp;#x27;s server for a period of 1 hour. If the file
extension is not one &lt;a href=&quot;https://support.cloudflare.com/hc/en-us/articles/200172516-Understanding-Cloudflare-s-CDN#h_a01982d4-d5b6-4744-bb9b-a71da62c160a&quot; class=&quot;css-1od09yo&quot;&gt;cached by default&lt;/a&gt;, you&amp;#x27;ll need to set
a &amp;quot;Cache Everything&amp;quot; page rule.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;In order to find out if any given request was served from Cloudflare&amp;#x27;s cache,
you can inspect the &lt;code class=&quot;css-0&quot;&gt;cf-cache-status&lt;/code&gt; header on the response. If the value is
&lt;code class=&quot;css-0&quot;&gt;HIT&lt;/code&gt;, the asset was served from Cloudflare&amp;#x27;s cache.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;strong class=&quot;css-0&quot;&gt;Footnotes&lt;/strong&gt;:&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;If you use the HTTP API endpoints, you need the certificate to be in &lt;em class=&quot;css-0&quot;&gt;the same
region&lt;/em&gt; as the API. However that also means that if you have HTTP API&amp;#x27;s in two
separate regions, you can&amp;#x27;t use one domain for both. You&amp;#x27;ll have to create a
separate domain for each region. For the Cloudflare page rule, set an asterisk
like &lt;code class=&quot;css-0&quot;&gt;*lambda.domain&lt;/code&gt;, so that you can use one page rule for all subdomains.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[All Transit]]></title><link>https://kylebarron.dev/blog/all-transit</link><guid isPermaLink="false">https://kylebarron.dev/blog/all-transit</guid><pubDate>Mon, 24 Feb 2020 07:00:00 GMT</pubDate><content:encoded>&lt;style data-emotion-css=&quot;1hycliv&quot;&gt;body{--theme-ui-colors-transparent:var(--theme-ui-colors-transparent,transparent);--theme-ui-colors-black:var(--theme-ui-colors-black,#000);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-gray-0:var(--theme-ui-colors-gray-0,null);--theme-ui-colors-gray-1:var(--theme-ui-colors-gray-1,#f7fafc);--theme-ui-colors-gray-2:var(--theme-ui-colors-gray-2,#edf2f7);--theme-ui-colors-gray-3:var(--theme-ui-colors-gray-3,#e2e8f0);--theme-ui-colors-gray-4:var(--theme-ui-colors-gray-4,#cbd5e0);--theme-ui-colors-gray-5:var(--theme-ui-colors-gray-5,#a0aec0);--theme-ui-colors-gray-6:var(--theme-ui-colors-gray-6,#718096);--theme-ui-colors-gray-7:var(--theme-ui-colors-gray-7,#4a5568);--theme-ui-colors-gray-8:var(--theme-ui-colors-gray-8,#2d3748);--theme-ui-colors-gray-9:var(--theme-ui-colors-gray-9,#1a202c);--theme-ui-colors-red-0:var(--theme-ui-colors-red-0,null);--theme-ui-colors-red-1:var(--theme-ui-colors-red-1,#fff5f5);--theme-ui-colors-red-2:var(--theme-ui-colors-red-2,#fed7d7);--theme-ui-colors-red-3:var(--theme-ui-colors-red-3,#feb2b2);--theme-ui-colors-red-4:var(--theme-ui-colors-red-4,#fc8181);--theme-ui-colors-red-5:var(--theme-ui-colors-red-5,#f56565);--theme-ui-colors-red-6:var(--theme-ui-colors-red-6,#e53e3e);--theme-ui-colors-red-7:var(--theme-ui-colors-red-7,#c53030);--theme-ui-colors-red-8:var(--theme-ui-colors-red-8,#9b2c2c);--theme-ui-colors-red-9:var(--theme-ui-colors-red-9,#742a2a);--theme-ui-colors-orange-0:var(--theme-ui-colors-orange-0,null);--theme-ui-colors-orange-1:var(--theme-ui-colors-orange-1,#fffaf0);--theme-ui-colors-orange-2:var(--theme-ui-colors-orange-2,#feebc8);--theme-ui-colors-orange-3:var(--theme-ui-colors-orange-3,#fbd38d);--theme-ui-colors-orange-4:var(--theme-ui-colors-orange-4,#f6ad55);--theme-ui-colors-orange-5:var(--theme-ui-colors-orange-5,#ed8936);--theme-ui-colors-orange-6:var(--theme-ui-colors-orange-6,#dd6b20);--theme-ui-colors-orange-7:var(--theme-ui-colors-orange-7,#c05621);--theme-ui-colors-orange-8:var(--theme-ui-colors-orange-8,#9c4221);--theme-ui-colors-orange-9:var(--theme-ui-colors-orange-9,#7b341e);--theme-ui-colors-yellow-0:var(--theme-ui-colors-yellow-0,null);--theme-ui-colors-yellow-1:var(--theme-ui-colors-yellow-1,#fffff0);--theme-ui-colors-yellow-2:var(--theme-ui-colors-yellow-2,#fefcbf);--theme-ui-colors-yellow-3:var(--theme-ui-colors-yellow-3,#faf089);--theme-ui-colors-yellow-4:var(--theme-ui-colors-yellow-4,#f6e05e);--theme-ui-colors-yellow-5:var(--theme-ui-colors-yellow-5,#ecc94b);--theme-ui-colors-yellow-6:var(--theme-ui-colors-yellow-6,#d69e2e);--theme-ui-colors-yellow-7:var(--theme-ui-colors-yellow-7,#b7791f);--theme-ui-colors-yellow-8:var(--theme-ui-colors-yellow-8,#975a16);--theme-ui-colors-yellow-9:var(--theme-ui-colors-yellow-9,#744210);--theme-ui-colors-green-0:var(--theme-ui-colors-green-0,null);--theme-ui-colors-green-1:var(--theme-ui-colors-green-1,#f0fff4);--theme-ui-colors-green-2:var(--theme-ui-colors-green-2,#c6f6d5);--theme-ui-colors-green-3:var(--theme-ui-colors-green-3,#9ae6b4);--theme-ui-colors-green-4:var(--theme-ui-colors-green-4,#68d391);--theme-ui-colors-green-5:var(--theme-ui-colors-green-5,#48bb78);--theme-ui-colors-green-6:var(--theme-ui-colors-green-6,#38a169);--theme-ui-colors-green-7:var(--theme-ui-colors-green-7,#2f855a);--theme-ui-colors-green-8:var(--theme-ui-colors-green-8,#276749);--theme-ui-colors-green-9:var(--theme-ui-colors-green-9,#22543d);--theme-ui-colors-teal-0:var(--theme-ui-colors-teal-0,null);--theme-ui-colors-teal-1:var(--theme-ui-colors-teal-1,#e6fffa);--theme-ui-colors-teal-2:var(--theme-ui-colors-teal-2,#b2f5ea);--theme-ui-colors-teal-3:var(--theme-ui-colors-teal-3,#81e6d9);--theme-ui-colors-teal-4:var(--theme-ui-colors-teal-4,#4fd1c5);--theme-ui-colors-teal-5:var(--theme-ui-colors-teal-5,#38b2ac);--theme-ui-colors-teal-6:var(--theme-ui-colors-teal-6,#319795);--theme-ui-colors-teal-7:var(--theme-ui-colors-teal-7,#2c7a7b);--theme-ui-colors-teal-8:var(--theme-ui-colors-teal-8,#285e61);--theme-ui-colors-teal-9:var(--theme-ui-colors-teal-9,#234e52);--theme-ui-colors-blue-0:var(--theme-ui-colors-blue-0,null);--theme-ui-colors-blue-1:var(--theme-ui-colors-blue-1,#ebf8ff);--theme-ui-colors-blue-2:var(--theme-ui-colors-blue-2,#bee3f8);--theme-ui-colors-blue-3:var(--theme-ui-colors-blue-3,#90cdf4);--theme-ui-colors-blue-4:var(--theme-ui-colors-blue-4,#63b3ed);--theme-ui-colors-blue-5:var(--theme-ui-colors-blue-5,#4299e1);--theme-ui-colors-blue-6:var(--theme-ui-colors-blue-6,#3182ce);--theme-ui-colors-blue-7:var(--theme-ui-colors-blue-7,#2b6cb0);--theme-ui-colors-blue-8:var(--theme-ui-colors-blue-8,#2c5282);--theme-ui-colors-blue-9:var(--theme-ui-colors-blue-9,#2a4365);--theme-ui-colors-indigo-0:var(--theme-ui-colors-indigo-0,null);--theme-ui-colors-indigo-1:var(--theme-ui-colors-indigo-1,#ebf4ff);--theme-ui-colors-indigo-2:var(--theme-ui-colors-indigo-2,#c3dafe);--theme-ui-colors-indigo-3:var(--theme-ui-colors-indigo-3,#a3bffa);--theme-ui-colors-indigo-4:var(--theme-ui-colors-indigo-4,#7f9cf5);--theme-ui-colors-indigo-5:var(--theme-ui-colors-indigo-5,#667eea);--theme-ui-colors-indigo-6:var(--theme-ui-colors-indigo-6,#5a67d8);--theme-ui-colors-indigo-7:var(--theme-ui-colors-indigo-7,#4c51bf);--theme-ui-colors-indigo-8:var(--theme-ui-colors-indigo-8,#434190);--theme-ui-colors-indigo-9:var(--theme-ui-colors-indigo-9,#3c366b);--theme-ui-colors-purple-0:var(--theme-ui-colors-purple-0,null);--theme-ui-colors-purple-1:var(--theme-ui-colors-purple-1,#faf5ff);--theme-ui-colors-purple-2:var(--theme-ui-colors-purple-2,#e9d8fd);--theme-ui-colors-purple-3:var(--theme-ui-colors-purple-3,#d6bcfa);--theme-ui-colors-purple-4:var(--theme-ui-colors-purple-4,#b794f4);--theme-ui-colors-purple-5:var(--theme-ui-colors-purple-5,#9f7aea);--theme-ui-colors-purple-6:var(--theme-ui-colors-purple-6,#805ad5);--theme-ui-colors-purple-7:var(--theme-ui-colors-purple-7,#6b46c1);--theme-ui-colors-purple-8:var(--theme-ui-colors-purple-8,#553c9a);--theme-ui-colors-purple-9:var(--theme-ui-colors-purple-9,#44337a);--theme-ui-colors-pink-0:var(--theme-ui-colors-pink-0,null);--theme-ui-colors-pink-1:var(--theme-ui-colors-pink-1,#fff5f7);--theme-ui-colors-pink-2:var(--theme-ui-colors-pink-2,#fed7e2);--theme-ui-colors-pink-3:var(--theme-ui-colors-pink-3,#fbb6ce);--theme-ui-colors-pink-4:var(--theme-ui-colors-pink-4,#f687b3);--theme-ui-colors-pink-5:var(--theme-ui-colors-pink-5,#ed64a6);--theme-ui-colors-pink-6:var(--theme-ui-colors-pink-6,#d53f8c);--theme-ui-colors-pink-7:var(--theme-ui-colors-pink-7,#b83280);--theme-ui-colors-pink-8:var(--theme-ui-colors-pink-8,#97266d);--theme-ui-colors-pink-9:var(--theme-ui-colors-pink-9,#702459);--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#6b46c1);--theme-ui-colors-primaryHover:var(--theme-ui-colors-primaryHover,#2c5282);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#5f6c80);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-textMuted:var(--theme-ui-colors-textMuted,#718096);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-toggleIcon,#2d3748);--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000);--theme-ui-colors-divide:var(--theme-ui-colors-divide,#cbd5e0);color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#cbd5e0);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#9f7aea);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#7f8ea3);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-modes-dark-toggleIcon,#cbd5e0);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#1A202C);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);--theme-ui-colors-divide:var(--theme-ui-colors-modes-dark-divide,#2d3748);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#2d3748);}&lt;/style&gt;&lt;style data-emotion-css=&quot;15y10hy&quot;&gt;*{box-sizing:border-box;}body{margin:0;font-family:&quot;IBM Plex Sans&quot;,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;;line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;}&lt;/style&gt;&lt;style data-emotion-css=&quot;1bkk5q4&quot;&gt;.css-1bkk5q4{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-1bkk5q4{font-size:1rem;}}@media screen and (min-width:768px){.css-1bkk5q4{font-size:1.25rem;}}&lt;/style&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;style data-emotion-css=&quot;1od09yo&quot;&gt;.css-1od09yo{color:var(--theme-ui-colors-primary,#6b46c1);-webkit-text-decoration:none;text-decoration:none;}.css-1od09yo:hover{-webkit-text-decoration:underline;text-decoration:underline;}&lt;/style&gt;&lt;a href=&quot;https://all-transit.com&quot; class=&quot;css-1od09yo&quot;&gt;Interactive map&lt;/a&gt;&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Transit connects the densest cities but is also surprisingly prevalent in some
remote Western states. I wanted to find and display all these routes. Once I&amp;#x27;d
done that for the U.S., why not the world? This project visualizes data from the
&lt;a href=&quot;https://transit.land&quot; class=&quot;css-1od09yo&quot;&gt;Transitland&lt;/a&gt; project. The name alludes to &lt;a href=&quot;https://benfry.com/allstreets/map5.html&quot; class=&quot;css-1od09yo&quot;&gt;&lt;em class=&quot;css-0&quot;&gt;All
Streets&lt;/em&gt;&lt;/a&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://all-transit.com&quot; class=&quot;css-1od09yo&quot;&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:960px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:51.25000000000001%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABEklEQVQoz3WSb2+DIBDG/WwbIBZdEajaZG/3YlX+WJsl+/Y7ONTaZMlFD7nfPc+BBW0dka40QQz3UjlYMuWZchhp10JAssW2LPDFuzu/zLSFuiluxwSZGO/nEXNuvLiMNNXscN0HqiHxVEIg45AstRc9mpqYGt+aL9YelWvwrAP453qG6tL47L91YlhEvzBlqbKVupHzd9TYYGCa66MeFiI9keDKAhbhNF7VzSWQ0sJT9IGsnndlaFwZn04oez4cUhoEnHMT1ome4Hw8CUDZmOgAI+Qvyc629QJPu5R0NN6TT2QcG9VO2uFdbnoZhsuI8XGjSR8bpfFyRwLXqR1fYWh96pYij3T8Df6PXNZcf+Tn7x801swjd6T29QAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image css-0&quot; alt=&quot;All transit in the continental U.S.&quot; title=&quot;All transit in the continental U.S.&quot; src=&quot;/static/8e0b9329622f43e8fa10f3bbe572b849/7d769/us.png&quot; srcSet=&quot;/static/8e0b9329622f43e8fa10f3bbe572b849/5243c/us.png 240w,/static/8e0b9329622f43e8fa10f3bbe572b849/ab158/us.png 480w,/static/8e0b9329622f43e8fa10f3bbe572b849/7d769/us.png 960w,/static/8e0b9329622f43e8fa10f3bbe572b849/87339/us.png 1440w,/static/8e0b9329622f43e8fa10f3bbe572b849/88b03/us.png 1920w,/static/8e0b9329622f43e8fa10f3bbe572b849/be6f4/us.png 7800w&quot; sizes=&quot;(max-width: 960px) 100vw, 960px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The schedule animation is my favorite part of the project. If you zoom into a
city (currently U.S. only) you can see streaks moving around that correspond to
transit vehicles: trains, buses, ferries. This data takes actual schedule
information from the Transitland API and matches it to route geometries.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;a href=&quot;https://all-transit.com/#14.73/42.35435/-71.0638/31.8/46&quot; class=&quot;css-1od09yo&quot;&gt;&lt;span class=&quot;gatsby-resp-image-wrapper&quot; style=&quot;position:relative;display:block;margin-left:auto;margin-right:auto;max-width:960px&quot;&gt;
      &lt;span class=&quot;gatsby-resp-image-background-image&quot; style=&quot;padding-bottom:83.33333333333334%;position:relative;bottom:0;left:0;background-image:url(&amp;#x27;data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAADZ0lEQVQ4y01U13biMBT0TyWQArjJcpHlBgESmm0wNWXPnv3+2ZHZh33QAWw0mnZlRfEKtljBj3eI8j2SfAdVNvD1GU72C7b+gZ92kNkeIr9hFO0xFBsMxBqP/goP3n09eh/9suz4AC+q8eqtMZI1Ir1DnG3wNl9gNt8SrEWUbSHzE0TWwSH4KG4xlA0GBBr+twYuAd2MTPSJTK54kQc8+w0mYYuQbHW1gco3iIoWXnqEq/Zwk5rs97BVh+dg14MY4AHZGeaWn39BFN9cP3DTC8YEc5IDJpTmqRO8/IhAN1wtjBo7Jsuk64GdpCGJGg/OO17CBuP4DMvRN/gE9PjppgTQFzjqQsAOdnTgQUfKPkKmO3jJjsyopj/wACda811DVSsSqXlICyvMLhCKG9MzPfqEn33RpxvGkfHr1HvnEMSw8lQDSbleduoBRLSg/CNeghrPDEnwuWXSlPTRABmWgrIFGQn6GpdHhPqAgCEIyo31FqFiaASVyQo6YzvIKkw3cOWcdmxheQzDM8zyT5jvIic4l60/EZU3Ah7hmCZQZsxwjPRIrVktA9RiPH4nIQbG2jnuzITywwQvXF0P5Jdf9PQLLg+QJUH5bBIzmMywJtv8woNaJn5ksg2GTyUmT0uMkjMeGU6fsmHoGS+LK4KCsotPuLTAZVjp4sQKXcho3zO9W3Nkdz/ImiRMWIOCw7HHmL8t14RBVk52xYSnmiCEYVGdkXKFRcceMmkmrIumb4IT75HmdV+roPqGlEvI0Udvk9Wz03d2Dj0c8ZRs1kEVNcbyXnKXZpt+ZgWrkjBhWpDkHYJkSwJXuAywEgvYQR/KuQec0IOovKCc3afB9MylxAnr4Sj+hwqkNhNz7kEE9+UcSQNuc38VvyF/0ARM7z1TxQnLxQEpvbKjpi+zrcha3RBPb5B8b5J2+dzLv+nlGfM5Lw29gR9QsjuHsNe8HCjBTw8oy5q+mMKSYbiGLXdM/Zse/UFQXtnJPWuyRZouUeoZSlWhiuZIoncG1OBVtP9mOSYb3jZjf0sPKC/c4TUgKA1OqisSAi2nU0yTDImcIYrfkRM4YDBmAILqN8LpldK7fp/1Nq2R5S2vL/rG28PmpeDTr6Q6oVAl5iqDVgse1PWTNKGfYX6FnpkR5ZRVvxByAAQvkKHzgb/wCJb6cM2dgAAAAABJRU5ErkJggg==&amp;#x27;);background-size:cover;display:block&quot;&gt;&lt;/span&gt;
  &lt;img class=&quot;gatsby-resp-image-image css-0&quot; alt=&quot;Boston schedule animation&quot; title=&quot;Boston schedule animation&quot; src=&quot;/static/cd25a6d1907a389fdf9c9e9c6989e175/7d769/boston_schedule_animation.png&quot; srcSet=&quot;/static/cd25a6d1907a389fdf9c9e9c6989e175/5243c/boston_schedule_animation.png 240w,/static/cd25a6d1907a389fdf9c9e9c6989e175/ab158/boston_schedule_animation.png 480w,/static/cd25a6d1907a389fdf9c9e9c6989e175/7d769/boston_schedule_animation.png 960w,/static/cd25a6d1907a389fdf9c9e9c6989e175/87339/boston_schedule_animation.png 1440w,/static/cd25a6d1907a389fdf9c9e9c6989e175/88b03/boston_schedule_animation.png 1920w,/static/cd25a6d1907a389fdf9c9e9c6989e175/d43d8/boston_schedule_animation.png 1954w&quot; sizes=&quot;(max-width: 960px) 100vw, 960px&quot; style=&quot;width:100%;height:100%;margin:0;vertical-align:middle;position:absolute;top:0;left:0&quot; loading=&quot;lazy&quot;/&gt;
    &lt;/span&gt;&lt;/a&gt;&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This rest of this blog post gives an overview of how the map is made.&lt;/p&gt;&lt;style data-emotion-css=&quot;1u9n620&quot;&gt;.css-1u9n620{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.5rem;margin-top:1rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1u9n620{font-size:1.875rem;}}@media screen and (min-width:768px){.css-1u9n620{font-size:2.25rem;}}&lt;/style&gt;&lt;h3 id=&quot;transitland&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#transitland&quot; aria-label=&quot;transitland permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Transitland&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I use the &lt;a href=&quot;https://transit.land&quot; class=&quot;css-1od09yo&quot;&gt;Transitland&lt;/a&gt; project as my data source, which
compiles &lt;a href=&quot;https://gtfs.org/&quot; class=&quot;css-1od09yo&quot;&gt;GTFS feeds&lt;/a&gt; from around the world, and harmonizes
the data into a single dataset. You can read more about why that&amp;#x27;s important
&lt;a href=&quot;https://transit.land/documentation/onestop-id-scheme/&quot; class=&quot;css-1od09yo&quot;&gt;here&lt;/a&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Transitland serves &lt;em class=&quot;css-0&quot;&gt;static&lt;/em&gt; transit information; it does not currently support
GTFS real time feeds (&lt;a href=&quot;https://github.com/transitland/transitland/issues/77&quot; class=&quot;css-1od09yo&quot;&gt;but could in the
future&lt;/a&gt;). Their data model
is split into five components: &lt;em class=&quot;css-0&quot;&gt;Operators&lt;/em&gt;, &lt;em class=&quot;css-0&quot;&gt;Routes&lt;/em&gt;, &lt;em class=&quot;css-0&quot;&gt;RouteStopPatterns&lt;/em&gt;,
&lt;em class=&quot;css-0&quot;&gt;Stops&lt;/em&gt;, and &lt;em class=&quot;css-0&quot;&gt;ScheduleStopPatterns&lt;/em&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;An &lt;em class=&quot;css-0&quot;&gt;operator&lt;/em&gt; is a transit agency that offers services to the general public
along fixed routes. A &lt;em class=&quot;css-0&quot;&gt;route&lt;/em&gt; contains all information about a single transit
service as defined by the transit agency. A route can be a bit of a nebulous
topic, since often a single name has several branches. A &lt;em class=&quot;css-0&quot;&gt;RouteStopPattern&lt;/em&gt;
decomposes each route into a single linear geometry. A route can be defined by
one or many RouteStopPatterns. A &lt;em class=&quot;css-0&quot;&gt;stop&lt;/em&gt; is each point along a route or
RouteStopPattern where passengers may get on or off. A &lt;em class=&quot;css-0&quot;&gt;ScheduleStopPattern&lt;/em&gt;
contains schedule information for each individual edge of the route. So if a
route has 10 stops in a line, there will be 9 ScheduleStopPattern data points
for each transit service scheduled along that route.&lt;/p&gt;&lt;h3 id=&quot;download&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#download&quot; aria-label=&quot;download permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Download&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Currently, Transitland doesn&amp;#x27;t offer bulk downloads. In order to download all
the data I had to find the best way to find and store all the data through their
API endpoints, which they have for each of the five categories enumerated above.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Each of API endpoint allows for a geographic bounding box. At first, I tried to
just pass a bounding box of the entire United States to each endpoint and
download results a page at a time. Unsurprisingly, that method isn&amp;#x27;t successful
for the endpoints that have more data to return, like stops and schedules,
because each API request has a timeout of 120 seconds, and it takes a while to
find and return the unindexed one-millionth row in a database. &lt;sup id=&quot;fnref-1&quot;&gt;&lt;a href=&quot;#fn-1&quot; class=&quot;footnote-ref css-1od09yo&quot;&gt;1&lt;/a&gt;&lt;/sup&gt;&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;  It might be possible to use the database indexes better by providing the
&lt;a href=&quot;https://github.com/transitland/transitland-datastore/issues/1254#issuecomment-424813471&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;min_id&lt;/code&gt; query
parameter&lt;/a&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Because of this, I found it best in general to split API queries into smaller
pieces, by using e.g. operator or route identifiers. I ended up downloading
routes, route stop patterns, and stops by operator and schedule data by route. I
wrote a &lt;a href=&quot;https://github.com/kylebarron/transitland_wrapper&quot; class=&quot;css-1od09yo&quot;&gt;Python/CLI wrapper&lt;/a&gt; for accessing the Transitland
database, to help with providing geometries and paging through all results.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;strong class=&quot;css-0&quot;&gt;N.B.&lt;/strong&gt; I currently am hosting bulk downloads of the data I collected for the
project. You can find appropriate links on the &lt;a href=&quot;https://all-transit.com/about&quot; class=&quot;css-1od09yo&quot;&gt;About
page&lt;/a&gt; of the project.&lt;/p&gt;&lt;h3 id=&quot;data-analysis&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#data-analysis&quot; aria-label=&quot;data analysis permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Data Analysis&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Most of the data-generating code for this project is done in Bash,
&lt;a href=&quot;https://stedolan.github.io/jq/&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;jq&lt;/code&gt;&lt;/a&gt;, GNU Parallel, SQLite, and a couple
Python scripts. In general, data is kept in &lt;em class=&quot;css-0&quot;&gt;newline-delimited JSON&lt;/em&gt; and
&lt;em class=&quot;css-0&quot;&gt;newline-delimited GeoJSON&lt;/em&gt; for all intermediate steps to facilitate streaming
and keep memory use low. However, I found that the schedule data was large
enough to necessitate transitioning to SQLite.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Operator, route, and stop information is encoded into &lt;a href=&quot;https://docs.mapbox.com/vector-tiles/reference/&quot; class=&quot;css-1od09yo&quot;&gt;Mapbox Vector Tiles&lt;/a&gt;
using &lt;a href=&quot;https://github.com/mapbox/tippecanoe&quot; class=&quot;css-1od09yo&quot;&gt;Tippecanoe&lt;/a&gt;. I use &lt;code class=&quot;css-0&quot;&gt;jq&lt;/code&gt; to reshape the source GeoJSON to keep
only necessary attributes of each Feature.&lt;/p&gt;&lt;style data-emotion-css=&quot;1slx2ud&quot;&gt;.css-1slx2ud{font-family:inherit;font-weight:700;line-height:1.25;margin:0;margin-bottom:0.25rem;font-size:1.25rem;color:var(--theme-ui-colors-heading,#000);}@media screen and (min-width:640px){.css-1slx2ud{font-size:1.5rem;}}@media screen and (min-width:768px){.css-1slx2ud{font-size:1.875rem;}}&lt;/style&gt;&lt;h4 id=&quot;schedule-data&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#schedule-data&quot; aria-label=&quot;schedule data permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Schedule data&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Schedule data from Transitland doesn&amp;#x27;t have a geometric component. In order to
connect schedules to geometries, you need to match the schedule data to the
routes &lt;em class=&quot;css-0&quot;&gt;and&lt;/em&gt; stops data.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;If you match schedule data just to routes, you have no way of knowing where
along the route the two stops are, and if you match schedule data just to stops,
you have no knowledge of the geometry between those two points.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Since some schedule data is missing links to route stop patterns, I first tried
to use &lt;em class=&quot;css-0&quot;&gt;just&lt;/em&gt; the routes data. For each schedule stop pair, I found the &lt;code class=&quot;css-0&quot;&gt;Point&lt;/code&gt;
geometries of its start and end stops, found the nearest points on the route for
each of those stops, and retrieved the geometry between those two stops.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This can be problematic, however, because routes can have complex geometries.
For example, metro lines in Chicago might be represented geometrically as a
loop; starting in the suburbs, going downtown around The Loop, and back to the
suburbs. When I use this process to match the schedule stop pair to the route, I
sometimes match one stop to the first end of the route, and the other stop to
the other end of the route. This caused my program to think that the train went
to downtown Chicago and back in one minute, and the animation looked haywire
depicting a train moving through Chicago at 600 miles per hour.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Helpfully, most (though not all) schedule data is also linked to a route stop
pattern, and the schedule data also generally has linear referencing distances
along that route stop pattern. So for example, a schedule stop pair might say
that the origin stop is 100 (meters) along the route stop pattern&amp;#x27;s geometry and
that the destination stop is 900 (meters) along its geometry. This allows for a
much more accurate way of finding schedule geometries. I take the route stop
pattern, project it into a local coordinate system with units in meters (I use
the local &lt;a href=&quot;https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system&quot; class=&quot;css-1od09yo&quot;&gt;UTM zone&lt;/a&gt;), and then cut the route stop pattern&amp;#x27;s
&lt;code class=&quot;css-0&quot;&gt;LineString&lt;/code&gt; geometry using those two distances using Shapely&amp;#x27;s &lt;a href=&quot;https://shapely.readthedocs.io/en/stable/manual.html#substring&quot; class=&quot;css-1od09yo&quot;&gt;linear
referencing methods&lt;/a&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Once I have a geometry for that schedule, I linearly interpolate timestamps
along each coordinate between start and end. I export this data as GeoJSON
&lt;code class=&quot;css-0&quot;&gt;Feature&lt;/code&gt;s, where each geometry is a &lt;code class=&quot;css-0&quot;&gt;LineString&lt;/code&gt; with three-dimensional
coordinates: longitude, latitude, and time.&lt;/p&gt;&lt;h4 id=&quot;schedule-tiles&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#schedule-tiles&quot; aria-label=&quot;schedule tiles permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Schedule tiles&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Now that I have these three-dimensional geometries, I need to figure out the
best way to transport them to the client. Unfortunately, at this time Tippecanoe
&lt;a href=&quot;https://github.com/mapbox/tippecanoe/issues/714&quot; class=&quot;css-1od09yo&quot;&gt;doesn&amp;#x27;t support three-dimensional coordinates&lt;/a&gt;. The
recommendation in that thread was to reformat to have individual points with
properties. That would make it harder to associate the points to lines, however.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I decided to go with a custom data format; essentially tiled, gzipped, minified,
JSON. Since I know that all features are &lt;code class=&quot;css-0&quot;&gt;LineStrings&lt;/code&gt;, and since I have no
properties that I care about, I keep only the line&amp;#x27;s coordinates. The verbose
depiction of the data the client receives:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;json&quot;&gt;&lt;pre class=&quot;prism-code language-json&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;false&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;// First LineString&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;// Coordinate of LineString&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;            &lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;// Coordinate of LineString&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;            &lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;// Second LineString&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;        ...&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;]&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;In order to make the data download manageable, I cut each JSON into xyz map
tiles, so that only data pertaining to the current viewport is loaded. For dense
cities with high frequency transit like Washington DC and New York City, some
tiles can still be quite large. I cut the schedule tiles into full resolution at
zoom 13, and then generate overview tiles for lower zooms that contain a
fraction of the features of their child tiles.&lt;/p&gt;&lt;h3 id=&quot;website&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#website&quot; aria-label=&quot;website permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Website&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;All portions of the website are self-hosted. The website itself is static and
hosted on Github Pages. The map tiles come from &lt;a href=&quot;https://openmaptiles.org/&quot; class=&quot;css-1od09yo&quot;&gt;OpenMapTiles&lt;/a&gt; and
are served with &lt;a href=&quot;https://github.com/consbio/mbtileserver&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;mbtileserver&lt;/code&gt;&lt;/a&gt; on a Google Cloud f1-micro
instance. I have map tiles set to cache through Cloudflare to hopefully cope
fine with any spikes in demand. Vector tiles with operator, route, and stop
information are also hosted on the Google Cloud instance. The JSON tiles I use
for the schedule animation are currently hosted on AWS S3.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The website is coded with React and JavaScript, using Gatsby as the static site
generator. I use React Map GL/Mapbox GL JS for rendering the basemap and the
routes layer. I use Deck.gl&amp;#x27;s &lt;a href=&quot;https://deck.gl/#/documentation/deckgl-api-reference/layers/trips-layer&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;TripsLayer&lt;/code&gt;&lt;/a&gt; on top for rendering
the schedule animation.&lt;/p&gt;&lt;h3 id=&quot;performance&quot; style=&quot;position:relative&quot; class=&quot;css-1u9n620&quot;&gt;&lt;a href=&quot;#performance&quot; aria-label=&quot;performance permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Performance&lt;/h3&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Although performance still isn&amp;#x27;t as good as I&amp;#x27;d like on lower-powered and mobile
devices, it&amp;#x27;s better than where I started.&lt;/p&gt;&lt;h4 id=&quot;minimize-data-downloads&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#minimize-data-downloads&quot; aria-label=&quot;minimize data downloads permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Minimize data downloads&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The source data for routes and especially for schedule information is huge. In
order to serve this data over a web map, they need to be compressed and sliced
into smaller pieces to download. This is why &lt;a href=&quot;https://en.wikipedia.org/wiki/Tiled_web_map&quot; class=&quot;css-1od09yo&quot;&gt;map tiling&lt;/a&gt; exists.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I use &lt;a href=&quot;https://docs.mapbox.com/vector-tiles/reference/&quot; class=&quot;css-1od09yo&quot;&gt;Mapbox Vector Tiles&lt;/a&gt; for transmitting operator, route, and stop data
to the client. Vector tiles are great because they&amp;#x27;re highly compressible, and
really easy to create with &lt;a href=&quot;https://github.com/mapbox/tippecanoe&quot; class=&quot;css-1od09yo&quot;&gt;Tippecanoe&lt;/a&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;In order to keep the size of the vector tiles small, the &lt;code class=&quot;css-0&quot;&gt;stops&lt;/code&gt; layer is
omitted until zoom 11, and the &lt;code class=&quot;css-0&quot;&gt;routes&lt;/code&gt; layer omits metadata about the stops on
each route until zoom 11. (The maximum zoom level of data in the vector tiles is
11, but the data will display past zoom 11 thanks to overzooming.)&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;&lt;em class=&quot;css-0&quot;&gt;Unfortunately&lt;/em&gt;, Tippecanoe only supports 2D data at this time. This means that
I had to develop my own solution for getting the schedule data to the client,
because I need a third dimension on those geometries (longitude, latitude,
time). For the time being I&amp;#x27;ve settled on tiled, gzipped, minified, JSON. Since
I know that all schedule data are &lt;code class=&quot;css-0&quot;&gt;LineString&lt;/code&gt;s, I keep only the geometry part
of the GeoJSON, and don&amp;#x27;t transmit any properties data about each &lt;code class=&quot;css-0&quot;&gt;Feature&lt;/code&gt; to
the client.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Since I couldn&amp;#x27;t use Tippecanoe for generating these JSON tiles, I developed my
own workflow for cutting GeoJSON features into tiles. I chose a reasonably high
zoom level, 13, which contains all schedule data in the selected time period in
full resolution. For lower zooms, I take a random fraction of a tile&amp;#x27;s children
tiles to keep tile sizes reasonable.&lt;/p&gt;&lt;h4 id=&quot;minimize-data-updates&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#minimize-data-updates&quot; aria-label=&quot;minimize data updates permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Minimize data updates&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I render invisble operator service area polygons so that I can easily find the
operators whose service area is in the viewbox. However I&amp;#x27;ve found that
constantly updating the list of nearby operators when panning can impact
performance, so instead I only compute that list when the operators option panel
is open.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I also turn off the schedule animation when the current zoom is below the
minimum zoom at which I show the animation. I&amp;#x27;m not sure how much this helps
performance because the Deck.gl &lt;code class=&quot;css-0&quot;&gt;TileLayer&lt;/code&gt; already is invisble below that zoom
threshold, but it can&amp;#x27;t hurt.&lt;/p&gt;&lt;h4 id=&quot;deckgl-optimizations&quot; style=&quot;position:relative&quot; class=&quot;css-1slx2ud&quot;&gt;&lt;a href=&quot;#deckgl-optimizations&quot; aria-label=&quot;deckgl optimizations permalink&quot; class=&quot;anchor before css-1od09yo&quot;&gt;&lt;svg aria-hidden=&quot;true&quot; focusable=&quot;false&quot; height=&quot;16&quot; version=&quot;1.1&quot; viewBox=&quot;0 0 16 16&quot; width=&quot;16&quot;&gt;&lt;path fill-rule=&quot;evenodd&quot; d=&quot;M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z&quot;&gt;&lt;/path&gt;&lt;/svg&gt;&lt;/a&gt;Deck.gl optimizations&lt;/h4&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Deck.gl has a &lt;a href=&quot;https://deck.gl/#/documentation/developer-guide/performance-optimization&quot; class=&quot;css-1od09yo&quot;&gt;page in its documentation&lt;/a&gt; detailing
strategies for improving performance.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I set &lt;code class=&quot;css-0&quot;&gt;useDevicePixels&lt;/code&gt; to &lt;code class=&quot;css-0&quot;&gt;false&lt;/code&gt;. When &lt;code class=&quot;css-0&quot;&gt;true&lt;/code&gt;, this prop tells Deck.gl to
render at double the resolution on a high DPI display, which means that it must
do 4x the pixel computations. When the animation is more important than the
crispness of the map rendering, set this to &lt;code class=&quot;css-0&quot;&gt;false&lt;/code&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I also attempted to use precomputed binary attributes but hit some errors and
decided it wasn&amp;#x27;t worth it to debug right now. In the future I&amp;#x27;d like to figure
out how to use binary data directly.&lt;/p&gt;&lt;div class=&quot;footnotes css-0&quot;&gt;&lt;style data-emotion-css=&quot;1ldi06f&quot;&gt;.css-1ldi06f{background-color:var(--theme-ui-colors-muted,#e2e8f0);border:0;height:1px;margin:1rem;}&lt;/style&gt;&lt;hr class=&quot;css-1ldi06f&quot;/&gt;&lt;style data-emotion-css=&quot;15rlv7r&quot;&gt;.css-15rlv7r li{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-15rlv7r li{font-size:1rem;}}@media screen and (min-width:768px){.css-15rlv7r li{font-size:1.25rem;}}&lt;/style&gt;&lt;ol class=&quot;css-15rlv7r&quot;&gt;&lt;li id=&quot;fn-1&quot; class=&quot;css-0&quot;&gt;&lt;a href=&quot;#fnref-1&quot; class=&quot;footnote-backref css-1od09yo&quot;&gt;↩&lt;/a&gt;&lt;/li&gt;&lt;/ol&gt;&lt;/div&gt;</content:encoded></item><item><title><![CDATA[New Website]]></title><link>https://kylebarron.dev/blog/new-website</link><guid isPermaLink="false">https://kylebarron.dev/blog/new-website</guid><pubDate>Mon, 17 Feb 2020 07:00:00 GMT</pubDate><content:encoded>&lt;style data-emotion-css=&quot;1hycliv&quot;&gt;body{--theme-ui-colors-transparent:var(--theme-ui-colors-transparent,transparent);--theme-ui-colors-black:var(--theme-ui-colors-black,#000);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-gray-0:var(--theme-ui-colors-gray-0,null);--theme-ui-colors-gray-1:var(--theme-ui-colors-gray-1,#f7fafc);--theme-ui-colors-gray-2:var(--theme-ui-colors-gray-2,#edf2f7);--theme-ui-colors-gray-3:var(--theme-ui-colors-gray-3,#e2e8f0);--theme-ui-colors-gray-4:var(--theme-ui-colors-gray-4,#cbd5e0);--theme-ui-colors-gray-5:var(--theme-ui-colors-gray-5,#a0aec0);--theme-ui-colors-gray-6:var(--theme-ui-colors-gray-6,#718096);--theme-ui-colors-gray-7:var(--theme-ui-colors-gray-7,#4a5568);--theme-ui-colors-gray-8:var(--theme-ui-colors-gray-8,#2d3748);--theme-ui-colors-gray-9:var(--theme-ui-colors-gray-9,#1a202c);--theme-ui-colors-red-0:var(--theme-ui-colors-red-0,null);--theme-ui-colors-red-1:var(--theme-ui-colors-red-1,#fff5f5);--theme-ui-colors-red-2:var(--theme-ui-colors-red-2,#fed7d7);--theme-ui-colors-red-3:var(--theme-ui-colors-red-3,#feb2b2);--theme-ui-colors-red-4:var(--theme-ui-colors-red-4,#fc8181);--theme-ui-colors-red-5:var(--theme-ui-colors-red-5,#f56565);--theme-ui-colors-red-6:var(--theme-ui-colors-red-6,#e53e3e);--theme-ui-colors-red-7:var(--theme-ui-colors-red-7,#c53030);--theme-ui-colors-red-8:var(--theme-ui-colors-red-8,#9b2c2c);--theme-ui-colors-red-9:var(--theme-ui-colors-red-9,#742a2a);--theme-ui-colors-orange-0:var(--theme-ui-colors-orange-0,null);--theme-ui-colors-orange-1:var(--theme-ui-colors-orange-1,#fffaf0);--theme-ui-colors-orange-2:var(--theme-ui-colors-orange-2,#feebc8);--theme-ui-colors-orange-3:var(--theme-ui-colors-orange-3,#fbd38d);--theme-ui-colors-orange-4:var(--theme-ui-colors-orange-4,#f6ad55);--theme-ui-colors-orange-5:var(--theme-ui-colors-orange-5,#ed8936);--theme-ui-colors-orange-6:var(--theme-ui-colors-orange-6,#dd6b20);--theme-ui-colors-orange-7:var(--theme-ui-colors-orange-7,#c05621);--theme-ui-colors-orange-8:var(--theme-ui-colors-orange-8,#9c4221);--theme-ui-colors-orange-9:var(--theme-ui-colors-orange-9,#7b341e);--theme-ui-colors-yellow-0:var(--theme-ui-colors-yellow-0,null);--theme-ui-colors-yellow-1:var(--theme-ui-colors-yellow-1,#fffff0);--theme-ui-colors-yellow-2:var(--theme-ui-colors-yellow-2,#fefcbf);--theme-ui-colors-yellow-3:var(--theme-ui-colors-yellow-3,#faf089);--theme-ui-colors-yellow-4:var(--theme-ui-colors-yellow-4,#f6e05e);--theme-ui-colors-yellow-5:var(--theme-ui-colors-yellow-5,#ecc94b);--theme-ui-colors-yellow-6:var(--theme-ui-colors-yellow-6,#d69e2e);--theme-ui-colors-yellow-7:var(--theme-ui-colors-yellow-7,#b7791f);--theme-ui-colors-yellow-8:var(--theme-ui-colors-yellow-8,#975a16);--theme-ui-colors-yellow-9:var(--theme-ui-colors-yellow-9,#744210);--theme-ui-colors-green-0:var(--theme-ui-colors-green-0,null);--theme-ui-colors-green-1:var(--theme-ui-colors-green-1,#f0fff4);--theme-ui-colors-green-2:var(--theme-ui-colors-green-2,#c6f6d5);--theme-ui-colors-green-3:var(--theme-ui-colors-green-3,#9ae6b4);--theme-ui-colors-green-4:var(--theme-ui-colors-green-4,#68d391);--theme-ui-colors-green-5:var(--theme-ui-colors-green-5,#48bb78);--theme-ui-colors-green-6:var(--theme-ui-colors-green-6,#38a169);--theme-ui-colors-green-7:var(--theme-ui-colors-green-7,#2f855a);--theme-ui-colors-green-8:var(--theme-ui-colors-green-8,#276749);--theme-ui-colors-green-9:var(--theme-ui-colors-green-9,#22543d);--theme-ui-colors-teal-0:var(--theme-ui-colors-teal-0,null);--theme-ui-colors-teal-1:var(--theme-ui-colors-teal-1,#e6fffa);--theme-ui-colors-teal-2:var(--theme-ui-colors-teal-2,#b2f5ea);--theme-ui-colors-teal-3:var(--theme-ui-colors-teal-3,#81e6d9);--theme-ui-colors-teal-4:var(--theme-ui-colors-teal-4,#4fd1c5);--theme-ui-colors-teal-5:var(--theme-ui-colors-teal-5,#38b2ac);--theme-ui-colors-teal-6:var(--theme-ui-colors-teal-6,#319795);--theme-ui-colors-teal-7:var(--theme-ui-colors-teal-7,#2c7a7b);--theme-ui-colors-teal-8:var(--theme-ui-colors-teal-8,#285e61);--theme-ui-colors-teal-9:var(--theme-ui-colors-teal-9,#234e52);--theme-ui-colors-blue-0:var(--theme-ui-colors-blue-0,null);--theme-ui-colors-blue-1:var(--theme-ui-colors-blue-1,#ebf8ff);--theme-ui-colors-blue-2:var(--theme-ui-colors-blue-2,#bee3f8);--theme-ui-colors-blue-3:var(--theme-ui-colors-blue-3,#90cdf4);--theme-ui-colors-blue-4:var(--theme-ui-colors-blue-4,#63b3ed);--theme-ui-colors-blue-5:var(--theme-ui-colors-blue-5,#4299e1);--theme-ui-colors-blue-6:var(--theme-ui-colors-blue-6,#3182ce);--theme-ui-colors-blue-7:var(--theme-ui-colors-blue-7,#2b6cb0);--theme-ui-colors-blue-8:var(--theme-ui-colors-blue-8,#2c5282);--theme-ui-colors-blue-9:var(--theme-ui-colors-blue-9,#2a4365);--theme-ui-colors-indigo-0:var(--theme-ui-colors-indigo-0,null);--theme-ui-colors-indigo-1:var(--theme-ui-colors-indigo-1,#ebf4ff);--theme-ui-colors-indigo-2:var(--theme-ui-colors-indigo-2,#c3dafe);--theme-ui-colors-indigo-3:var(--theme-ui-colors-indigo-3,#a3bffa);--theme-ui-colors-indigo-4:var(--theme-ui-colors-indigo-4,#7f9cf5);--theme-ui-colors-indigo-5:var(--theme-ui-colors-indigo-5,#667eea);--theme-ui-colors-indigo-6:var(--theme-ui-colors-indigo-6,#5a67d8);--theme-ui-colors-indigo-7:var(--theme-ui-colors-indigo-7,#4c51bf);--theme-ui-colors-indigo-8:var(--theme-ui-colors-indigo-8,#434190);--theme-ui-colors-indigo-9:var(--theme-ui-colors-indigo-9,#3c366b);--theme-ui-colors-purple-0:var(--theme-ui-colors-purple-0,null);--theme-ui-colors-purple-1:var(--theme-ui-colors-purple-1,#faf5ff);--theme-ui-colors-purple-2:var(--theme-ui-colors-purple-2,#e9d8fd);--theme-ui-colors-purple-3:var(--theme-ui-colors-purple-3,#d6bcfa);--theme-ui-colors-purple-4:var(--theme-ui-colors-purple-4,#b794f4);--theme-ui-colors-purple-5:var(--theme-ui-colors-purple-5,#9f7aea);--theme-ui-colors-purple-6:var(--theme-ui-colors-purple-6,#805ad5);--theme-ui-colors-purple-7:var(--theme-ui-colors-purple-7,#6b46c1);--theme-ui-colors-purple-8:var(--theme-ui-colors-purple-8,#553c9a);--theme-ui-colors-purple-9:var(--theme-ui-colors-purple-9,#44337a);--theme-ui-colors-pink-0:var(--theme-ui-colors-pink-0,null);--theme-ui-colors-pink-1:var(--theme-ui-colors-pink-1,#fff5f7);--theme-ui-colors-pink-2:var(--theme-ui-colors-pink-2,#fed7e2);--theme-ui-colors-pink-3:var(--theme-ui-colors-pink-3,#fbb6ce);--theme-ui-colors-pink-4:var(--theme-ui-colors-pink-4,#f687b3);--theme-ui-colors-pink-5:var(--theme-ui-colors-pink-5,#ed64a6);--theme-ui-colors-pink-6:var(--theme-ui-colors-pink-6,#d53f8c);--theme-ui-colors-pink-7:var(--theme-ui-colors-pink-7,#b83280);--theme-ui-colors-pink-8:var(--theme-ui-colors-pink-8,#97266d);--theme-ui-colors-pink-9:var(--theme-ui-colors-pink-9,#702459);--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#6b46c1);--theme-ui-colors-primaryHover:var(--theme-ui-colors-primaryHover,#2c5282);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#5f6c80);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-textMuted:var(--theme-ui-colors-textMuted,#718096);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-toggleIcon,#2d3748);--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000);--theme-ui-colors-divide:var(--theme-ui-colors-divide,#cbd5e0);color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#cbd5e0);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#9f7aea);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#7f8ea3);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-modes-dark-toggleIcon,#cbd5e0);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#1A202C);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);--theme-ui-colors-divide:var(--theme-ui-colors-modes-dark-divide,#2d3748);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#2d3748);}&lt;/style&gt;&lt;style data-emotion-css=&quot;15y10hy&quot;&gt;*{box-sizing:border-box;}body{margin:0;font-family:&quot;IBM Plex Sans&quot;,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;;line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;}&lt;/style&gt;&lt;style data-emotion-css=&quot;1bkk5q4&quot;&gt;.css-1bkk5q4{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-1bkk5q4{font-size:1rem;}}@media screen and (min-width:768px){.css-1bkk5q4{font-size:1.25rem;}}&lt;/style&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;After a few years of having a semi-dead &lt;style data-emotion-css=&quot;1od09yo&quot;&gt;.css-1od09yo{color:var(--theme-ui-colors-primary,#6b46c1);-webkit-text-decoration:none;text-decoration:none;}.css-1od09yo:hover{-webkit-text-decoration:underline;text-decoration:underline;}&lt;/style&gt;&lt;a href=&quot;https://jekyllrb.com/&quot; class=&quot;css-1od09yo&quot;&gt;Jekyll&lt;/a&gt;-based website, I&amp;#x27;m happy to transition to a new website based on &lt;a href=&quot;https://www.gatsbyjs.org/&quot; class=&quot;css-1od09yo&quot;&gt;GatsbyJS&lt;/a&gt;.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I&amp;#x27;m excited for this switch because I can incorporate some cool new technologies
into the site. For example, &lt;a href=&quot;https://github.com/kylebarron/kylebarron.github.io/blob/source/content/posts/new-website/index.mdx&quot; class=&quot;css-1od09yo&quot;&gt;this post&lt;/a&gt; is written in &lt;a href=&quot;https://mdxjs.com/&quot; class=&quot;css-1od09yo&quot;&gt;&lt;em class=&quot;css-0&quot;&gt;MDX&lt;/em&gt;&lt;/a&gt;,
which allows you to combine the simplicity of Markdown with the flexibility of
React.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;For example, I can have editable code snippets that accept updates from the user, like this:&lt;/p&gt;&lt;div data-name=&quot;live-editor&quot; style=&quot;position:relative;text-align:left;box-sizing:border-box;padding:0;overflow:hidden;white-space:pre;font-family:monospace;color:#d6deeb;background-color:#011627&quot;&gt;&lt;textarea style=&quot;margin:0;border:0;background:none;box-sizing:inherit;display:inherit;font-family:inherit;font-size:inherit;font-style:inherit;font-variant-ligatures:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;tab-size:inherit;text-indent:inherit;text-rendering:inherit;text-transform:inherit;white-space:pre-wrap;word-break:keep-all;overflow-wrap:break-word;position:absolute;top:0;left:0;height:100%;width:100%;resize:none;color:inherit;overflow:hidden;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased;-webkit-text-fill-color:transparent;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px&quot; class=&quot;npm__react-simple-code-editor__textarea&quot; autoCapitalize=&quot;off&quot; autoComplete=&quot;off&quot; autoCorrect=&quot;off&quot; spellcheck=&quot;false&quot; data-gramm=&quot;false&quot;&gt;const onClick = () =&amp;gt; {
  alert(&amp;quot;Change this text&amp;quot;);
};
render(&amp;lt;button onClick={onClick}&amp;gt;Click me!&amp;lt;/button&amp;gt;);&lt;/textarea&gt;&lt;pre aria-hidden=&quot;true&quot; style=&quot;margin:0;border:0;background:none;box-sizing:inherit;display:inherit;font-family:inherit;font-size:inherit;font-style:inherit;font-variant-ligatures:inherit;font-weight:inherit;letter-spacing:inherit;line-height:inherit;tab-size:inherit;text-indent:inherit;text-rendering:inherit;text-transform:inherit;white-space:pre-wrap;word-break:keep-all;overflow-wrap:break-word;position:relative;pointer-events:none;padding-top:10px;padding-right:10px;padding-bottom:10px;padding-left:10px&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token keyword&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;const&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token function-variable function&quot; style=&quot;color:rgb(130, 170, 255)&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;  &lt;/span&gt;&lt;span class=&quot;token function&quot; style=&quot;color:rgb(130, 170, 255)&quot;&gt;alert&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot; style=&quot;color:rgb(173, 219, 103)&quot;&gt;&amp;quot;Change this text&amp;quot;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token function&quot; style=&quot;color:rgb(130, 170, 255)&quot;&gt;render&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;token tag&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;button&lt;/span&gt;&lt;span class=&quot;token tag&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token tag attr-name&quot; style=&quot;color:rgb(173, 219, 103);font-style:italic&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript script-punctuation punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;onClick&lt;/span&gt;&lt;span class=&quot;token tag script language-javascript punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;Click me&lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;&amp;lt;/&lt;/span&gt;&lt;span class=&quot;token tag&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;button&lt;/span&gt;&lt;span class=&quot;token tag punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;style type=&quot;text/css&quot;&gt;
/**
 * Reset the text fill color so that placeholder is visible
 */
.npm__react-simple-code-editor__textarea:empty {
  -webkit-text-fill-color: inherit !important;
}

/**
 * Hack to apply on some CSS on IE10 and IE11
 */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
  /**
    * IE doesn&apos;t support &apos;-webkit-text-fill-color&apos;
    * So we use &apos;color: transparent&apos; to make the text transparent on IE
    * Unlike other browsers, it doesn&apos;t affect caret color in IE
    */
  .npm__react-simple-code-editor__textarea {
    color: transparent !important;
  }

  .npm__react-simple-code-editor__textarea::selection {
    background-color: #accef7 !important;
    color: transparent !important;
  }
}
&lt;/style&gt;&lt;/div&gt;&lt;div data-name=&quot;live-preview&quot;&gt;&lt;button&gt;Click me!&lt;/button&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Update &lt;code class=&quot;css-0&quot;&gt;Change this text&lt;/code&gt;, click the button, and you can see the text you just
put in!&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;I&amp;#x27;m using &lt;a href=&quot;https://www.gatsbyjs.org/starters/lekoarts/gatsby-starter-minimal-blog/&quot; class=&quot;css-1od09yo&quot;&gt;this starter&lt;/a&gt;, which helped to get everything set up.
The website is hosted on Github Pages, and builds and deploys automatically on
every new commit using Travis CI, so I can just write and commit! Everything is
open source at &lt;a href=&quot;https://github.com/kylebarron/kylebarron.github.io&quot; class=&quot;css-1od09yo&quot;&gt;https://github.com/kylebarron/kylebarron.github.io&lt;/a&gt;.&lt;/p&gt;</content:encoded></item><item><title><![CDATA[Reading Stata files with Python]]></title><link>https://kylebarron.dev/blog/reading-stata-files-with-python</link><guid isPermaLink="false">https://kylebarron.dev/blog/reading-stata-files-with-python</guid><pubDate>Mon, 08 Jan 2018 07:00:00 GMT</pubDate><content:encoded>&lt;style data-emotion-css=&quot;1hycliv&quot;&gt;body{--theme-ui-colors-transparent:var(--theme-ui-colors-transparent,transparent);--theme-ui-colors-black:var(--theme-ui-colors-black,#000);--theme-ui-colors-white:var(--theme-ui-colors-white,#fff);--theme-ui-colors-gray-0:var(--theme-ui-colors-gray-0,null);--theme-ui-colors-gray-1:var(--theme-ui-colors-gray-1,#f7fafc);--theme-ui-colors-gray-2:var(--theme-ui-colors-gray-2,#edf2f7);--theme-ui-colors-gray-3:var(--theme-ui-colors-gray-3,#e2e8f0);--theme-ui-colors-gray-4:var(--theme-ui-colors-gray-4,#cbd5e0);--theme-ui-colors-gray-5:var(--theme-ui-colors-gray-5,#a0aec0);--theme-ui-colors-gray-6:var(--theme-ui-colors-gray-6,#718096);--theme-ui-colors-gray-7:var(--theme-ui-colors-gray-7,#4a5568);--theme-ui-colors-gray-8:var(--theme-ui-colors-gray-8,#2d3748);--theme-ui-colors-gray-9:var(--theme-ui-colors-gray-9,#1a202c);--theme-ui-colors-red-0:var(--theme-ui-colors-red-0,null);--theme-ui-colors-red-1:var(--theme-ui-colors-red-1,#fff5f5);--theme-ui-colors-red-2:var(--theme-ui-colors-red-2,#fed7d7);--theme-ui-colors-red-3:var(--theme-ui-colors-red-3,#feb2b2);--theme-ui-colors-red-4:var(--theme-ui-colors-red-4,#fc8181);--theme-ui-colors-red-5:var(--theme-ui-colors-red-5,#f56565);--theme-ui-colors-red-6:var(--theme-ui-colors-red-6,#e53e3e);--theme-ui-colors-red-7:var(--theme-ui-colors-red-7,#c53030);--theme-ui-colors-red-8:var(--theme-ui-colors-red-8,#9b2c2c);--theme-ui-colors-red-9:var(--theme-ui-colors-red-9,#742a2a);--theme-ui-colors-orange-0:var(--theme-ui-colors-orange-0,null);--theme-ui-colors-orange-1:var(--theme-ui-colors-orange-1,#fffaf0);--theme-ui-colors-orange-2:var(--theme-ui-colors-orange-2,#feebc8);--theme-ui-colors-orange-3:var(--theme-ui-colors-orange-3,#fbd38d);--theme-ui-colors-orange-4:var(--theme-ui-colors-orange-4,#f6ad55);--theme-ui-colors-orange-5:var(--theme-ui-colors-orange-5,#ed8936);--theme-ui-colors-orange-6:var(--theme-ui-colors-orange-6,#dd6b20);--theme-ui-colors-orange-7:var(--theme-ui-colors-orange-7,#c05621);--theme-ui-colors-orange-8:var(--theme-ui-colors-orange-8,#9c4221);--theme-ui-colors-orange-9:var(--theme-ui-colors-orange-9,#7b341e);--theme-ui-colors-yellow-0:var(--theme-ui-colors-yellow-0,null);--theme-ui-colors-yellow-1:var(--theme-ui-colors-yellow-1,#fffff0);--theme-ui-colors-yellow-2:var(--theme-ui-colors-yellow-2,#fefcbf);--theme-ui-colors-yellow-3:var(--theme-ui-colors-yellow-3,#faf089);--theme-ui-colors-yellow-4:var(--theme-ui-colors-yellow-4,#f6e05e);--theme-ui-colors-yellow-5:var(--theme-ui-colors-yellow-5,#ecc94b);--theme-ui-colors-yellow-6:var(--theme-ui-colors-yellow-6,#d69e2e);--theme-ui-colors-yellow-7:var(--theme-ui-colors-yellow-7,#b7791f);--theme-ui-colors-yellow-8:var(--theme-ui-colors-yellow-8,#975a16);--theme-ui-colors-yellow-9:var(--theme-ui-colors-yellow-9,#744210);--theme-ui-colors-green-0:var(--theme-ui-colors-green-0,null);--theme-ui-colors-green-1:var(--theme-ui-colors-green-1,#f0fff4);--theme-ui-colors-green-2:var(--theme-ui-colors-green-2,#c6f6d5);--theme-ui-colors-green-3:var(--theme-ui-colors-green-3,#9ae6b4);--theme-ui-colors-green-4:var(--theme-ui-colors-green-4,#68d391);--theme-ui-colors-green-5:var(--theme-ui-colors-green-5,#48bb78);--theme-ui-colors-green-6:var(--theme-ui-colors-green-6,#38a169);--theme-ui-colors-green-7:var(--theme-ui-colors-green-7,#2f855a);--theme-ui-colors-green-8:var(--theme-ui-colors-green-8,#276749);--theme-ui-colors-green-9:var(--theme-ui-colors-green-9,#22543d);--theme-ui-colors-teal-0:var(--theme-ui-colors-teal-0,null);--theme-ui-colors-teal-1:var(--theme-ui-colors-teal-1,#e6fffa);--theme-ui-colors-teal-2:var(--theme-ui-colors-teal-2,#b2f5ea);--theme-ui-colors-teal-3:var(--theme-ui-colors-teal-3,#81e6d9);--theme-ui-colors-teal-4:var(--theme-ui-colors-teal-4,#4fd1c5);--theme-ui-colors-teal-5:var(--theme-ui-colors-teal-5,#38b2ac);--theme-ui-colors-teal-6:var(--theme-ui-colors-teal-6,#319795);--theme-ui-colors-teal-7:var(--theme-ui-colors-teal-7,#2c7a7b);--theme-ui-colors-teal-8:var(--theme-ui-colors-teal-8,#285e61);--theme-ui-colors-teal-9:var(--theme-ui-colors-teal-9,#234e52);--theme-ui-colors-blue-0:var(--theme-ui-colors-blue-0,null);--theme-ui-colors-blue-1:var(--theme-ui-colors-blue-1,#ebf8ff);--theme-ui-colors-blue-2:var(--theme-ui-colors-blue-2,#bee3f8);--theme-ui-colors-blue-3:var(--theme-ui-colors-blue-3,#90cdf4);--theme-ui-colors-blue-4:var(--theme-ui-colors-blue-4,#63b3ed);--theme-ui-colors-blue-5:var(--theme-ui-colors-blue-5,#4299e1);--theme-ui-colors-blue-6:var(--theme-ui-colors-blue-6,#3182ce);--theme-ui-colors-blue-7:var(--theme-ui-colors-blue-7,#2b6cb0);--theme-ui-colors-blue-8:var(--theme-ui-colors-blue-8,#2c5282);--theme-ui-colors-blue-9:var(--theme-ui-colors-blue-9,#2a4365);--theme-ui-colors-indigo-0:var(--theme-ui-colors-indigo-0,null);--theme-ui-colors-indigo-1:var(--theme-ui-colors-indigo-1,#ebf4ff);--theme-ui-colors-indigo-2:var(--theme-ui-colors-indigo-2,#c3dafe);--theme-ui-colors-indigo-3:var(--theme-ui-colors-indigo-3,#a3bffa);--theme-ui-colors-indigo-4:var(--theme-ui-colors-indigo-4,#7f9cf5);--theme-ui-colors-indigo-5:var(--theme-ui-colors-indigo-5,#667eea);--theme-ui-colors-indigo-6:var(--theme-ui-colors-indigo-6,#5a67d8);--theme-ui-colors-indigo-7:var(--theme-ui-colors-indigo-7,#4c51bf);--theme-ui-colors-indigo-8:var(--theme-ui-colors-indigo-8,#434190);--theme-ui-colors-indigo-9:var(--theme-ui-colors-indigo-9,#3c366b);--theme-ui-colors-purple-0:var(--theme-ui-colors-purple-0,null);--theme-ui-colors-purple-1:var(--theme-ui-colors-purple-1,#faf5ff);--theme-ui-colors-purple-2:var(--theme-ui-colors-purple-2,#e9d8fd);--theme-ui-colors-purple-3:var(--theme-ui-colors-purple-3,#d6bcfa);--theme-ui-colors-purple-4:var(--theme-ui-colors-purple-4,#b794f4);--theme-ui-colors-purple-5:var(--theme-ui-colors-purple-5,#9f7aea);--theme-ui-colors-purple-6:var(--theme-ui-colors-purple-6,#805ad5);--theme-ui-colors-purple-7:var(--theme-ui-colors-purple-7,#6b46c1);--theme-ui-colors-purple-8:var(--theme-ui-colors-purple-8,#553c9a);--theme-ui-colors-purple-9:var(--theme-ui-colors-purple-9,#44337a);--theme-ui-colors-pink-0:var(--theme-ui-colors-pink-0,null);--theme-ui-colors-pink-1:var(--theme-ui-colors-pink-1,#fff5f7);--theme-ui-colors-pink-2:var(--theme-ui-colors-pink-2,#fed7e2);--theme-ui-colors-pink-3:var(--theme-ui-colors-pink-3,#fbb6ce);--theme-ui-colors-pink-4:var(--theme-ui-colors-pink-4,#f687b3);--theme-ui-colors-pink-5:var(--theme-ui-colors-pink-5,#ed64a6);--theme-ui-colors-pink-6:var(--theme-ui-colors-pink-6,#d53f8c);--theme-ui-colors-pink-7:var(--theme-ui-colors-pink-7,#b83280);--theme-ui-colors-pink-8:var(--theme-ui-colors-pink-8,#97266d);--theme-ui-colors-pink-9:var(--theme-ui-colors-pink-9,#702459);--theme-ui-colors-grayDark:var(--theme-ui-colors-grayDark,#2d3748);--theme-ui-colors-text:var(--theme-ui-colors-text,#2d3748);--theme-ui-colors-background:var(--theme-ui-colors-background,#fff);--theme-ui-colors-primary:var(--theme-ui-colors-primary,#6b46c1);--theme-ui-colors-primaryHover:var(--theme-ui-colors-primaryHover,#2c5282);--theme-ui-colors-secondary:var(--theme-ui-colors-secondary,#5f6c80);--theme-ui-colors-muted:var(--theme-ui-colors-muted,#e2e8f0);--theme-ui-colors-success:var(--theme-ui-colors-success,#9ae6b4);--theme-ui-colors-info:var(--theme-ui-colors-info,#63b3ed);--theme-ui-colors-warning:var(--theme-ui-colors-warning,#faf089);--theme-ui-colors-danger:var(--theme-ui-colors-danger,#feb2b2);--theme-ui-colors-light:var(--theme-ui-colors-light,#f7fafc);--theme-ui-colors-dark:var(--theme-ui-colors-dark,#2d3748);--theme-ui-colors-textMuted:var(--theme-ui-colors-textMuted,#718096);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-toggleIcon,#2d3748);--theme-ui-colors-heading:var(--theme-ui-colors-heading,#000);--theme-ui-colors-divide:var(--theme-ui-colors-divide,#cbd5e0);color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);}body.theme-ui-dark{--theme-ui-colors-text:var(--theme-ui-colors-modes-dark-text,#cbd5e0);--theme-ui-colors-primary:var(--theme-ui-colors-modes-dark-primary,#9f7aea);--theme-ui-colors-secondary:var(--theme-ui-colors-modes-dark-secondary,#7f8ea3);--theme-ui-colors-toggleIcon:var(--theme-ui-colors-modes-dark-toggleIcon,#cbd5e0);--theme-ui-colors-background:var(--theme-ui-colors-modes-dark-background,#1A202C);--theme-ui-colors-heading:var(--theme-ui-colors-modes-dark-heading,#fff);--theme-ui-colors-divide:var(--theme-ui-colors-modes-dark-divide,#2d3748);--theme-ui-colors-muted:var(--theme-ui-colors-modes-dark-muted,#2d3748);}&lt;/style&gt;&lt;style data-emotion-css=&quot;15y10hy&quot;&gt;*{box-sizing:border-box;}body{margin:0;font-family:&quot;IBM Plex Sans&quot;,-apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,&quot;Helvetica Neue&quot;,Arial,&quot;Noto Sans&quot;,sans-serif,&quot;Apple Color Emoji&quot;,&quot;Segoe UI Emoji&quot;,&quot;Segoe UI Symbol&quot;,&quot;Noto Color Emoji&quot;;line-height:1.625;font-weight:400;color:var(--theme-ui-colors-text,#2d3748);background-color:var(--theme-ui-colors-background,#fff);padding:0;box-sizing:border-box;text-rendering:optimizeLegibility;}&lt;/style&gt;&lt;style data-emotion-css=&quot;1bkk5q4&quot;&gt;.css-1bkk5q4{font-size:1rem;-webkit-letter-spacing:-0.003em;-moz-letter-spacing:-0.003em;-ms-letter-spacing:-0.003em;letter-spacing:-0.003em;line-height:1.625;--baseline-multiplier:0.179;--x-height-multiplier:0.35;}@media screen and (min-width:640px){.css-1bkk5q4{font-size:1rem;}}@media screen and (min-width:768px){.css-1bkk5q4{font-size:1.25rem;}}&lt;/style&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Stata is fine for the small stuff, but Python is way better for anything
intensive. However, you&amp;#x27;ll often have data in Stata&amp;#x27;s &lt;code class=&quot;css-0&quot;&gt;.dta&lt;/code&gt; format that you
need to read. This post will detail the nice features available in Python&amp;#x27;s
Stata import.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;We&amp;#x27;ll use the 1978 Automobile Data that comes with Stata. First export this data into a file in your working directory:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;stata&quot;&gt;&lt;pre class=&quot;prism-code language-stata&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;sysuse auto&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;save &amp;quot;auto.dta&amp;quot;, replace&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Now open up Python. First import Pandas, the module in Python used to work with rectangular data frames.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token keyword&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;import&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; pandas &lt;/span&gt;&lt;span class=&quot;token keyword&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;as&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; pd&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The most straightforward way to import a Stata file is a single line:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;auto &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; pd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;read_stata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot; style=&quot;color:rgb(173, 219, 103)&quot;&gt;&amp;#x27;auto.dta&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This is really simple, and is fine for small files, but with larger files, you often need to finesse your data import.
Imagine you have a 100GB Stata file. For most computers, that&amp;#x27;s too big to import into memory.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;First we need to create an &lt;em class=&quot;css-0&quot;&gt;iterator&lt;/em&gt;, which reads the metadata attached to the &lt;code class=&quot;css-0&quot;&gt;.dta&lt;/code&gt; file, but importantly doesn&amp;#x27;t read the data itself yet.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; pd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;read_stata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot; style=&quot;color:rgb(173, 219, 103)&quot;&gt;&amp;#x27;auto.dta&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; iterator &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token boolean&quot; style=&quot;color:rgb(255, 88, 116)&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Now it&amp;#x27;s possible to read in just a chunk of the data at a time.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;auto &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;get_chunk&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;You can also easily loop over the data like so:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; pd&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;read_stata&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token string&quot; style=&quot;color:rgb(173, 219, 103)&quot;&gt;&amp;#x27;auto.dta&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; iterator &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token boolean&quot; style=&quot;color:rgb(255, 88, 116)&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; chunksize &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; &lt;/span&gt;&lt;span class=&quot;token number&quot; style=&quot;color:rgb(247, 140, 108)&quot;&gt;10&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token keyword&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;for&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; df &lt;/span&gt;&lt;span class=&quot;token keyword&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;in&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;    &lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;# Program operating on 10 rows of the dataset at a time&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Now without importing the file, we can get the data label, number of observations, number of variables, and the timestamp at which the data were last saved.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;data_label&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;nobs&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;nvar&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;time_stamp&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;If we want to see the names and labels of the variables, we can use&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;varlist&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;variable_labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Note that &lt;code class=&quot;css-0&quot;&gt;itr.variable_labels()&lt;/code&gt; returns a dictionary where the keys of the dictionary are the variable names and the values of the dictionary are the variable labels. So we can access the labels with something like:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;labels &lt;/span&gt;&lt;span class=&quot;token operator&quot; style=&quot;color:rgb(127, 219, 202)&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt; itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;variable_labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;# Gets the label of `mpg`&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;token string&quot; style=&quot;color:rgb(173, 219, 103)&quot;&gt;&amp;#x27;mpg&amp;#x27;&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;# Gets all keys&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;keys&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;6&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;span class=&quot;token comment&quot; style=&quot;color:rgb(99, 119, 119);font-style:italic&quot;&gt;# Gets all values&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;labels&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;values&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;)&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;If you&amp;#x27;re working with a large dataset that might run up against memory constraints, you might want to keep in mind exactly how much memory the imported data will take up.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;You can get a list of the number of bytes each column takes up with the &lt;code class=&quot;css-0&quot;&gt;col_sizes&lt;/code&gt; method:&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;col_sizes&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;So in &lt;code class=&quot;css-0&quot;&gt;auto.dta&lt;/code&gt;, the first column takes up 18 bytes for each row, while the rest of the columns take up between 1 and 4 bytes.&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Lets get a better idea of what data types these columns are.&lt;/p&gt;&lt;div class=&quot;gatsby-highlight&quot; data-language=&quot;python&quot;&gt;&lt;pre class=&quot;prism-code language-python&quot; style=&quot;color:#d6deeb;background-color:#011627&quot; data-linenumber=&quot;true&quot;&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;dtyplist&lt;/span&gt;&lt;/div&gt;&lt;div class=&quot;token-line&quot; style=&quot;color:#d6deeb&quot;&gt;&lt;span class=&quot;line-number-style&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;itr&lt;/span&gt;&lt;span class=&quot;token punctuation&quot; style=&quot;color:rgb(199, 146, 234)&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;token plain&quot;&gt;fmtlist&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The former shows you the data types that will be used in Python upon import and the latter shows the display formats the data had used in Stata (see &lt;style data-emotion-css=&quot;1od09yo&quot;&gt;.css-1od09yo{color:var(--theme-ui-colors-primary,#6b46c1);-webkit-text-decoration:none;text-decoration:none;}.css-1od09yo:hover{-webkit-text-decoration:underline;text-decoration:underline;}&lt;/style&gt;&lt;a href=&quot;https://www.stata.com/help.cgi?format&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;help format&lt;/code&gt;&lt;/a&gt;).&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;From &lt;code class=&quot;css-0&quot;&gt;itr.dtyplist&lt;/code&gt;, we can see that the first column is a string of length 18, while the rest are types &lt;code class=&quot;css-0&quot;&gt;numpy.int8&lt;/code&gt;, &lt;code class=&quot;css-0&quot;&gt;numpy.int16&lt;/code&gt;, and &lt;code class=&quot;css-0&quot;&gt;numpy.float32&lt;/code&gt;. These data types come from &lt;a href=&quot;http://www.numpy.org/&quot; class=&quot;css-1od09yo&quot;&gt;Numpy&lt;/a&gt;, a scientific library that Pandas is based upon, and correspond to Stata&amp;#x27;s &lt;code class=&quot;css-0&quot;&gt;byte&lt;/code&gt;, &lt;code class=&quot;css-0&quot;&gt;int&lt;/code&gt;, and &lt;code class=&quot;css-0&quot;&gt;float&lt;/code&gt;, respectively (see Stata&amp;#x27;s &lt;a href=&quot;https://www.stata.com/help.cgi?datatypes&quot; class=&quot;css-1od09yo&quot;&gt;&lt;code class=&quot;css-0&quot;&gt;help data types&lt;/code&gt;&lt;/a&gt;).&lt;/p&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;The size of the data in memory is almost exactly the number of rows times the sum of the number of bytes needed for each row. I.e. if the number of rows is&lt;/p&gt;&lt;span&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;N&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.10903em;&quot;&gt;N&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;and the number of bytes each column uses is&lt;/p&gt;&lt;span&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;B_{col}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.83333em;vertical-align:-0.15em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.01968em;&quot;&gt;l&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;then the total memory use of the dataset is&lt;/p&gt;&lt;span&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mi&gt;N&lt;/mi&gt;&lt;mo&gt;∗&lt;/mo&gt;&lt;msub&gt;&lt;mo&gt;∑&lt;/mo&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;msub&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mrow&gt;&lt;mi&gt;c&lt;/mi&gt;&lt;mi&gt;o&lt;/mi&gt;&lt;mi&gt;l&lt;/mi&gt;&lt;/mrow&gt;&lt;/msub&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;N * \sum_{col} B_{col}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.10903em;&quot;&gt;N&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;∗&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:1.0497100000000001em;vertical-align:-0.29971000000000003em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mop&quot;&gt;&lt;span class=&quot;mop op-symbol small-op&quot; style=&quot;position:relative;top:-0.0000050000000000050004em;&quot;&gt;∑&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.1863979999999999em;&quot;&gt;&lt;span style=&quot;top:-2.40029em;margin-left:0em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.01968em;&quot;&gt;l&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.29971000000000003em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.16666666666666666em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;msupsub&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.33610799999999996em;&quot;&gt;&lt;span style=&quot;top:-2.5500000000000003em;margin-left:-0.05017em;margin-right:0.05em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:2.7em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;sizing reset-size6 size3 mtight&quot;&gt;&lt;span class=&quot;mord mtight&quot;&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot;&gt;o&lt;/span&gt;&lt;span class=&quot;mord mathdefault mtight&quot; style=&quot;margin-right:0.01968em;&quot;&gt;l&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.15em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;This can be helpful with understanding how many rows of a file to import at once. Let&amp;#x27;s say you want to not use more than 1GB of memory at once. If you want to import all columns of &lt;code class=&quot;css-0&quot;&gt;auto.dta&lt;/code&gt;, each row takes up &lt;code class=&quot;css-0&quot;&gt;sum(itr.col_sizes)&lt;/code&gt; = 43 bytes. So the number of rows you can import at a time is&lt;/p&gt;&lt;div&gt;&lt;span class=&quot;katex-display&quot;&gt;&lt;span class=&quot;katex&quot;&gt;&lt;span class=&quot;katex-mathml&quot;&gt;&lt;math xmlns=&quot;http://www.w3.org/1998/Math/MathML&quot;&gt;&lt;semantics&gt;&lt;mrow&gt;&lt;mn&gt;1024&lt;/mn&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;mo&gt;∗&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;1024&lt;/mn&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;M&lt;/mi&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;∗&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;1024&lt;/mn&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mi&gt;K&lt;/mi&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;∗&lt;/mo&gt;&lt;mfrac&gt;&lt;mrow&gt;&lt;mn&gt;1&lt;/mn&gt;&lt;mtext&gt; row&lt;/mtext&gt;&lt;/mrow&gt;&lt;mrow&gt;&lt;mn&gt;43&lt;/mn&gt;&lt;mi&gt;B&lt;/mi&gt;&lt;/mrow&gt;&lt;/mfrac&gt;&lt;mo&gt;≈&lt;/mo&gt;&lt;mn&gt;25&lt;/mn&gt;&lt;mtext&gt; million rows&lt;/mtext&gt;&lt;/mrow&gt;&lt;annotation encoding=&quot;application/x-tex&quot;&gt;1024 MB * \frac{1024 KB}{1 MB} * \frac{1024 B}{1 KB} * \frac{1 \text{ row}}{43 B} \approx 25 \text{ million rows}&lt;/annotation&gt;&lt;/semantics&gt;&lt;/math&gt;&lt;/span&gt;&lt;span class=&quot;katex-html&quot; aria-hidden=&quot;true&quot;&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.68333em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.10903em;&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;∗&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.04633em;vertical-align:-0.686em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.36033em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.10903em;&quot;&gt;M&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.07153em;&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.686em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;∗&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.04633em;vertical-align:-0.686em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.36033em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.07153em;&quot;&gt;K&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.686em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mbin&quot;&gt;∗&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2222222222222222em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:2.00744em;vertical-align:-0.686em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mopen nulldelimiter&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mfrac&quot;&gt;&lt;span class=&quot;vlist-t vlist-t2&quot;&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:1.32144em;&quot;&gt;&lt;span style=&quot;top:-2.314em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;4&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;mord mathdefault&quot; style=&quot;margin-right:0.05017em;&quot;&gt;B&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.23em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;frac-line&quot; style=&quot;border-bottom-width:0.04em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span style=&quot;top:-3.677em;&quot;&gt;&lt;span class=&quot;pstrut&quot; style=&quot;height:3em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;&lt;span class=&quot;mord&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;mord text&quot;&gt;&lt;span class=&quot;mord&quot;&gt; row&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-s&quot;&gt;​&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;vlist-r&quot;&gt;&lt;span class=&quot;vlist&quot; style=&quot;height:0.686em;&quot;&gt;&lt;span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mclose nulldelimiter&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mrel&quot;&gt;≈&lt;/span&gt;&lt;span class=&quot;mspace&quot; style=&quot;margin-right:0.2777777777777778em;&quot;&gt;&lt;/span&gt;&lt;/span&gt;&lt;span class=&quot;base&quot;&gt;&lt;span class=&quot;strut&quot; style=&quot;height:0.69444em;vertical-align:0em;&quot;&gt;&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;mord&quot;&gt;5&lt;/span&gt;&lt;span class=&quot;mord text&quot;&gt;&lt;span class=&quot;mord&quot;&gt; million rows&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/span&gt;&lt;/div&gt;&lt;p class=&quot;css-1bkk5q4&quot;&gt;Obviously with the &lt;code class=&quot;css-0&quot;&gt;auto.dta&lt;/code&gt; dataset we don&amp;#x27;t need to add restrictions on rows or columns, but in datasets with columns -- especially those with many string columns -- you might not be able to read in your whole dataset at once.&lt;/p&gt;</content:encoded></item></channel></rss>