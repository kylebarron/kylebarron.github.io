{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/blog/caching-lambda-functions-cloudflare","result":{"data":{"post":{"__typename":"MdxPost","slug":"/blog/caching-lambda-functions-cloudflare","title":"Cache AWS Lambda responses with Cloudflare","date":"April 28th, 2020","tags":[{"name":"Serverless","slug":"serverless"}],"description":null,"body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"Cache AWS Lambda responses with Cloudflare\",\n  \"date\": \"2020-04-28T00:00:00.000Z\",\n  \"slug\": \"/blog/caching-lambda-functions-cloudflare\",\n  \"tags\": [\"Serverless\"]\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://www.cloudflare.com/\"\n  }), \"Cloudflare\"), \" is a Content Delivery Network (CDN), a global network\\nof servers that cache responses from websites so that those responses can load\\nmore quickly for future website visitors. A CDN has dual benefits: your website\\nbecomes faster for your visitors, but \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"also\"), \" fewer traffic reaches your origin\\nweb server, reducing load. For Cloudflare specifically, they have a generous\\nfree tier, so for most personal projects, it's more than enough for my needs.\"), mdx(\"p\", null, \"I'm building some projects around AWS Lambda, a powerful serverless platform\\nthat allows you to respond to network requests in a completely scalable way.\\nWhen your traffic is zero, your costs are zero, but if your website goes viral,\\nyou'll be able to scale to a huge number of requests quickly.\"), mdx(\"p\", null, \"Cloudflare is especially helpful alongside AWS Lambda because pricing is done\\nper request, so the fewer requests that reach your Lambda function, the cheaper\\nit'll be to run.\"), mdx(\"p\", null, \"This post is a high-level overview of how to connect Lambda and Cloudflare.\"), mdx(\"h3\", {\n    \"id\": \"overview\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#overview\",\n    \"aria-label\": \"overview permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Overview\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stackoverflow.com/a/45849093\"\n  }), \"This StackOverflow answer\"), \" on connecting API Gateway\\nto Cloudflare is extremely helpful, so much of this post is essentially\\nrehashing that answer for my future reference.\"), mdx(\"h4\", {\n    \"id\": \"set-up-cloudflare\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#set-up-cloudflare\",\n    \"aria-label\": \"set up cloudflare permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Set up Cloudflare\"), mdx(\"p\", null, \"First you need to set up a Cloudflare account and attach a domain you own. This\\nis relatively self-explanatory. Go to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://cloudflare.com\"\n  }), \"https://cloudflare.com\"), \", sign up, and\\nfollow their instructions for attaching your domain name and pointing your DNS\\ntowards Cloudflare's nameservers.\"), mdx(\"h4\", {\n    \"id\": \"create-certificate\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#create-certificate\",\n    \"aria-label\": \"create certificate permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Create certificate\"), mdx(\"p\", null, \"Since API Gateway requires all outbound traffic to be encrypted, you need to\\ncreate an SSL certificate to upload to AWS to tell how to encrypt your data. The\\nsimplest way to create this certificate is through the Cloudflare dashboard.\\nCloudflare will helpfully also renew the certificate as needed.\"), mdx(\"p\", null, \"Go to your website in Cloudflare's UI and then choose \\\"SSL/TLS\\\" > \\\"Origin\\nServer\\\". Then click \\\"Create Certificate\\\".\"), mdx(\"p\", null, \"The only thing you need to change is the hostnames field. Since I'll put my\\nendpoints at \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"lambda.kylebarron.dev/*\"), \", I enter the following hostnames:\"), mdx(\"p\", null, mdx(\"span\", _extends({\n    parentName: \"p\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"23.333333333333332%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAABYlAAAWJQFJUiTwAAAA3ElEQVQY022QyW6DQBBE5/8/K5ZixQth33cwWLFBYj9Wujux5YMPT9VT1VODUEEYwvN9wQ8C2I4j6riueGEUCa7nic+87rPPc14UuHcdlGGacvmBZdtS6tIsShfYNy0LJu0eTyecNQ26YUj2reuil6bBz+0G9bHb4XO/x9fh8Bf+F3EBlzP8elXXSLMMWZ6LPuYkTWXmnfZ6hSqrCmVZilGQNm0rFFzCGcGvD+OIbduwritW1teZlRinCSqKYyRJ8qSmL+GSiP4bn2PKY9Ku77EsC6Z5fstM2TCM+AUweGlTBdmpagAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"certificate_hostnames.png\",\n    \"title\": \"certificate_hostnames.png\",\n    \"src\": \"/static/3448422cb543469b810dc33a870e9093/7d769/certificate_hostnames.png\",\n    \"srcSet\": [\"/static/3448422cb543469b810dc33a870e9093/5243c/certificate_hostnames.png 240w\", \"/static/3448422cb543469b810dc33a870e9093/ab158/certificate_hostnames.png 480w\", \"/static/3448422cb543469b810dc33a870e9093/7d769/certificate_hostnames.png 960w\", \"/static/3448422cb543469b810dc33a870e9093/87339/certificate_hostnames.png 1440w\", \"/static/3448422cb543469b810dc33a870e9093/3557b/certificate_hostnames.png 1692w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \")), mdx(\"p\", null, \"Upon continuing, you see the generated certificate. It's crypto gibberish, but\\nyou should keep a record of this, but for the next few steps, and possibly\\nlonger term in your password manager.\"), mdx(\"h4\", {\n    \"id\": \"import-certificate\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#import-certificate\",\n    \"aria-label\": \"import certificate permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Import Certificate\"), mdx(\"p\", null, \"Navigate to the AWS Certificate Manager (ACM) console. This should be easily\\nfound through the AWS web UI.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Note\"), \": In general, you should upload to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"us-east-1\"), \". However, I'm using the\\nnewer, cheaper HTTP API Gateway endpoint instead of the older REST API Gateway\\nendpoint. For the HTTP API Gateway endpoints, \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"the certificate needs to be\\nuploaded to ACM in the same region as the lambda functions\"), \". I also don't\\nthink there's a downside to uploading your certificate to multiple regions.\"), mdx(\"p\", null, \"Click \\\"Import Certificate\\\". Then where it says \\\"Certificate body\\\", paste your\\n\", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Origin Certificate\"), \" from the previous step. Where it says \\\"Certificate\\nprivate key\\\", paste your \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Private key\"), \" from the previous step. For the\\n\\\"Certificate chain\\\", that's a special public key from Cloudflare. To retrieve\\nit, go to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://support.cloudflare.com/hc/en-us/articles/115000479507\"\n  }), \"this Cloudflare help page\"), \", scroll down to \\\"Step 4 -\\nAdd Cloudflare Origin CA root certificates\\\", and expand \\\"Cloudflare Origin CA \\u2014\\nRSA Root\\\". Then paste that value into the AWS ACM box. Click \\\"Next\\\". Add a tag\\nif you'd like, then click \\\"Import\\\".\"), mdx(\"h4\", {\n    \"id\": \"add-custom-domain-to-api-gateway\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#add-custom-domain-to-api-gateway\",\n    \"aria-label\": \"add custom domain to api gateway permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Add custom domain to API Gateway\"), mdx(\"p\", null, \"Go to the API Gateway console. Then choose \\\"Custom Domain Names\\\" on the left.\\nThen click \\\"Create\\\". Enter your domain name, which must match the one provided\\nwhen you created the certificate. Since I use this for personal projects, I'm\\ncontent with \\\"Regional\\\", which likely has lower availability than\\n\\\"Edge-optimized\\\", but is still very high. Then choose the ACM certificate you\\njust uploaded that also matches the same domain name. Then click \\\"Create\\\".\"), mdx(\"h4\", {\n    \"id\": \"configure-domain-mappings\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#configure-domain-mappings\",\n    \"aria-label\": \"configure domain mappings permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Configure domain mappings\"), mdx(\"p\", null, \"Now you've created a certificate, imported it to Amazon, and connected it with a\\ncustom API gateway domain. But you need to tell API Gateway which API to call\\nwhen that domain is requested. On the same page as the last step, click\\n\\\"Configure API mappings\\\", then \\\"Add new mapping\\\". Use the boxes to associate\\npaths to APIs and then click \\\"Save\\\". Note that if the path is \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"/endpoint\"), \",\\nyou'll reach that API by calling \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"your_domain/endpoint\"), \".\"), mdx(\"h4\", {\n    \"id\": \"connect-cloudflare-to-that-api-gateway-domain\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#connect-cloudflare-to-that-api-gateway-domain\",\n    \"aria-label\": \"connect cloudflare to that api gateway domain permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Connect Cloudflare to that API Gateway domain\"), mdx(\"p\", null, \"Now you need to tell Cloudflare to route traffic from your custom domain name to\\nAPI Gateway. Make note of the \\\"API Gateway domain name\\\" on the API Gateway page\\nwhere you just added a custom domain. Then go back to the Cloudflare dashboard\\nand click the \\\"DNS\\\" tab. Then add a \", mdx(\"strong\", {\n    parentName: \"p\"\n  }, mdx(\"inlineCode\", {\n    parentName: \"strong\"\n  }, \"CNAME\")), \" record, where \\\"Name\\\" is the\\nsubdomain name, and \\\"Target\\\" is that \\\"API Gateway domain name\\\". Click \\\"Save\\\".\"), mdx(\"h4\", {\n    \"id\": \"set-ssl-to-full-strict\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#set-ssl-to-full-strict\",\n    \"aria-label\": \"set ssl to full strict permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Set SSL to Full (Strict)\"), mdx(\"p\", null, \"Last, you need to set your SSL mode to \\\"Full (Strict)\\\". If you're ok with the\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"entire domain\"), \" being \\\"Full (Strict)\\\", you can go to \\\"SSL/TLS\\\" and switch the\\nencryption mode to \\\"Full (Strict)\\\".\"), mdx(\"p\", null, \"I use the same base domain for traffic served directly from S3. Since S3 doesn't\\nsupport HTTPS traffic, I need to have Cloudflare's SSL setting set to Flexible,\\nwhich means that traffic is encrypted between the user and Cloudflare, but not\\nbetween Cloudflare and S3. However I need to serve traffic to AWS API Gateway\\nwith HTTPS.\"), mdx(\"p\", null, \"To get around this, I add a Cloudflare page rule, so that just this API Gateway\\ntraffic is set to \\\"Full (Strict)\\\". Click the \\\"Page Rules\\\" tab, click \\\"Create\\nPage Rule\\\", add a string matching your domain name(s). Then choose \\\"SSL\\\" as the\\nsetting, and set the setting to \\\"Full (Strict)\\\". Then click \\\"Save and Deploy\\\".\"), mdx(\"h3\", {\n    \"id\": \"conclusion\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#conclusion\",\n    \"aria-label\": \"conclusion permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Conclusion\"), mdx(\"p\", null, \"You should now be able to access your API endpoint through your custom domain!\\nIn order for Cloudflare to cache your content, you need to set applicable\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Cache-Control\"), \" headers, such as \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"public,max-age=3600\"), \", to cache on both a\\nuser's browser and on Cloudflare's server for a period of 1 hour. If the file\\nextension is not one \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://support.cloudflare.com/hc/en-us/articles/200172516-Understanding-Cloudflare-s-CDN#h_a01982d4-d5b6-4744-bb9b-a71da62c160a\"\n  }), \"cached by default\"), \", you'll need to set\\na \\\"Cache Everything\\\" page rule.\"), mdx(\"p\", null, \"In order to find out if any given request was served from Cloudflare's cache,\\nyou can inspect the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"cf-cache-status\"), \" header on the response. If the value is\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"HIT\"), \", the asset was served from Cloudflare's cache.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"Footnotes\"), \":\"), mdx(\"p\", null, \"If you use the HTTP API endpoints, you need the certificate to be in \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"the same\\nregion\"), \" as the API. However that also means that if you have HTTP API's in two\\nseparate regions, you can't use one domain for both. You'll have to create a\\nseparate domain for each region. For the Cloudflare page rule, set an asterisk\\nlike \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"*lambda.domain\"), \", so that you can use one page rule for all subdomains.\"));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Cloudflare  is a Content Delivery Network (CDN), a global network\nof servers that cache responses from websites so that those responses can…","timeToRead":4,"banner":null}},"pageContext":{"slug":"/blog/caching-lambda-functions-cloudflare","formatString":"MMMM Do, YYYY"}},"staticQueryHashes":["318001574","3787687951","3787687951"]}