{"componentChunkName":"component---node-modules-lekoarts-gatsby-theme-minimal-blog-core-src-templates-post-query-tsx","path":"/blog/all-transit","result":{"data":{"post":{"__typename":"MdxPost","id":"6776473e-ca2d-50ab-b5f6-d4d7350777f7","slug":"/blog/all-transit","title":"All Transit","date":"February 24th 2020","tags":null,"description":"Visualization of all transit in the Transitland database","body":"function _extends() { _extends = Object.assign || function (target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i]; for (var key in source) { if (Object.prototype.hasOwnProperty.call(source, key)) { target[key] = source[key]; } } } return target; }; return _extends.apply(this, arguments); }\n\nfunction _objectWithoutProperties(source, excluded) { if (source == null) return {}; var target = _objectWithoutPropertiesLoose(source, excluded); var key, i; if (Object.getOwnPropertySymbols) { var sourceSymbolKeys = Object.getOwnPropertySymbols(source); for (i = 0; i < sourceSymbolKeys.length; i++) { key = sourceSymbolKeys[i]; if (excluded.indexOf(key) >= 0) continue; if (!Object.prototype.propertyIsEnumerable.call(source, key)) continue; target[key] = source[key]; } } return target; }\n\nfunction _objectWithoutPropertiesLoose(source, excluded) { if (source == null) return {}; var target = {}; var sourceKeys = Object.keys(source); var key, i; for (i = 0; i < sourceKeys.length; i++) { key = sourceKeys[i]; if (excluded.indexOf(key) >= 0) continue; target[key] = source[key]; } return target; }\n\n/* @jsx mdx */\nvar _frontmatter = {\n  \"title\": \"All Transit\",\n  \"date\": \"2020-02-24T00:00:00.000Z\",\n  \"slug\": \"/blog/all-transit\",\n  \"description\": \"Visualization of all transit in the Transitland database\"\n};\n\nvar makeShortcode = function makeShortcode(name) {\n  return function MDXDefaultShortcode(props) {\n    console.warn(\"Component \" + name + \" was not imported, exported, or provided by MDXProvider as global scope\");\n    return mdx(\"div\", props);\n  };\n};\n\nvar layoutProps = {\n  _frontmatter: _frontmatter\n};\nvar MDXLayout = \"wrapper\";\nreturn function MDXContent(_ref) {\n  var components = _ref.components,\n      props = _objectWithoutProperties(_ref, [\"components\"]);\n\n  return mdx(MDXLayout, _extends({}, layoutProps, props, {\n    components: components,\n    mdxType: \"MDXLayout\"\n  }), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://all-transit.com\"\n  }), \"Interactive map\")), mdx(\"p\", null, \"Transit connects the densest cities but is also surprisingly prevalent in some\\nremote Western states. I wanted to find and display all these routes. Once I'd\\ndone that for the U.S., why not the world? This project visualizes data from the\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://transit.land\"\n  }), \"Transitland\"), \" project. The name alludes to \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://benfry.com/allstreets/map5.html\"\n  }), mdx(\"em\", {\n    parentName: \"a\"\n  }, \"All\\nStreets\")), \".\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://all-transit.com\"\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"51.25000000000001%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAIAAAA7N+mxAAAACXBIWXMAAAsSAAALEgHS3X78AAABEklEQVQoz3WSb2+DIBDG/WwbIBZdEajaZG/3YlX+WJsl+/Y7ONTaZMlFD7nfPc+BBW0dka40QQz3UjlYMuWZchhp10JAssW2LPDFuzu/zLSFuiluxwSZGO/nEXNuvLiMNNXscN0HqiHxVEIg45AstRc9mpqYGt+aL9YelWvwrAP453qG6tL47L91YlhEvzBlqbKVupHzd9TYYGCa66MeFiI9keDKAhbhNF7VzSWQ0sJT9IGsnndlaFwZn04oez4cUhoEnHMT1ome4Hw8CUDZmOgAI+Qvyc629QJPu5R0NN6TT2QcG9VO2uFdbnoZhsuI8XGjSR8bpfFyRwLXqR1fYWh96pYij3T8Df6PXNZcf+Tn7x801swjd6T29QAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"All transit in the continental U.S.\",\n    \"title\": \"All transit in the continental U.S.\",\n    \"src\": \"/static/8e0b9329622f43e8fa10f3bbe572b849/7d769/us.png\",\n    \"srcSet\": [\"/static/8e0b9329622f43e8fa10f3bbe572b849/5243c/us.png 240w\", \"/static/8e0b9329622f43e8fa10f3bbe572b849/ab158/us.png 480w\", \"/static/8e0b9329622f43e8fa10f3bbe572b849/7d769/us.png 960w\", \"/static/8e0b9329622f43e8fa10f3bbe572b849/87339/us.png 1440w\", \"/static/8e0b9329622f43e8fa10f3bbe572b849/88b03/us.png 1920w\", \"/static/8e0b9329622f43e8fa10f3bbe572b849/be6f4/us.png 7800w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"p\", null, \"The schedule animation is my favorite part of the project. If you zoom into a\\ncity (currently U.S. only) you can see streaks moving around that correspond to\\ntransit vehicles: trains, buses, ferries. This data takes actual schedule\\ninformation from the Transitland API and matches it to route geometries.\"), mdx(\"p\", null, mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://all-transit.com/#14.73/42.35435/-71.0638/31.8/46\"\n  }), mdx(\"span\", _extends({\n    parentName: \"a\"\n  }, {\n    \"className\": \"gatsby-resp-image-wrapper\",\n    \"style\": {\n      \"position\": \"relative\",\n      \"display\": \"block\",\n      \"marginLeft\": \"auto\",\n      \"marginRight\": \"auto\",\n      \"maxWidth\": \"960px\"\n    }\n  }), \"\\n      \", mdx(\"span\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-background-image\",\n    \"style\": {\n      \"paddingBottom\": \"83.33333333333334%\",\n      \"position\": \"relative\",\n      \"bottom\": \"0\",\n      \"left\": \"0\",\n      \"backgroundImage\": \"url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAARCAYAAADdRIy+AAAACXBIWXMAABYlAAAWJQFJUiTwAAADZ0lEQVQ4y01U13biMBT0TyWQArjJcpHlBgESmm0wNWXPnv3+2ZHZh33QAWw0mnZlRfEKtljBj3eI8j2SfAdVNvD1GU72C7b+gZ92kNkeIr9hFO0xFBsMxBqP/goP3n09eh/9suz4AC+q8eqtMZI1Ir1DnG3wNl9gNt8SrEWUbSHzE0TWwSH4KG4xlA0GBBr+twYuAd2MTPSJTK54kQc8+w0mYYuQbHW1gco3iIoWXnqEq/Zwk5rs97BVh+dg14MY4AHZGeaWn39BFN9cP3DTC8YEc5IDJpTmqRO8/IhAN1wtjBo7Jsuk64GdpCGJGg/OO17CBuP4DMvRN/gE9PjppgTQFzjqQsAOdnTgQUfKPkKmO3jJjsyopj/wACda811DVSsSqXlICyvMLhCKG9MzPfqEn33RpxvGkfHr1HvnEMSw8lQDSbleduoBRLSg/CNeghrPDEnwuWXSlPTRABmWgrIFGQn6GpdHhPqAgCEIyo31FqFiaASVyQo6YzvIKkw3cOWcdmxheQzDM8zyT5jvIic4l60/EZU3Ah7hmCZQZsxwjPRIrVktA9RiPH4nIQbG2jnuzITywwQvXF0P5Jdf9PQLLg+QJUH5bBIzmMywJtv8woNaJn5ksg2GTyUmT0uMkjMeGU6fsmHoGS+LK4KCsotPuLTAZVjp4sQKXcho3zO9W3Nkdz/ImiRMWIOCw7HHmL8t14RBVk52xYSnmiCEYVGdkXKFRcceMmkmrIumb4IT75HmdV+roPqGlEvI0Udvk9Wz03d2Dj0c8ZRs1kEVNcbyXnKXZpt+ZgWrkjBhWpDkHYJkSwJXuAywEgvYQR/KuQec0IOovKCc3afB9MylxAnr4Sj+hwqkNhNz7kEE9+UcSQNuc38VvyF/0ARM7z1TxQnLxQEpvbKjpi+zrcha3RBPb5B8b5J2+dzLv+nlGfM5Lw29gR9QsjuHsNe8HCjBTw8oy5q+mMKSYbiGLXdM/Zse/UFQXtnJPWuyRZouUeoZSlWhiuZIoncG1OBVtP9mOSYb3jZjf0sPKC/c4TUgKA1OqisSAi2nU0yTDImcIYrfkRM4YDBmAILqN8LpldK7fp/1Nq2R5S2vL/rG28PmpeDTr6Q6oVAl5iqDVgse1PWTNKGfYX6FnpkR5ZRVvxByAAQvkKHzgb/wCJb6cM2dgAAAAABJRU5ErkJggg==')\",\n      \"backgroundSize\": \"cover\",\n      \"display\": \"block\"\n    }\n  })), \"\\n  \", mdx(\"img\", _extends({\n    parentName: \"span\"\n  }, {\n    \"className\": \"gatsby-resp-image-image\",\n    \"alt\": \"Boston schedule animation\",\n    \"title\": \"Boston schedule animation\",\n    \"src\": \"/static/cd25a6d1907a389fdf9c9e9c6989e175/7d769/boston_schedule_animation.png\",\n    \"srcSet\": [\"/static/cd25a6d1907a389fdf9c9e9c6989e175/5243c/boston_schedule_animation.png 240w\", \"/static/cd25a6d1907a389fdf9c9e9c6989e175/ab158/boston_schedule_animation.png 480w\", \"/static/cd25a6d1907a389fdf9c9e9c6989e175/7d769/boston_schedule_animation.png 960w\", \"/static/cd25a6d1907a389fdf9c9e9c6989e175/87339/boston_schedule_animation.png 1440w\", \"/static/cd25a6d1907a389fdf9c9e9c6989e175/88b03/boston_schedule_animation.png 1920w\", \"/static/cd25a6d1907a389fdf9c9e9c6989e175/d43d8/boston_schedule_animation.png 1954w\"],\n    \"sizes\": \"(max-width: 960px) 100vw, 960px\",\n    \"style\": {\n      \"width\": \"100%\",\n      \"height\": \"100%\",\n      \"margin\": \"0\",\n      \"verticalAlign\": \"middle\",\n      \"position\": \"absolute\",\n      \"top\": \"0\",\n      \"left\": \"0\"\n    },\n    \"loading\": \"lazy\"\n  })), \"\\n    \"))), mdx(\"p\", null, \"This rest of this blog post gives an overview of how the map is made.\"), mdx(\"h3\", {\n    \"id\": \"transitland\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#transitland\",\n    \"aria-label\": \"transitland permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Transitland\"), mdx(\"p\", null, \"I use the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://transit.land\"\n  }), \"Transitland\"), \" project as my data source, which\\ncompiles \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://gtfs.org/\"\n  }), \"GTFS feeds\"), \" from around the world, and harmonizes\\nthe data into a single dataset. You can read more about why that's important\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://transit.land/documentation/onestop-id-scheme/\"\n  }), \"here\"), \".\"), mdx(\"p\", null, \"Transitland serves \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"static\"), \" transit information; it does not currently support\\nGTFS real time feeds (\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/transitland/transitland/issues/77\"\n  }), \"but could in the\\nfuture\"), \"). Their data model\\nis split into five components: \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Operators\"), \", \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Routes\"), \", \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"RouteStopPatterns\"), \",\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Stops\"), \", and \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ScheduleStopPatterns\"), \".\"), mdx(\"p\", null, \"An \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"operator\"), \" is a transit agency that offers services to the general public\\nalong fixed routes. A \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"route\"), \" contains all information about a single transit\\nservice as defined by the transit agency. A route can be a bit of a nebulous\\ntopic, since often a single name has several branches. A \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"RouteStopPattern\"), \"\\ndecomposes each route into a single linear geometry. A route can be defined by\\none or many RouteStopPatterns. A \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"stop\"), \" is each point along a route or\\nRouteStopPattern where passengers may get on or off. A \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"ScheduleStopPattern\"), \"\\ncontains schedule information for each individual edge of the route. So if a\\nroute has 10 stops in a line, there will be 9 ScheduleStopPattern data points\\nfor each transit service scheduled along that route.\"), mdx(\"h3\", {\n    \"id\": \"download\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#download\",\n    \"aria-label\": \"download permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Download\"), mdx(\"p\", null, \"Currently, Transitland doesn't offer bulk downloads. In order to download all\\nthe data I had to find the best way to find and store all the data through their\\nAPI endpoints, which they have for each of the five categories enumerated above.\"), mdx(\"p\", null, \"Each of API endpoint allows for a geographic bounding box. At first, I tried to\\njust pass a bounding box of the entire United States to each endpoint and\\ndownload results a page at a time. Unsurprisingly, that method isn't successful\\nfor the endpoints that have more data to return, like stops and schedules,\\nbecause each API request has a timeout of 120 seconds, and it takes a while to\\nfind and return the unindexed one-millionth row in a database. \", mdx(\"sup\", _extends({\n    parentName: \"p\"\n  }, {\n    \"id\": \"fnref-1\"\n  }), mdx(\"a\", _extends({\n    parentName: \"sup\"\n  }, {\n    \"href\": \"#fn-1\",\n    \"className\": \"footnote-ref\"\n  }), \"1\"))), mdx(\"p\", null, \"  It might be possible to use the database indexes better by providing the\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/transitland/transitland-datastore/issues/1254#issuecomment-424813471\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"min_id\"), \" query\\nparameter\"), \".\"), mdx(\"p\", null, \"Because of this, I found it best in general to split API queries into smaller\\npieces, by using e.g. operator or route identifiers. I ended up downloading\\nroutes, route stop patterns, and stops by operator and schedule data by route. I\\nwrote a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/kylebarron/transitland_wrapper\"\n  }), \"Python/CLI wrapper\"), \" for accessing the Transitland\\ndatabase, to help with providing geometries and paging through all results.\"), mdx(\"p\", null, mdx(\"strong\", {\n    parentName: \"p\"\n  }, \"N.B.\"), \" I currently am hosting bulk downloads of the data I collected for the\\nproject. You can find appropriate links on the \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://all-transit.com/about\"\n  }), \"About\\npage\"), \" of the project.\"), mdx(\"h3\", {\n    \"id\": \"data-analysis\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#data-analysis\",\n    \"aria-label\": \"data analysis permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Data Analysis\"), mdx(\"p\", null, \"Most of the data-generating code for this project is done in Bash,\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://stedolan.github.io/jq/\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"jq\")), \", GNU Parallel, SQLite, and a couple\\nPython scripts. In general, data is kept in \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"newline-delimited JSON\"), \" and\\n\", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"newline-delimited GeoJSON\"), \" for all intermediate steps to facilitate streaming\\nand keep memory use low. However, I found that the schedule data was large\\nenough to necessitate transitioning to SQLite.\"), mdx(\"p\", null, \"Operator, route, and stop information is encoded into \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.mapbox.com/vector-tiles/reference/\"\n  }), \"Mapbox Vector Tiles\"), \"\\nusing \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/mapbox/tippecanoe\"\n  }), \"Tippecanoe\"), \". I use \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"jq\"), \" to reshape the source GeoJSON to keep\\nonly necessary attributes of each Feature.\"), mdx(\"h4\", {\n    \"id\": \"schedule-data\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#schedule-data\",\n    \"aria-label\": \"schedule data permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Schedule data\"), mdx(\"p\", null, \"Schedule data from Transitland doesn't have a geometric component. In order to\\nconnect schedules to geometries, you need to match the schedule data to the\\nroutes \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"and\"), \" stops data.\"), mdx(\"p\", null, \"If you match schedule data just to routes, you have no way of knowing where\\nalong the route the two stops are, and if you match schedule data just to stops,\\nyou have no knowledge of the geometry between those two points.\"), mdx(\"p\", null, \"Since some schedule data is missing links to route stop patterns, I first tried\\nto use \", mdx(\"em\", {\n    parentName: \"p\"\n  }, \"just\"), \" the routes data. For each schedule stop pair, I found the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Point\"), \"\\ngeometries of its start and end stops, found the nearest points on the route for\\neach of those stops, and retrieved the geometry between those two stops.\"), mdx(\"p\", null, \"This can be problematic, however, because routes can have complex geometries.\\nFor example, metro lines in Chicago might be represented geometrically as a\\nloop; starting in the suburbs, going downtown around The Loop, and back to the\\nsuburbs. When I use this process to match the schedule stop pair to the route, I\\nsometimes match one stop to the first end of the route, and the other stop to\\nthe other end of the route. This caused my program to think that the train went\\nto downtown Chicago and back in one minute, and the animation looked haywire\\ndepicting a train moving through Chicago at 600 miles per hour.\"), mdx(\"p\", null, \"Helpfully, most (though not all) schedule data is also linked to a route stop\\npattern, and the schedule data also generally has linear referencing distances\\nalong that route stop pattern. So for example, a schedule stop pair might say\\nthat the origin stop is 100 (meters) along the route stop pattern's geometry and\\nthat the destination stop is 900 (meters) along its geometry. This allows for a\\nmuch more accurate way of finding schedule geometries. I take the route stop\\npattern, project it into a local coordinate system with units in meters (I use\\nthe local \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system\"\n  }), \"UTM zone\"), \"), and then cut the route stop pattern's\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"LineString\"), \" geometry using those two distances using Shapely's \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://shapely.readthedocs.io/en/stable/manual.html#substring\"\n  }), \"linear\\nreferencing methods\"), \".\"), mdx(\"p\", null, \"Once I have a geometry for that schedule, I linearly interpolate timestamps\\nalong each coordinate between start and end. I export this data as GeoJSON\\n\", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Feature\"), \"s, where each geometry is a \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"LineString\"), \" with three-dimensional\\ncoordinates: longitude, latitude, and time.\"), mdx(\"h4\", {\n    \"id\": \"schedule-tiles\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#schedule-tiles\",\n    \"aria-label\": \"schedule tiles permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Schedule tiles\"), mdx(\"p\", null, \"Now that I have these three-dimensional geometries, I need to figure out the\\nbest way to transport them to the client. Unfortunately, at this time Tippecanoe\\n\", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/mapbox/tippecanoe/issues/714\"\n  }), \"doesn't support three-dimensional coordinates\"), \". The\\nrecommendation in that thread was to reformat to have individual points with\\nproperties. That would make it harder to associate the points to lines, however.\"), mdx(\"p\", null, \"I decided to go with a custom data format; essentially tiled, gzipped, minified,\\nJSON. Since I know that all features are \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"LineStrings\"), \", and since I have no\\nproperties that I care about, I keep only the line's coordinates. The verbose\\ndepiction of the data the client receives:\"), mdx(\"pre\", null, mdx(\"code\", _extends({\n    parentName: \"pre\"\n  }, {\n    \"className\": \"language-json\",\n    \"metastring\": \"noLineNumbers\",\n    \"noLineNumbers\": true\n  }), \"[\\n    // First LineString\\n    [\\n        // Coordinate of LineString\\n        [\\n            0, 1, 2\\n        ],\\n        // Coordinate of LineString\\n        [\\n            1, 2, 3\\n        ]\\n    ],\\n    // Second LineString\\n    [\\n        []\\n        ...\\n    ]\\n]\\n\")), mdx(\"p\", null, \"In order to make the data download manageable, I cut each JSON into xyz map\\ntiles, so that only data pertaining to the current viewport is loaded. For dense\\ncities with high frequency transit like Washington DC and New York City, some\\ntiles can still be quite large. I cut the schedule tiles into full resolution at\\nzoom 13, and then generate overview tiles for lower zooms that contain a\\nfraction of the features of their child tiles.\"), mdx(\"h3\", {\n    \"id\": \"website\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#website\",\n    \"aria-label\": \"website permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Website\"), mdx(\"p\", null, \"All portions of the website are self-hosted. The website itself is static and\\nhosted on Github Pages. The map tiles come from \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://openmaptiles.org/\"\n  }), \"OpenMapTiles\"), \" and\\nare served with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/consbio/mbtileserver\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"mbtileserver\")), \" on a Google Cloud f1-micro\\ninstance. I have map tiles set to cache through Cloudflare to hopefully cope\\nfine with any spikes in demand. Vector tiles with operator, route, and stop\\ninformation are also hosted on the Google Cloud instance. The JSON tiles I use\\nfor the schedule animation are currently hosted on AWS S3.\"), mdx(\"p\", null, \"The website is coded with React and JavaScript, using Gatsby as the static site\\ngenerator. I use React Map GL/Mapbox GL JS for rendering the basemap and the\\nroutes layer. I use Deck.gl's \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://deck.gl/#/documentation/deckgl-api-reference/layers/trips-layer\"\n  }), mdx(\"inlineCode\", {\n    parentName: \"a\"\n  }, \"TripsLayer\")), \" on top for rendering\\nthe schedule animation.\"), mdx(\"h3\", {\n    \"id\": \"performance\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h3\"\n  }, {\n    \"href\": \"#performance\",\n    \"aria-label\": \"performance permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Performance\"), mdx(\"p\", null, \"Although performance still isn't as good as I'd like on lower-powered and mobile\\ndevices, it's better than where I started.\"), mdx(\"h4\", {\n    \"id\": \"minimize-data-downloads\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#minimize-data-downloads\",\n    \"aria-label\": \"minimize data downloads permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Minimize data downloads\"), mdx(\"p\", null, \"The source data for routes and especially for schedule information is huge. In\\norder to serve this data over a web map, they need to be compressed and sliced\\ninto smaller pieces to download. This is why \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://en.wikipedia.org/wiki/Tiled_web_map\"\n  }), \"map tiling\"), \" exists.\"), mdx(\"p\", null, \"I use \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://docs.mapbox.com/vector-tiles/reference/\"\n  }), \"Mapbox Vector Tiles\"), \" for transmitting operator, route, and stop data\\nto the client. Vector tiles are great because they're highly compressible, and\\nreally easy to create with \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://github.com/mapbox/tippecanoe\"\n  }), \"Tippecanoe\"), \".\"), mdx(\"p\", null, \"In order to keep the size of the vector tiles small, the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"stops\"), \" layer is\\nomitted until zoom 11, and the \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"routes\"), \" layer omits metadata about the stops on\\neach route until zoom 11. (The maximum zoom level of data in the vector tiles is\\n11, but the data will display past zoom 11 thanks to overzooming.)\"), mdx(\"p\", null, mdx(\"em\", {\n    parentName: \"p\"\n  }, \"Unfortunately\"), \", Tippecanoe only supports 2D data at this time. This means that\\nI had to develop my own solution for getting the schedule data to the client,\\nbecause I need a third dimension on those geometries (longitude, latitude,\\ntime). For the time being I've settled on tiled, gzipped, minified, JSON. Since\\nI know that all schedule data are \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"LineString\"), \"s, I keep only the geometry part\\nof the GeoJSON, and don't transmit any properties data about each \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"Feature\"), \" to\\nthe client.\"), mdx(\"p\", null, \"Since I couldn't use Tippecanoe for generating these JSON tiles, I developed my\\nown workflow for cutting GeoJSON features into tiles. I chose a reasonably high\\nzoom level, 13, which contains all schedule data in the selected time period in\\nfull resolution. For lower zooms, I take a random fraction of a tile's children\\ntiles to keep tile sizes reasonable.\"), mdx(\"h4\", {\n    \"id\": \"minimize-data-updates\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#minimize-data-updates\",\n    \"aria-label\": \"minimize data updates permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Minimize data updates\"), mdx(\"p\", null, \"I render invisble operator service area polygons so that I can easily find the\\noperators whose service area is in the viewbox. However I've found that\\nconstantly updating the list of nearby operators when panning can impact\\nperformance, so instead I only compute that list when the operators option panel\\nis open.\"), mdx(\"p\", null, \"I also turn off the schedule animation when the current zoom is below the\\nminimum zoom at which I show the animation. I'm not sure how much this helps\\nperformance because the Deck.gl \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"TileLayer\"), \" already is invisble below that zoom\\nthreshold, but it can't hurt.\"), mdx(\"h4\", {\n    \"id\": \"deckgl-optimizations\",\n    \"style\": {\n      \"position\": \"relative\"\n    }\n  }, mdx(\"a\", _extends({\n    parentName: \"h4\"\n  }, {\n    \"href\": \"#deckgl-optimizations\",\n    \"aria-label\": \"deckgl optimizations permalink\",\n    \"className\": \"anchor before\"\n  }), mdx(\"svg\", _extends({\n    parentName: \"a\"\n  }, {\n    \"aria-hidden\": \"true\",\n    \"focusable\": \"false\",\n    \"height\": \"16\",\n    \"version\": \"1.1\",\n    \"viewBox\": \"0 0 16 16\",\n    \"width\": \"16\"\n  }), mdx(\"path\", _extends({\n    parentName: \"svg\"\n  }, {\n    \"fillRule\": \"evenodd\",\n    \"d\": \"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"\n  })))), \"Deck.gl optimizations\"), mdx(\"p\", null, \"Deck.gl has a \", mdx(\"a\", _extends({\n    parentName: \"p\"\n  }, {\n    \"href\": \"https://deck.gl/#/documentation/developer-guide/performance-optimization\"\n  }), \"page in its documentation\"), \" detailing\\nstrategies for improving performance.\"), mdx(\"p\", null, \"I set \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"useDevicePixels\"), \" to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \". When \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"true\"), \", this prop tells Deck.gl to\\nrender at double the resolution on a high DPI display, which means that it must\\ndo 4x the pixel computations. When the animation is more important than the\\ncrispness of the map rendering, set this to \", mdx(\"inlineCode\", {\n    parentName: \"p\"\n  }, \"false\"), \".\"), mdx(\"p\", null, \"I also attempted to use precomputed binary attributes but hit some errors and\\ndecided it wasn't worth it to debug right now. In the future I'd like to figure\\nout how to use binary data directly.\"), mdx(\"div\", {\n    \"className\": \"footnotes\"\n  }, mdx(\"hr\", {\n    parentName: \"div\"\n  }), mdx(\"ol\", {\n    parentName: \"div\"\n  }, mdx(\"li\", _extends({\n    parentName: \"ol\"\n  }, {\n    \"id\": \"fn-1\"\n  }), mdx(\"a\", _extends({\n    parentName: \"li\"\n  }, {\n    \"href\": \"#fnref-1\",\n    \"className\": \"footnote-backref\"\n  }), \"\\u21A9\")))));\n}\n;\nMDXContent.isMDXComponent = true;","excerpt":"Interactive map Transit connects the densest cities but is also surprisingly prevalent in some\nremote Western states. I wanted to find and…","timeToRead":7,"banner":null}},"pageContext":{"slug":"/blog/all-transit","formatString":"MMMM Do YYYY"}}}